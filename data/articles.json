[
  {
    "title": "D√©ploiement continu avec CircleCI - Partie 1",
    "slug": "dploiement-continu-avec-circleci---partie-1-208n",
    "created_at": "2019-03-13T13:58:36.380Z",
    "main_image": "https://thepracticaldev.s3.amazonaws.com/i/iylj3u67kq2refra5xck.jpg",
    "description": "D√©ployer une application VueJS sur Firebase hosting avec CircleCI",
    "published": true,
    "published_at": "2019-03-18T14:10:09.012Z",
    "processed_html": "\u003cp\u003eJe vous propose de mettre en place un d√©ploiement continu en utilisant \u003ca href=\"https://github.com/jean-smaug/condorcet\"\u003eCondorcet\u003c/a\u003e, un de mes projets, comme exemple.\u003cbr\u003e\nLe but est de pr√©senter les diff√©rents concepts inh√©rents √† CircleCI au travers d'un cas concret.\u003cbr\u003e\nDans la premi√®re partie on mettra en place une solution fonctionnelle que l'on optimisera en seconde partie.\u003c/p\u003e\n\u003ch1\u003e\n  \u003ca name=\"lapplication\" href=\"#lapplication\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  L'application\n\u003c/h1\u003e\n\n\u003cp\u003eCette application est faite avec \u003ca href=\"https://vuejs.org/\"\u003eVue.js\u003c/a\u003e et utilise \u003ca href=\"https://firebase.google.com/\"\u003eFirebase\u003c/a\u003e pour la gestion utilisateurs et le stockage des donn√©es. Nous allons aussi utiliser Firebase pour h√©berger l'application.\u003c/p\u003e\n\n\u003cp\u003eLes scripts du package.json :\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight json\"\u003e\u003ccode\u003e\u003cspan class=\"nl\"\u003e\"scripts\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"serve\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"vue-cli-service serve\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"build\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"vue-cli-service build\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"lint\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"vue-cli-service lint\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"test:unit\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"vue-cli-service test:unit\"\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003eserve\u003c/code\u003e lance le serveur de d√©veloppement\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003ebuild\u003c/code\u003e construit une application statique pour la production\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003elint\u003c/code\u003e v√©rifie que le code respecte les r√®gles d√©finies par ESLint\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003etest:unit\u003c/code\u003e lance les tests unitaires\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eParmi ces scripts j'aimerais que \u003ccode\u003ebuild\u003c/code\u003e, \u003ccode\u003elint\u003c/code\u003e et \u003ccode\u003etest:unit\u003c/code\u003e soient lanc√©s √† chaque fois que je cherche √† int√©grer du code dans \u003ccode\u003emaster\u003c/code\u003e. Car \u003ccode\u003emaster\u003c/code\u003e doit toujours √™tre stable ü•ê.\u003c/p\u003e\n\n\u003cp\u003ePour √©viter de le faire manuellement je vais utiliser \u003ca href=\"https://circleci.com/\"\u003eCircleCI\u003c/a\u003e. Cet outil va lancer les scripts √† chaque fois que je push un commit sur Github. \u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"ajouter-circleci-%C3%A0-son-projet\" href=\"#ajouter-circleci-%C3%A0-son-projet\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Ajouter CircleCI √† son projet\n\u003c/h1\u003e\n\n\u003cp\u003ePour ajouter CircleCI √† un d√©p√¥t il faut se rendre dans la Marketplace de Github :\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--nJ9adedm--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/vuibgph281o3zyk5kg4c.png\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--nJ9adedm--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/vuibgph281o3zyk5kg4c.png\" alt=\"circle-ci-github1\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003ePour un projet open source il faut s√©lectionner l'option \"Free\", √† moins que vous ne souhaitiez sortir le chequos :\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--FCQtbkew--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/idopy09l6hqs8i3e1n0q.png\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--FCQtbkew--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/idopy09l6hqs8i3e1n0q.png\" alt=\"circle-ci-github2\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eApr√®s avoir valid√© l'installation de CircleCI on peut ajouter un projet Github √† CricleCI :\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--eCupbO_1--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/kf29upwnecfsfgr8p6wn.png\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--eCupbO_1--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/kf29upwnecfsfgr8p6wn.png\" alt=\"circle-ci-github3\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eNous arrivons sur la page des projets :\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--RVZ2e1fF--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/vp91njjd817wexwx166q.png\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--RVZ2e1fF--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/vp91njjd817wexwx166q.png\" alt=\"circle-ci-github4\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eSur cette page il est possible de s√©lectionner l'environnement dans lequel nous allons effectuer nos tests :\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--h_b5vVfX--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/ov3z7i2ku0bwja0eyqnl.png\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--h_b5vVfX--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/ov3z7i2ku0bwja0eyqnl.png\" alt=\"circle-ci-github5\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003ePremi√®re √©tape valid√©e, on passe √† la configuration.\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"d%C3%A9finition-des-jobs\" href=\"#d%C3%A9finition-des-jobs\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  D√©finition des jobs\n\u003c/h1\u003e\n\n\u003cp\u003ePour CircleCI un job repr√©sente une succession d'instructions.\u003cbr\u003e\nPour un projet open source nous pouvons avoir 4 jobs maximum s'ex√©cutant en parall√®le.\u003cbr\u003e\nConcr√®tement, chacun des trois scripts aura un job qui lui sera d√©di√© et nous pourrons ainsi lancer 3 jobs en parall√®le, un pour chaque script. Ainsi chacun des scripts sera lanc√© dans un environnement isol√© n'impactant pas les autres.\u003c/p\u003e\n\n\u003cp\u003eL'exemple ci dessous montre √† quoi ressemble la d√©finition d'un job :\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight yaml\"\u003e\u003ccode\u003e  \u003cspan class=\"na\"\u003ebuild\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003edocker\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eimage\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ecircleci/node:11.10.1\u003c/span\u003e\n    \u003cspan class=\"na\"\u003esteps\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003echeckout\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eyarn install\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eyarn build\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003ebuild\u003c/code\u003e : le nom du job\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003edocker\u003c/code\u003e : l'environnement dans lequel sera ex√©cut√© notre job, ici Docker\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003eimage\u003c/code\u003e : l'image que doit utiliser Docker, ici Node.js\u003c/li\u003e\n\u003c/ul\u003e\n\n\n\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003esteps\u003c/code\u003e : liste de nos instructions\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003echeckout\u003c/code\u003e permet de se placer dans le dossier projet cr√©√© par CircleCI\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003erun: yarn install\u003c/code\u003e installe les d√©pendances\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003erun: yarn build\u003c/code\u003e construit une application statique destin√©e √† la production\u003c/li\u003e\n\u003c/ul\u003e\n\n\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eNB : les commandes shell doivent √™tre pr√©c√©d√©es d'un \u003ccode\u003erun:\u003c/code\u003e\u003c/p\u003e\n\n\u003cp\u003eOn r√©p√®te l'op√©ration pour chacun des scripts et on obtient la configuration suivante pour les trois jobs :\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight yaml\"\u003e\u003ccode\u003e\u003cspan class=\"na\"\u003eversion\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"m\"\u003e2.1\u003c/span\u003e\n\u003cspan class=\"na\"\u003ejobs\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ebuild\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003edocker\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eimage\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ecircleci/node:11.10.1\u003c/span\u003e\n    \u003cspan class=\"na\"\u003esteps\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003echeckout\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eyarn install\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eyarn build\u003c/span\u003e\n\n  \u003cspan class=\"na\"\u003elint\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003edocker\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eimage\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ecircleci/node:11.10.1\u003c/span\u003e\n    \u003cspan class=\"na\"\u003esteps\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003echeckout\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eyarn install\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eyarn lint\u003c/span\u003e\n\n  \u003cspan class=\"na\"\u003etest\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003edocker\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eimage\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ecircleci/node:11.10.1\u003c/span\u003e\n    \u003cspan class=\"na\"\u003esteps\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003echeckout\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eyarn install\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eyarn test:unit\u003c/span\u003e\n\n\u003cspan class=\"na\"\u003eworkflows\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eversion\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eintegration\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ejobs\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003ebuild\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003elint\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003etest\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003eversion\u003c/code\u003e : la version du fichier de configuration, actuellement 2.1\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003ejobs\u003c/code\u003e : la liste de nos diff√©rents jobs\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eworkflows\u003c/code\u003e : un sc√©nario d'ex√©cution des diff√©rents jobs\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003eversion\u003c/code\u003e : version du workflow, actuellement 2\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eintegration\u003c/code\u003e : le nom du workflow\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003ejobs\u003c/code\u003e : la liste des jobs √† executer. Ici nos trois jobs seront ex√©cut√©s en parall√®le\u003c/li\u003e\n\u003c/ul\u003e\n\n\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eD√©sormais lorsque l'on pushera du code sur Github on pourra voir l'√©tat de nos tests sur CircleCI :\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--X9Iqg1lV--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/zkn88tdbxnhjm5pewjtz.png\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--X9Iqg1lV--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/zkn88tdbxnhjm5pewjtz.png\" alt=\"circle-ci-integration\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eCela est aussi visible directement depuis une Pull Request sur Github :\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--hi4WmCPP--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/5182d3gq4avt7dx1ck9e.png\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--hi4WmCPP--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/5182d3gq4avt7dx1ck9e.png\" alt=\"cricle-ci-pr\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"d%C3%A9ploiement\" href=\"#d%C3%A9ploiement\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  D√©ploiement\n\u003c/h1\u003e\n\n\u003cp\u003eMaintenant que l'int√©gration fonctionne il serait g√©nial de d√©ployer automatiquement notre code lorsqu'un nouveau commit apparait sur la branche \u003ccode\u003emaster\u003c/code\u003e. Que ce soit via une pull request ou un push (force üôÑ)\u003c/p\u003e\n\n\u003cp\u003eJe fais un petit apart√© sur Firebase mais qui sait, peut-√™tre que √ßa en int√©ressera certains ü§∑‚Äç‚ôÇ\u003c/p\u003e\n\n\u003cp\u003ePour d√©ployer des fichiers statiques sur le service hosting de Firebase via une CI il faut :\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003einstaller les outils Firbase en local avec un \u003ccode\u003eyarn global add firebase-tools\u003c/code\u003e. \u003c/li\u003e\n\u003cli\u003elancer un \u003ccode\u003efirebase login:ci\u003c/code\u003e afin d'obtenir un token\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eCe token sera utilis√© pour autoriser la CI √† d√©ployer sur Firebase.\u003c/p\u003e\n\n\u003cp\u003ePour ajouter un token il faut aller dans les param√®tres :\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--YwiF0-j9--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/76v95hce6smpwnb2219s.png\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--YwiF0-j9--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/76v95hce6smpwnb2219s.png\" alt=\"circle-ci-env-variables-2\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eEt ajouter le token en tant que variable d'environnement, ici elle sera appel√©e \u003ccode\u003eFIREBASE_TOKEN\u003c/code\u003e :\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--oX6JkwCk--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/tu1krp4pn7bnrlae2yqr.png\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--oX6JkwCk--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/tu1krp4pn7bnrlae2yqr.png\" alt=\"circle-ci-env-variables\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eOn pourra alors r√©utiliser la variable d'environnement dans notre fichier de configuration :\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight yaml\"\u003e\u003ccode\u003e\u003cspan class=\"na\"\u003eversion\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\n\u003cspan class=\"na\"\u003ejobs\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e# les autres jobs...\u003c/span\u003e\n\n  \u003cspan class=\"na\"\u003edeploy\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003edocker\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eimage\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ecircleci/node:11.10.1\u003c/span\u003e\n    \u003cspan class=\"na\"\u003esteps\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003echeckout\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eyarn install\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eyarn build\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eyarn firebase deploy --token \"$FIREBASE_TOKEN\" --only hosting\u003c/span\u003e\n\n\u003cspan class=\"na\"\u003eworkflows\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eversion\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eintegration\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ejobs\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003ebuild\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003elint\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003etest\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003edeploy\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003erequires\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003ebuild\u003c/span\u003e\n            \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003elint\u003c/span\u003e\n            \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003etest\u003c/span\u003e\n          \u003cspan class=\"na\"\u003efilters\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"na\"\u003ebranches\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n              \u003cspan class=\"na\"\u003eonly\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003emaster\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eDans le nouveau job : \u003ccode\u003edeploy\u003c/code\u003e, on utilise la variable \u003ccode\u003e$FIREBASE_TOKEN\u003c/code\u003e que l'on vient de cr√©er.\u003cbr\u003e\nEnsuite il suffit d'ajouter ce job √† notre workflow en lui ajoutant des options :\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003erequires\u003c/code\u003e : les jobs qui doivent √™tre compl√©t√©s avant d'ex√©cuter ce job\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003efilters\u003c/code\u003e : permet de pr√©ciser pour quelles branches, quels tags... ce job doit s'ex√©cuter. Dans notre cas, uniquement sur la branche \u003ccode\u003emaster\u003c/code\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--Fedkd6BI--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/51jtjfpnwys57lyv3f7e.png\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--Fedkd6BI--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/51jtjfpnwys57lyv3f7e.png\" alt=\"circle-ci-v1\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"r%C3%A9sum%C3%A9\" href=\"#r%C3%A9sum%C3%A9\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  R√©sum√©\n\u003c/h1\u003e\n\n\u003cp\u003eLes jobs sont une suite d'instructions.\u003cbr\u003e\nUn workflow d√©finit la mani√®re dont les diff√©rents jobs seront ex√©cut√©s. On peut ex√©cuter nos jobs en parall√®le, en s√©quentiel, uniquement sur certaines branches...\u003cbr\u003e\nOn peut ajouter des variables d'environnements contenant des informations confidentielles via l'UI et utiliser ces variables dans notre configuration en les pr√©c√©dant d'un $\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"prochaine-%C3%A9tape\" href=\"#prochaine-%C3%A9tape\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Prochaine √©tape\n\u003c/h1\u003e\n\n\u003cp\u003eDans l'absolu notre configuration fonctionne, mais il est possible de faire mieux.\u003cbr\u003e\nDans \u003ca href=\"https://dev.to/jeansmaug/dploiement-continu-avec-circleci---partie-2-6op\"\u003el'article suivant\u003c/a\u003e on va am√©liorer la configuration pour gagner un temps de malade. üòé\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"liens-utiles\" href=\"#liens-utiles\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Liens utiles\n\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://circleci.com/docs/2.0/configuration-reference\"\u003eDocument de r√©f√©rence du fichier de configuration\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://github.com/jean-smaug/condorcet/blob/4046a6723fc2c4b6470c79b309683d9f7af9844a/.circleci/config.yml\"\u003eConfiguration finale\u003c/a\u003e\u003c/p\u003e\n\n",
    "social_image": null,
    "body_markdown": "---\ntitle: D√©ploiement continu avec CircleCI - Partie 1\npublished: true\ndescription: D√©ployer une application VueJS sur Firebase hosting avec CircleCI\ncover_image: https://thepracticaldev.s3.amazonaws.com/i/iylj3u67kq2refra5xck.jpg\ntags: #circleci, #ci, #cd, #firebase\n---\n\nJe vous propose de mettre en place un d√©ploiement continu en utilisant [Condorcet](https://github.com/jean-smaug/condorcet), un de mes projets, comme exemple.\nLe but est de pr√©senter les diff√©rents concepts inh√©rents √† CircleCI au travers d'un cas concret.\nDans la premi√®re partie on mettra en place une solution fonctionnelle que l'on optimisera en seconde partie.\n\n# L'application\n\nCette application est faite avec [Vue.js](https://vuejs.org/) et utilise [Firebase](https://firebase.google.com/) pour la gestion utilisateurs et le stockage des donn√©es. Nous allons aussi utiliser Firebase pour h√©berger l'application.\n\nLes scripts du package.json :\n\n```json\n\"scripts\": {\n    \"serve\": \"vue-cli-service serve\",\n    \"build\": \"vue-cli-service build\",\n    \"lint\": \"vue-cli-service lint\",\n    \"test:unit\": \"vue-cli-service test:unit\"\n  }\n```\n\n- `serve` lance le serveur de d√©veloppement\n- `build` construit une application statique pour la production\n- `lint` v√©rifie que le code respecte les r√®gles d√©finies par ESLint\n- `test:unit` lance les tests unitaires\n\nParmi ces scripts j'aimerais que `build`, `lint` et `test:unit` soient lanc√©s √† chaque fois que je cherche √† int√©grer du code dans `master`. Car `master` doit toujours √™tre stable :croissant:.\n\nPour √©viter de le faire manuellement je vais utiliser [CircleCI](https://circleci.com/). Cet outil va lancer les scripts √† chaque fois que je push un commit sur Github. \n\n# Ajouter CircleCI √† son projet\n\nPour ajouter CircleCI √† un d√©p√¥t il faut se rendre dans la Marketplace de Github :\n\n![circle-ci-github1](https://thepracticaldev.s3.amazonaws.com/i/vuibgph281o3zyk5kg4c.png)\n\nPour un projet open source il faut s√©lectionner l'option \"Free\", √† moins que vous ne souhaitiez sortir le chequos :\n\n![circle-ci-github2](https://thepracticaldev.s3.amazonaws.com/i/idopy09l6hqs8i3e1n0q.png)\n\nApr√®s avoir valid√© l'installation de CircleCI on peut ajouter un projet Github √† CricleCI :\n\n![circle-ci-github3](https://thepracticaldev.s3.amazonaws.com/i/kf29upwnecfsfgr8p6wn.png)\n\nNous arrivons sur la page des projets :\n\n![circle-ci-github4](https://thepracticaldev.s3.amazonaws.com/i/vp91njjd817wexwx166q.png)\n\nSur cette page il est possible de s√©lectionner l'environnement dans lequel nous allons effectuer nos tests :\n\n![circle-ci-github5](https://thepracticaldev.s3.amazonaws.com/i/ov3z7i2ku0bwja0eyqnl.png)\n\nPremi√®re √©tape valid√©e, on passe √† la configuration.\n\n# D√©finition des jobs\n\nPour CircleCI un job repr√©sente une succession d'instructions.\nPour un projet open source nous pouvons avoir 4 jobs maximum s'ex√©cutant en parall√®le.\nConcr√®tement, chacun des trois scripts aura un job qui lui sera d√©di√© et nous pourrons ainsi lancer 3 jobs en parall√®le, un pour chaque script. Ainsi chacun des scripts sera lanc√© dans un environnement isol√© n'impactant pas les autres.\n\nL'exemple ci dessous montre √† quoi ressemble la d√©finition d'un job :\n\n```yml\n  build:\n    docker:\n      - image: circleci/node:11.10.1\n    steps:\n      - checkout\n      - run: yarn install\n      - run: yarn build\n```\n\n- `build` : le nom du job\n- `docker` : l'environnement dans lequel sera ex√©cut√© notre job, ici Docker\n    - `image` : l'image que doit utiliser Docker, ici Node.js\n- `steps` : liste de nos instructions\n    - `checkout` permet de se placer dans le dossier projet cr√©√© par CircleCI\n    - `run: yarn install` installe les d√©pendances\n    - `run: yarn build` construit une application statique destin√©e √† la production\n\nNB : les commandes shell doivent √™tre pr√©c√©d√©es d'un `run:`\n\nOn r√©p√®te l'op√©ration pour chacun des scripts et on obtient la configuration suivante pour les trois jobs :\n\n```yml\nversion: 2.1\njobs:\n  build:\n    docker:\n      - image: circleci/node:11.10.1\n    steps:\n      - checkout\n      - run: yarn install\n      - run: yarn build\n\n  lint:\n    docker:\n      - image: circleci/node:11.10.1\n    steps:\n      - checkout\n      - run: yarn install\n      - run: yarn lint\n\n  test:\n    docker:\n      - image: circleci/node:11.10.1\n    steps:\n      - checkout\n      - run: yarn install\n      - run: yarn test:unit\n\nworkflows:\n  version: 2\n  integration:\n    jobs:\n      - build\n      - lint\n      - test\n```\n\n- `version` : la version du fichier de configuration, actuellement 2.1\n- `jobs` : la liste de nos diff√©rents jobs\n- `workflows` : un sc√©nario d'ex√©cution des diff√©rents jobs\n    - `version` : version du workflow, actuellement 2\n    - `integration` : le nom du workflow\n        - `jobs` : la liste des jobs √† executer. Ici nos trois jobs seront ex√©cut√©s en parall√®le\n\nD√©sormais lorsque l'on pushera du code sur Github on pourra voir l'√©tat de nos tests sur CircleCI :\n\n![circle-ci-integration](https://thepracticaldev.s3.amazonaws.com/i/zkn88tdbxnhjm5pewjtz.png)\n\nCela est aussi visible directement depuis une Pull Request sur Github :\n\n![cricle-ci-pr](https://thepracticaldev.s3.amazonaws.com/i/5182d3gq4avt7dx1ck9e.png)\n\n# D√©ploiement\n\nMaintenant que l'int√©gration fonctionne il serait g√©nial de d√©ployer automatiquement notre code lorsqu'un nouveau commit apparait sur la branche `master`. Que ce soit via une pull request ou un push (force üôÑ)\n\nJe fais un petit apart√© sur Firebase mais qui sait, peut-√™tre que √ßa en int√©ressera certains :man_shrugging:\n\nPour d√©ployer des fichiers statiques sur le service hosting de Firebase via une CI il faut :\n- installer les outils Firbase en local avec un `yarn global add firebase-tools`. \n- lancer un `firebase login:ci` afin d'obtenir un token\n\nCe token sera utilis√© pour autoriser la CI √† d√©ployer sur Firebase.\n\nPour ajouter un token il faut aller dans les param√®tres :\n\n![circle-ci-env-variables-2](https://thepracticaldev.s3.amazonaws.com/i/76v95hce6smpwnb2219s.png)\n\nEt ajouter le token en tant que variable d'environnement, ici elle sera appel√©e `FIREBASE_TOKEN` :\n\n![circle-ci-env-variables](https://thepracticaldev.s3.amazonaws.com/i/tu1krp4pn7bnrlae2yqr.png)\n\nOn pourra alors r√©utiliser la variable d'environnement dans notre fichier de configuration :\n\n```yml\nversion: 2\njobs:\n  # les autres jobs...\n\n  deploy:\n    docker:\n      - image: circleci/node:11.10.1\n    steps:\n      - checkout\n      - run: yarn install\n      - run: yarn build\n      - run: yarn firebase deploy --token \"$FIREBASE_TOKEN\" --only hosting\n\nworkflows:\n  version: 2\n  integration:\n    jobs:\n      - build\n      - lint\n      - test\n    - deploy:\n          requires:\n            - build\n            - lint\n            - test\n          filters:\n            branches:\n              only: master\n```\n\nDans le nouveau job : `deploy`, on utilise la variable `$FIREBASE_TOKEN` que l'on vient de cr√©er.\nEnsuite il suffit d'ajouter ce job √† notre workflow en lui ajoutant des options :\n- `requires` : les jobs qui doivent √™tre compl√©t√©s avant d'ex√©cuter ce job\n- `filters` : permet de pr√©ciser pour quelles branches, quels tags... ce job doit s'ex√©cuter. Dans notre cas, uniquement sur la branche `master`\n\n![circle-ci-v1](https://thepracticaldev.s3.amazonaws.com/i/51jtjfpnwys57lyv3f7e.png)\n\n# R√©sum√©\n\nLes jobs sont une suite d'instructions.\nUn workflow d√©finit la mani√®re dont les diff√©rents jobs seront ex√©cut√©s. On peut ex√©cuter nos jobs en parall√®le, en s√©quentiel, uniquement sur certaines branches...\nOn peut ajouter des variables d'environnements contenant des informations confidentielles via l'UI et utiliser ces variables dans notre configuration en les pr√©c√©dant d'un $\n\n# Prochaine √©tape\n\nDans l'absolu notre configuration fonctionne, mais il est possible de faire mieux.\nDans [l'article suivant](https://dev.to/jeansmaug/dploiement-continu-avec-circleci---partie-2-6op) on va am√©liorer la configuration pour gagner un temps de malade. :sunglasses:\n\n# Liens utiles\n[Document de r√©f√©rence du fichier de configuration](https://circleci.com/docs/2.0/configuration-reference)\n[Configuration finale](https://github.com/jean-smaug/condorcet/blob/4046a6723fc2c4b6470c79b309683d9f7af9844a/.circleci/config.yml)",
    "canonical_url": null,
    "show_comments": true,
    "main_image_background_hex_color": "#dddddd",
    "published_from_feed": false,
    "comments_count": 4,
    "video": null,
    "video_code": null,
    "video_source_url": null,
    "video_thumbnail_url": null,
    "video_closed_caption_track_url": null,
    "feed_source_url": null,
    "positive_reactions_count": 11,
    "edited_at": "2019-11-02T08:29:08.923Z",
    "crossposted_at": null,
    "language": "fr",
    "cached_tag_list": "circleci, ci, cd, firebase",
    "path": "/jeansmaug/dploiement-continu-avec-circleci---partie-1-208n",
    "cached_user_name": "jean-smaug",
    "cached_user_username": "jeansmaug",
    "last_comment_at": "2019-10-11T19:21:34.908Z"
  },
  {
    "title": "D√©ploiement continu avec CircleCI - Partie 2",
    "slug": "dploiement-continu-avec-circleci---partie-2-6op",
    "created_at": "2019-03-13T15:57:29.337Z",
    "main_image": "https://thepracticaldev.s3.amazonaws.com/i/hqxwdv09iz9y9pqxfz04.jpg",
    "description": "Optimisation d'une configuration CircleCI",
    "published": true,
    "published_at": "2019-03-18T14:17:01.390Z",
    "processed_html": "\u003cp\u003eLa premi√®re partie permettait de d√©couvrir les concepts de base de CircleCI et comment les mettre en application. Dans cette partie on va voir comment aller plus loin en utilisant les diff√©rents moyens permettant de partager de l'information entre les jobs.\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"%C3%A9tat-des-lieux\" href=\"#%C3%A9tat-des-lieux\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  √âtat des lieux\n\u003c/h1\u003e\n\n\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight yaml\"\u003e\u003ccode\u003e\u003cspan class=\"na\"\u003eversion\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"m\"\u003e2.1\u003c/span\u003e\n\u003cspan class=\"na\"\u003ejobs\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ebuild\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003edocker\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eimage\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ecircleci/node:11.10.1\u003c/span\u003e\n    \u003cspan class=\"na\"\u003esteps\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003echeckout\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eyarn install\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eyarn build\u003c/span\u003e\n\n  \u003cspan class=\"na\"\u003elint\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003edocker\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eimage\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ecircleci/node:11.10.1\u003c/span\u003e\n    \u003cspan class=\"na\"\u003esteps\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003echeckout\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eyarn install\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eyarn lint\u003c/span\u003e\n\n  \u003cspan class=\"na\"\u003etest\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003edocker\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eimage\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ecircleci/node:11.10.1\u003c/span\u003e\n    \u003cspan class=\"na\"\u003esteps\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003echeckout\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eyarn install\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eyarn test:unit\u003c/span\u003e\n\n  \u003cspan class=\"na\"\u003edeploy\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003edocker\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eimage\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ecircleci/node:11.10.1\u003c/span\u003e\n    \u003cspan class=\"na\"\u003esteps\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003echeckout\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eyarn install\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eyarn build\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eyarn firebase deploy --token \"$FIREBASE_TOKEN\" --only hosting\u003c/span\u003e\n\n\u003cspan class=\"na\"\u003eworkflows\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eversion\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eintegration\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ejobs\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003ebuild\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003elint\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003etest\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003edeploy\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003erequires\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003ebuild\u003c/span\u003e\n            \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003elint\u003c/span\u003e\n            \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003etest\u003c/span\u003e\n          \u003cspan class=\"na\"\u003efilters\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"na\"\u003ebranches\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n              \u003cspan class=\"na\"\u003eonly\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003emaster\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eNotre configuration fonctionne mais on voit que l'on se r√©p√®te. Chacun des jobs contient ces lignes :\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight yaml\"\u003e\u003ccode\u003e    \u003cspan class=\"na\"\u003edocker\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eimage\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ecircleci/node:11.10.1\u003c/span\u003e\n    \u003cspan class=\"na\"\u003esteps\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003echeckout\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eyarn install\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eLes deux premi√®res lignes, celles de la configuration de l'environnement d'ex√©cution, sont juste une r√©p√©tition au sein du fichier de configuration, elles n'ont pas d'impact sur les performances. Mais par soucis de maintenabilit√© on utilisera les executors et les commands pour factoriser ces fragments.\u003c/p\u003e\n\n\u003cp\u003eDeuxi√®me probl√®me, chaque job est oblig√© de r√©installer les d√©pendances car ils ex√©cutent leurs instructions dans un environnement isol√©.\u003cbr\u003e\nPour pallier ce probl√®me on va installer les d√©pendances, les stocker en cache pour qu'elles puissent √™tre partag√©es par les jobs d'un workflow. Les d√©pendances mises en cache pourront aussi √™tre utilis√©es par les jobs futurs.\u003c/p\u003e\n\n\u003cp\u003eLe dernier probl√®me est la n√©cessit√© de devoir re-construire l'application de production dans le job de d√©ploiement alors que cette √©tape a √©t√© r√©alis√©e par le job de build. Encore une fois le probl√®me vient du fait que les jobs sont isol√©s. Par d√©faut le job de d√©ploiement ne peut pas lire ce qui a √©t√© g√©n√©r√© par le job de build. On utilisera les workspaces pour r√©soudre ce souci.\u003c/p\u003e\n\u003ch1\u003e\n  \u003ca name=\"cacher-les-d%C3%A9pendances\" href=\"#cacher-les-d%C3%A9pendances\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Cacher les d√©pendances\n\u003c/h1\u003e\n\n\u003cp\u003ePour utiliser le cache on va d√©finir un nouveau job charg√© d'installer nos d√©pendances :\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight yaml\"\u003e\u003ccode\u003e  \u003cspan class=\"na\"\u003einstall\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003edocker\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eimage\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ecircleci/node:11.10.1\u003c/span\u003e\n    \u003cspan class=\"na\"\u003esteps\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003echeckout\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erestore_cache\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003ekey\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ev1-dependencies-{{ checksum \"yarn.lock\" }}\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eyarn install\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003esave_cache\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003ekey\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ev1-dependencies-{{ checksum \"yarn.lock\" }}\u003c/span\u003e\n          \u003cspan class=\"na\"\u003epaths\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003e./node_modules\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003erestore_cache\u003c/code\u003e : restore le cache pour une cl√© donn√©e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003ekey\u003c/code\u003e : cl√© de restauration du cache\u003c/li\u003e\n\u003c/ul\u003e\n\n\n\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003esave_cache\u003c/code\u003e : sauvegarde des fichiers en cache\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003ekey\u003c/code\u003e : cl√© de stockage du cache\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003epaths\u003c/code\u003e : les elements √† stocker, ici les node_modules\u003c/li\u003e\n\u003c/ul\u003e\n\n\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eCette √©tape tente de restaurer le cache contenant les \u003ccode\u003enode_modules\u003c/code\u003e permettant ainsi de passer l'√©tape d'installation des d√©pendances.\u003c/p\u003e\n\n\u003cp\u003eNB : la cl√© de cache contient un hash de notre fichier \u003ccode\u003eyarn.lock\u003c/code\u003e, g√©n√©r√© par la fonction checksum. Donc si le fichier change, le hash change et le cache est re-g√©n√©r√©.\u003c/p\u003e\n\n\u003cp\u003eOn peut mettre √† jour les autres jobs de notre configuration pour qu'ils utilisent le cache :\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight yaml\"\u003e\u003ccode\u003e\u003cspan class=\"na\"\u003eversion\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\n\u003cspan class=\"na\"\u003ejobs\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003einstall\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003edocker\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eimage\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ecircleci/node:11.10.1\u003c/span\u003e\n    \u003cspan class=\"na\"\u003esteps\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003echeckout\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erestore_cache\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003ekey\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ev1-dependencies-{{ checksum \"yarn.lock\" }}\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eyarn install\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003esave_cache\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003ekey\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ev1-dependencies-{{ checksum \"yarn.lock\" }}\u003c/span\u003e\n          \u003cspan class=\"na\"\u003epaths\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003e./node_modules\u003c/span\u003e\n\n  \u003cspan class=\"na\"\u003ebuild\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003edocker\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eimage\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ecircleci/node:11.10.1\u003c/span\u003e\n    \u003cspan class=\"na\"\u003esteps\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003echeckout\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erestore_cache\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003ekey\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ev1-dependencies-{{ checksum \"yarn.lock\" }}\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eyarn build\u003c/span\u003e\n\n  \u003cspan class=\"c1\"\u003e# autres jobs...\u003c/span\u003e\n\n\u003cspan class=\"na\"\u003eworkflows\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eversion\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eintegration\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ejobs\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003einstall\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ebuild\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003erequires\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003einstall\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003elint\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003erequires\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003einstall\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003etest\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003erequires\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003einstall\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003edeploy\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003erequires\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003ebuild\u003c/span\u003e\n            \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003elint\u003c/span\u003e\n            \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003etest\u003c/span\u003e\n          \u003cspan class=\"na\"\u003efilters\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"na\"\u003ebranches\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n              \u003cspan class=\"na\"\u003eonly\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003emaster\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eD√©sormais on installe une seule fois les d√©pendances que l'on partage entre les diff√©rents jobs. On n'oublie pas de pr√©ciser que chacun des jobs requiert que le job install ait √©t√© compl√©t√©.\u003c/p\u003e\n\n\u003cp\u003eAvec du cache on gagne environ 20s sur le processus de d√©ploiement.\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--CMZmZ4_X--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/v4xljhbhu526uq29anpv.png\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--CMZmZ4_X--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/v4xljhbhu526uq29anpv.png\" alt=\"circleci-with-cache\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"les-workspaces\" href=\"#les-workspaces\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Les workspaces\n\u003c/h1\u003e\n\n\u003cp\u003eUn workspace est un espace qui permet √† un job de partager des donn√©es avec un job lui succ√©dant.\u003cbr\u003e\nDans notre cas on va construire l'application dans le job de \u003ccode\u003ebuild\u003c/code\u003e, stocker les fichiers statiques dans le workspace pour que le job \u003ccode\u003edeploy\u003c/code\u003e puisse les r√©cup√©rer si n√©cessaire.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight yaml\"\u003e\u003ccode\u003e  \u003cspan class=\"na\"\u003ebuild\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003edocker\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eimage\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ecircleci/node:11.10.1\u003c/span\u003e\n    \u003cspan class=\"na\"\u003esteps\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003echeckout\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erestore_cache\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003ekey\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ev1-dependencies-{{ checksum \"yarn.lock\" }}\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eyarn build\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003epersist_to_workspace\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003eroot\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e~/project\u003c/span\u003e\n          \u003cspan class=\"na\"\u003epaths\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003e./dist\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003epersist_to_workspace\u003c/code\u003e : indique que l'on veut √©crire dans le workspace\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003eroot\u003c/code\u003e : le dossier dans lequel on doit aller chercher l'information, par d√©faut \u003ccode\u003e~/project\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003epaths\u003c/code\u003e : liste des chemins des fichiers/dossiers √† √©crire dans le workspace\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight yaml\"\u003e\u003ccode\u003e\u003cspan class=\"na\"\u003edeploy\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003edocker\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eimage\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ecircleci/node:11.10.1\u003c/span\u003e\n    \u003cspan class=\"na\"\u003esteps\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003echeckout\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erestore_cache\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003ekey\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ev1-dependencies-{{ checksum \"yarn.lock\" }}\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eattach_workspace\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003eat\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e~/project\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eyarn firebase deploy --token \"$FIREBASE_TOKEN\" --only hosting\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eEn utilisant les workspaces en compl√©ment du cache on est parvenu √† gagner une trentaine de secondes par rapport √† la configuration de la premi√®re partie üéâ\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--Maian0hB--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/k0qbfmp2ov6fbyfezgee.png\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--Maian0hB--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/k0qbfmp2ov6fbyfezgee.png\" alt=\"circle-ci-final-build\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"cherries-sur-le-cake-les-executors-et-les-commandes\" href=\"#cherries-sur-le-cake-les-executors-et-les-commandes\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  üçí sur le üç∞ : les executors et les commandes\n\u003c/h1\u003e\n\n\u003cp\u003eIci on peaufine notre configuration  afin d'√©viter un maximum les r√©p√©titions dans notre fichier de configuration.\u003cbr\u003e\nLes \u003ccode\u003ecommands\u003c/code\u003e permettent de factoriser des √©tapes de nos jobs.\u003cbr\u003e\nLes \u003ccode\u003eexecutors\u003c/code\u003e permettent de factoriser les environnements dans lesquels seront ex√©cut√©s nos scripts.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight yaml\"\u003e\u003ccode\u003e\u003cspan class=\"na\"\u003ecommands\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003echeckout_and_restore_cache\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003esteps\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003echeckout\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erestore_cache\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003ekey\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ev1-dependencies-{{ checksum \"yarn.lock\" }}\u003c/span\u003e\n\n\u003cspan class=\"na\"\u003eexecutors\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003enode\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003edocker\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eimage\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ecircleci/node:11.10.1\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eOn peux mettre √† jour nos jobs :\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight yaml\"\u003e\u003ccode\u003e  \u003cspan class=\"na\"\u003einstall\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eexecutor\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003enode\u003c/span\u003e\n    \u003cspan class=\"na\"\u003esteps\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003echeckout_and_restore_cache\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eyarn install\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003esave_cache\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003ekey\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ev1-dependencies-{{ checksum \"yarn.lock\" }}\u003c/span\u003e\n          \u003cspan class=\"na\"\u003epaths\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003e./node_modules\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003ch1\u003e\n  \u003ca name=\"la-configuration-finale\" href=\"#la-configuration-finale\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  La configuration finale\n\u003c/h1\u003e\n\n\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight yaml\"\u003e\u003ccode\u003e\u003cspan class=\"na\"\u003eversion\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"m\"\u003e2.1\u003c/span\u003e\n\n\u003cspan class=\"na\"\u003ecommands\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003echeckout_and_restore_cache\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003esteps\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003echeckout\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erestore_cache\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003ekey\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ev1-dependencies-{{ checksum \"yarn.lock\" }}\u003c/span\u003e\n\n\u003cspan class=\"na\"\u003eexecutors\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003enode\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003edocker\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eimage\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ecircleci/node:11.10.1\u003c/span\u003e\n\n\u003cspan class=\"na\"\u003ejobs\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003einstall\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eexecutor\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003enode\u003c/span\u003e\n    \u003cspan class=\"na\"\u003esteps\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003echeckout_and_restore_cache\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eyarn install\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003esave_cache\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003ekey\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ev1-dependencies-{{ checksum \"yarn.lock\" }}\u003c/span\u003e\n          \u003cspan class=\"na\"\u003epaths\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003e./node_modules\u003c/span\u003e\n\n  \u003cspan class=\"na\"\u003ebuild\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eexecutor\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003enode\u003c/span\u003e\n    \u003cspan class=\"na\"\u003esteps\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003echeckout_and_restore_cache\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eyarn build\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003epersist_to_workspace\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003eroot\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e~/project\u003c/span\u003e\n          \u003cspan class=\"na\"\u003epaths\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003edist/*\u003c/span\u003e\n\n  \u003cspan class=\"na\"\u003elint\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eexecutor\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003enode\u003c/span\u003e\n    \u003cspan class=\"na\"\u003esteps\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003echeckout_and_restore_cache\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eyarn lint\u003c/span\u003e\n\n  \u003cspan class=\"na\"\u003etest\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eexecutor\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003enode\u003c/span\u003e\n    \u003cspan class=\"na\"\u003esteps\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003echeckout_and_restore_cache\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eyarn test:unit\u003c/span\u003e\n\n  \u003cspan class=\"na\"\u003edeploy\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eexecutor\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003enode\u003c/span\u003e\n    \u003cspan class=\"na\"\u003esteps\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003echeckout_and_restore_cache\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eattach_workspace\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003eat\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e~/project\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eyarn firebase deploy --token \"$FIREBASE_TOKEN\" --only hosting\u003c/span\u003e\n\n\u003cspan class=\"na\"\u003eworkflows\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eversion\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eintegration\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ejobs\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003einstall\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ebuild\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003erequires\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003einstall\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003elint\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003erequires\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003einstall\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003etest\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003erequires\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003einstall\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003edeploy\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003erequires\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003ebuild\u003c/span\u003e\n            \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003elint\u003c/span\u003e\n            \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003etest\u003c/span\u003e\n          \u003cspan class=\"na\"\u003efilters\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"na\"\u003ebranches\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n              \u003cspan class=\"na\"\u003eonly\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003emaster\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003ch1\u003e\n  \u003ca name=\"conclusion\" href=\"#conclusion\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Conclusion\n\u003c/h1\u003e\n\n\u003cp\u003eOn a enfin une configuration de bogass üòé \u003cbr\u003e\nPerformante gr√¢ce √† l'utilisation du cache et des workspaces, maintenable gr√¢ce aux commandes et aux executors, sympathique gr√¢ce aux pommes.\u003c/p\u003e\n\n\u003cp\u003eMerci de m'avoir lu.\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"liens-utiles\" href=\"#liens-utiles\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Liens utiles\n\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://circleci.com/docs/2.0/configuration-reference\"\u003eDocument de r√©f√©rence du fichier de configuration\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://github.com/jean-smaug/condorcet/blob/4046a6723fc2c4b6470c79b309683d9f7af9844a/.circleci/config.yml\"\u003eConfiguration finale\u003c/a\u003e\u003c/p\u003e\n\n",
    "social_image": null,
    "body_markdown": "---\ntitle: D√©ploiement continu avec CircleCI - Partie 2\npublished: true\ndescription: Optimisation d'une configuration CircleCI\ncover_image: https://thepracticaldev.s3.amazonaws.com/i/hqxwdv09iz9y9pqxfz04.jpg\ntags: #circleci, #ci, #cd\n---\n\nLa premi√®re partie permettait de d√©couvrir les concepts de base de CircleCI et comment les mettre en application. Dans cette partie on va voir comment aller plus loin en utilisant les diff√©rents moyens permettant de partager de l'information entre les jobs.\n\n# √âtat des lieux\n\n```yml\nversion: 2.1\njobs:\n  build:\n    docker:\n      - image: circleci/node:11.10.1\n    steps:\n      - checkout\n      - run: yarn install\n      - run: yarn build\n\n  lint:\n    docker:\n      - image: circleci/node:11.10.1\n    steps:\n      - checkout\n      - run: yarn install\n      - run: yarn lint\n\n  test:\n    docker:\n      - image: circleci/node:11.10.1\n    steps:\n      - checkout\n      - run: yarn install\n      - run: yarn test:unit\n\n  deploy:\n    docker:\n      - image: circleci/node:11.10.1\n    steps:\n      - checkout\n      - run: yarn install\n      - run: yarn build\n      - run: yarn firebase deploy --token \"$FIREBASE_TOKEN\" --only hosting\n\nworkflows:\n  version: 2\n  integration:\n    jobs:\n      - build\n      - lint\n      - test\n    - deploy:\n          requires:\n            - build\n            - lint\n            - test\n          filters:\n            branches:\n              only: master\n```\n\nNotre configuration fonctionne mais on voit que l'on se r√©p√®te. Chacun des jobs contient ces lignes :\n\n```yml\n    docker:\n      - image: circleci/node:11.10.1\n    steps:\n      - checkout\n      - run: yarn install\n```\n\nLes deux premi√®res lignes, celles de la configuration de l'environnement d'ex√©cution, sont juste une r√©p√©tition au sein du fichier de configuration, elles n'ont pas d'impact sur les performances. Mais par soucis de maintenabilit√© on utilisera les executors et les commands pour factoriser ces fragments.\n\nDeuxi√®me probl√®me, chaque job est oblig√© de r√©installer les d√©pendances car ils ex√©cutent leurs instructions dans un environnement isol√©.\nPour pallier ce probl√®me on va installer les d√©pendances, les stocker en cache pour qu'elles puissent √™tre partag√©es par les jobs d'un workflow. Les d√©pendances mises en cache pourront aussi √™tre utilis√©es par les jobs futurs.\n\nLe dernier probl√®me est la n√©cessit√© de devoir re-construire l'application de production dans le job de d√©ploiement alors que cette √©tape a √©t√© r√©alis√©e par le job de build. Encore une fois le probl√®me vient du fait que les jobs sont isol√©s. Par d√©faut le job de d√©ploiement ne peut pas lire ce qui a √©t√© g√©n√©r√© par le job de build. On utilisera les workspaces pour r√©soudre ce souci.\n\n# Cacher les d√©pendances\n\nPour utiliser le cache on va d√©finir un nouveau job charg√© d'installer nos d√©pendances :\n\n```yml\n  install:\n    docker:\n      - image: circleci/node:11.10.1\n    steps:\n      - checkout\n      - restore_cache:\n          key: v1-dependencies-{{ checksum \"yarn.lock\" }}\n      - run: yarn install\n      - save_cache:\n          key: v1-dependencies-{{ checksum \"yarn.lock\" }}\n          paths:\n            - ./node_modules\n```\n- `restore_cache` : restore le cache pour une cl√© donn√©e\n    - `key` : cl√© de restauration du cache\n- `save_cache` : sauvegarde des fichiers en cache\n    - `key` : cl√© de stockage du cache\n    - `paths` : les elements √† stocker, ici les node_modules\n\nCette √©tape tente de restaurer le cache contenant les `node_modules` permettant ainsi de passer l'√©tape d'installation des d√©pendances.\n \nNB : la cl√© de cache contient un hash de notre fichier `yarn.lock`, g√©n√©r√© par la fonction checksum. Donc si le fichier change, le hash change et le cache est re-g√©n√©r√©.\n\nOn peut mettre √† jour les autres jobs de notre configuration pour qu'ils utilisent le cache :\n\n```yml\nversion: 2\njobs:\n  install:\n    docker:\n      - image: circleci/node:11.10.1\n    steps:\n      - checkout\n      - restore_cache:\n          key: v1-dependencies-{{ checksum \"yarn.lock\" }}\n      - run: yarn install\n      - save_cache:\n          key: v1-dependencies-{{ checksum \"yarn.lock\" }}\n          paths:\n            - ./node_modules\n\n  build:\n    docker:\n      - image: circleci/node:11.10.1\n    steps:\n      - checkout\n      - restore_cache:\n          key: v1-dependencies-{{ checksum \"yarn.lock\" }}\n      - run: yarn build\n\n  # autres jobs...\n\nworkflows:\n  version: 2\n  integration:\n    jobs:\n      - install\n      - build:\n          requires:\n            - install\n      - lint:\n          requires:\n            - install\n      - test:\n          requires:\n            - install\n    - deploy:\n          requires:\n            - build\n            - lint\n            - test\n          filters:\n            branches:\n              only: master\n```\n\nD√©sormais on installe une seule fois les d√©pendances que l'on partage entre les diff√©rents jobs. On n'oublie pas de pr√©ciser que chacun des jobs requiert que le job install ait √©t√© compl√©t√©.\n\nAvec du cache on gagne environ 20s sur le processus de d√©ploiement.\n\n![circleci-with-cache](https://thepracticaldev.s3.amazonaws.com/i/v4xljhbhu526uq29anpv.png)\n\n# Les workspaces\n\nUn workspace est un espace qui permet √† un job de partager des donn√©es avec un job lui succ√©dant.\nDans notre cas on va construire l'application dans le job de `build`, stocker les fichiers statiques dans le workspace pour que le job `deploy` puisse les r√©cup√©rer si n√©cessaire.\n\n```yml\n  build:\n    docker:\n      - image: circleci/node:11.10.1\n    steps:\n      - checkout\n      - restore_cache:\n          key: v1-dependencies-{{ checksum \"yarn.lock\" }}\n      - run: yarn build\n      - persist_to_workspace:\n          root: ~/project\n          paths:\n            - ./dist\n```\n\n- `persist_to_workspace` : indique que l'on veut √©crire dans le workspace\n    - `root` : le dossier dans lequel on doit aller chercher l'information, par d√©faut `~/project`\n    - `paths` : liste des chemins des fichiers/dossiers √† √©crire dans le workspace\n\n```yml\ndeploy:\n    docker:\n      - image: circleci/node:11.10.1\n    steps:\n      - checkout\n      - restore_cache:\n          key: v1-dependencies-{{ checksum \"yarn.lock\" }}\n      - attach_workspace:\n          at: ~/project\n      - run: yarn firebase deploy --token \"$FIREBASE_TOKEN\" --only hosting\n```\n\nEn utilisant les workspaces en compl√©ment du cache on est parvenu √† gagner une trentaine de secondes par rapport √† la configuration de la premi√®re partie :tada:\n\n![circle-ci-final-build](https://thepracticaldev.s3.amazonaws.com/i/k0qbfmp2ov6fbyfezgee.png)\n\n\n# :cherries: sur le :cake: : les executors et les commandes\n\nIci on peaufine notre configuration  afin d'√©viter un maximum les r√©p√©titions dans notre fichier de configuration.\nLes `commands` permettent de factoriser des √©tapes de nos jobs.\nLes `executors` permettent de factoriser les environnements dans lesquels seront ex√©cut√©s nos scripts.\n\n```yml\ncommands:\n  checkout_and_restore_cache:\n    steps:\n      - checkout\n      - restore_cache:\n          key: v1-dependencies-{{ checksum \"yarn.lock\" }}\n\nexecutors:\n  node:\n    docker:\n      - image: circleci/node:11.10.1\n```\n\nOn peux mettre √† jour nos jobs :\n\n```yml\n  install:\n    executor: node\n    steps:\n      - checkout_and_restore_cache\n      - run: yarn install\n      - save_cache:\n          key: v1-dependencies-{{ checksum \"yarn.lock\" }}\n          paths:\n            - ./node_modules\n```\n\n# La configuration finale\n\n```yml\nversion: 2.1\n\ncommands:\n  checkout_and_restore_cache:\n    steps:\n      - checkout\n      - restore_cache:\n          key: v1-dependencies-{{ checksum \"yarn.lock\" }}\n\nexecutors:\n  node:\n    docker:\n      - image: circleci/node:11.10.1\n\njobs:\n  install:\n    executor: node\n    steps:\n      - checkout_and_restore_cache\n      - run: yarn install\n      - save_cache:\n          key: v1-dependencies-{{ checksum \"yarn.lock\" }}\n          paths:\n            - ./node_modules\n\n  build:\n    executor: node\n    steps:\n      - checkout_and_restore_cache\n      - run: yarn build\n      - persist_to_workspace:\n          root: ~/project\n          paths:\n            - dist/*\n\n  lint:\n    executor: node\n    steps:\n      - checkout_and_restore_cache\n      - run: yarn lint\n\n  test:\n    executor: node\n    steps:\n      - checkout_and_restore_cache\n      - run: yarn test:unit\n\n  deploy:\n    executor: node\n    steps:\n      - checkout_and_restore_cache\n      - attach_workspace:\n          at: ~/project\n      - run: yarn firebase deploy --token \"$FIREBASE_TOKEN\" --only hosting\n\nworkflows:\n  version: 2\n  integration:\n    jobs:\n      - install\n      - build:\n          requires:\n            - install\n      - lint:\n          requires:\n            - install\n      - test:\n          requires:\n            - install\n      - deploy:\n          requires:\n            - build\n            - lint\n            - test\n          filters:\n            branches:\n              only: master\n```\n\n# Conclusion\n\nOn a enfin une configuration de bogass :sunglasses: \nPerformante gr√¢ce √† l'utilisation du cache et des workspaces, maintenable gr√¢ce aux commandes et aux executors, sympathique gr√¢ce aux pommes.\n\nMerci de m'avoir lu.\n\n# Liens utiles\n[Document de r√©f√©rence du fichier de configuration](https://circleci.com/docs/2.0/configuration-reference)\n[Configuration finale](https://github.com/jean-smaug/condorcet/blob/4046a6723fc2c4b6470c79b309683d9f7af9844a/.circleci/config.yml)",
    "canonical_url": null,
    "show_comments": true,
    "main_image_background_hex_color": "#dddddd",
    "published_from_feed": false,
    "comments_count": 1,
    "video": null,
    "video_code": null,
    "video_source_url": null,
    "video_thumbnail_url": null,
    "video_closed_caption_track_url": null,
    "feed_source_url": null,
    "positive_reactions_count": 11,
    "edited_at": "2019-11-01T08:40:30.296Z",
    "crossposted_at": null,
    "language": "fr",
    "cached_tag_list": "circleci, ci, cd",
    "path": "/jeansmaug/dploiement-continu-avec-circleci---partie-2-6op",
    "cached_user_name": "jean-smaug",
    "cached_user_username": "jeansmaug",
    "last_comment_at": "2019-04-29T08:50:24.363Z"
  },
  {
    "title": "Phoenix¬†: changer de¬†bundler",
    "slug": "phoenix-changer-de-bundler-4339",
    "created_at": "2019-03-21T12:53:02.337Z",
    "main_image": "https://thepracticaldev.s3.amazonaws.com/i/nwfjogn36lospzcf659y.png",
    "description": "Exemple de changement de bundler au sein de Phoenix en utilisant Parcel plut√¥t que Webpack",
    "published": true,
    "published_at": "2019-03-29T20:01:55.908Z",
    "processed_html": "\u003ch1\u003e\n  \u003ca name=\"initialisation\" href=\"#initialisation\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Initialisation\n\u003c/h1\u003e\n\n\u003cp\u003eDepuis sa version 1.4, Phoenix embarque Webpack pour bundler les diff√©rentes d√©pendances. Nous allons voir qu'il est facile de changer d'outil en prenant \u003ca href=\"https://parceljs.org\"\u003eParcel\u003c/a\u003e comme exemple. \u003cbr\u003e\nCet outil a l'avantage de ne pas n√©cessiter de configuration pour fonctionner.\u003c/p\u003e\n\n\u003cp\u003eCr√©ons un nouveau projet, sans \"ecto\" pour ne pas avoir besoin de configurer une base de donn√©es.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight shell\"\u003e\u003ccode\u003emix phx.new app \u003cspan class=\"nt\"\u003e--no-ecto\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eLan√ßons le serveur de Phoenix.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight shell\"\u003e\u003ccode\u003emix phx.server\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003ePhoenix ex√©cute Webpack pour nous et √©coute les changements de fichiers pour nous apporter les modifications en hot reload.\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--ulu-enA_--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/e5vss7cdew0xx0rzvtyo.png\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--ulu-enA_--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/e5vss7cdew0xx0rzvtyo.png\" alt=\"phoenix-launch-webpack\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eSi j'√©dite le fichier \u003ccode\u003eassets/css/app.css\u003c/code\u003e pour changer la couleur de fond du body on peut voir le changement sans recharger la page.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight css\"\u003e\u003ccode\u003e\u003cspan class=\"c\"\u003e/* This file is for your main application css. */\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003e@import\u003c/span\u003e \u003cspan class=\"s1\"\u003e\"./phoenix.css\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"nt\"\u003ebody\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nl\"\u003ebackground\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"no\"\u003edarkgray\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--Y0ibsU2u--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/m9gzbiqplq37po3bghfn.png\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--Y0ibsU2u--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/m9gzbiqplq37po3bghfn.png\" alt=\"webpack-change-color\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eNotre but est donc de garder ce comportement, qui offre un confort de d√©veloppement, mais en utilisant un autre outil.\u003c/p\u003e\n\n\u003cp\u003eWebpack build nos assets √† destination de \u003ccode\u003epriv/static\u003c/code\u003e. Phoenix n√©cessite que nos fichiers statiques soient build√©s √† destination de ce dossier. \u003ca href=\"https://hexdocs.pm/plug/Plug.Static.html\"\u003eCela reste n√©anmoins configurable\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--e3pZVJ52--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/rddnm8321om1epvab885.png\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--e3pZVJ52--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/rddnm8321om1epvab885.png\" alt=\"webpack-build\" loading=\"lazy\"\u003e\u003c/a\u003e \u003c/p\u003e\n\n\u003cp\u003eAvant de continuer coupons notre serveur et supprimons le dossier g√©n√©r√© par Webpack pour partir sur une base propre\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight shell\"\u003e\u003ccode\u003e\u003cspan class=\"nb\"\u003erm\u003c/span\u003e \u003cspan class=\"nt\"\u003e-rf\u003c/span\u003e priv/static\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003ch1\u003e\n  \u003ca name=\"configuration-de-parcel-au-sein-de-phoenix\" href=\"#configuration-de-parcel-au-sein-de-phoenix\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Configuration de Parcel au sein de Phoenix\n\u003c/h1\u003e\n\n\u003cp\u003eInstallons Parcel ainsi qu'un plugin magique dont le d√©tail ne rentre pas dans le cadre de cet article.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight shell\"\u003e\u003ccode\u003e\u003cspan class=\"nb\"\u003ecd \u003c/span\u003eassets/ \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e npm \u003cspan class=\"nb\"\u003einstall\u003c/span\u003e \u003cspan class=\"nt\"\u003e--save-dev\u003c/span\u003e parcel-bundler parcel-plugin-static-files-copy\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eDans le fichiers \u003ccode\u003econfig/dev.exs\u003c/code\u003e il faut remplacer\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight elixir\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003econfig\u003c/span\u003e \u003cspan class=\"ss\"\u003e:app\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"no\"\u003eAppWeb\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"no\"\u003eEndpoint\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"ss\"\u003ehttp:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"ss\"\u003eport:\u003c/span\u003e \u003cspan class=\"mi\"\u003e4000\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n  \u003cspan class=\"ss\"\u003edebug_errors:\u003c/span\u003e \u003cspan class=\"no\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"ss\"\u003ecode_reloader:\u003c/span\u003e \u003cspan class=\"no\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"ss\"\u003echeck_origin:\u003c/span\u003e \u003cspan class=\"no\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"ss\"\u003ewatchers:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\n    \u003cspan class=\"ss\"\u003enode:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\n      \u003cspan class=\"s2\"\u003e\"node_modules/webpack/bin/webpack.js\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"s2\"\u003e\"--mode\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"s2\"\u003e\"development\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"s2\"\u003e\"--watch-stdin\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"ss\"\u003ecd:\u003c/span\u003e \u003cspan class=\"no\"\u003ePath\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eexpand\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"../assets\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003e__DIR__\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e]\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003epar\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight elixir\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003econfig\u003c/span\u003e \u003cspan class=\"ss\"\u003e:app\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"no\"\u003eAppWeb\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"no\"\u003eEndpoint\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"ss\"\u003ehttp:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"ss\"\u003eport:\u003c/span\u003e \u003cspan class=\"mi\"\u003e4000\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n  \u003cspan class=\"ss\"\u003edebug_errors:\u003c/span\u003e \u003cspan class=\"no\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"ss\"\u003ecode_reloader:\u003c/span\u003e \u003cspan class=\"no\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"ss\"\u003echeck_origin:\u003c/span\u003e \u003cspan class=\"no\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"ss\"\u003ewatchers:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\n    \u003cspan class=\"ss\"\u003enode:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\n      \u003cspan class=\"s2\"\u003e\"node_modules/.bin/parcel\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"s2\"\u003e\"watch\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"s2\"\u003e\"js/app.js\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"s2\"\u003e\"-d\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"s2\"\u003e\"../priv/static\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"ss\"\u003ecd:\u003c/span\u003e \u003cspan class=\"no\"\u003ePath\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eexpand\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"../assets\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003e__DIR__\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e]\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eD√©sormais lorsque nous lan√ßons un \u003ccode\u003emix phx.server\u003c/code\u003e nous pouvons voir que Phoenix lance d√©sormais Parcel. \u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--tf_wbqUk--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/vrnxkb0eqfiesej2yogc.png\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--tf_wbqUk--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/vrnxkb0eqfiesej2yogc.png\" alt=\"phoenix-launch-parcel\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eEt le dossier de destination est bien \u003ccode\u003epriv/static\u003c/code\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--ybeBVC9_--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/i9nujjx3va2vkbgdaus2.png\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--ybeBVC9_--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/i9nujjx3va2vkbgdaus2.png\" alt=\"build-parcel-priv\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eMais malheureusement, nos css et js ne sont plus charg√©s\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--Rhi0mOV_--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/xdg3nkxf08k5a93kg2e1.png\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--Rhi0mOV_--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/xdg3nkxf08k5a93kg2e1.png\" alt=\"broken-page\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eWebpack g√©n√©rait un dossier \u003ccode\u003ecss\u003c/code\u003e et un dossier \u003ccode\u003ejs\u003c/code\u003e contenant chacun leur bundle. Parcel se passe des dossiers interm√©diaires. Il faut donc aller mettre √† jour les chemins des fichiers import√©s dans le template \u003ccode\u003elib/app_web/templates/layout/app.html.eex\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eOn remplace\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight elixir\"\u003e\u003ccode\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003e!DOCTYPE\u003c/span\u003e \u003cspan class=\"n\"\u003ehtml\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ehtml\u003c/span\u003e \u003cspan class=\"n\"\u003elang\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"en\"\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ehead\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003elink\u003c/span\u003e \u003cspan class=\"n\"\u003erel\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"stylesheet\"\u003c/span\u003e \u003cspan class=\"n\"\u003ehref\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"\u0026lt;%= Routes.static_path(@conn, \"\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003ecss\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eapp\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecss\u003c/span\u003e\u003cspan class=\"s2\"\u003e\") %\u0026gt;\"\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003ehead\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ebody\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e###\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003escript\u003c/span\u003e \u003cspan class=\"n\"\u003etype\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"text/javascript\"\u003c/span\u003e \u003cspan class=\"n\"\u003esrc\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"\u0026lt;%= Routes.static_path(@conn, \"\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003ejs\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eapp\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ejs\u003c/span\u003e\u003cspan class=\"s2\"\u003e\") %\u0026gt;\"\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003escript\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003ebody\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003ehtml\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003epar\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight elixir\"\u003e\u003ccode\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003e!DOCTYPE\u003c/span\u003e \u003cspan class=\"n\"\u003ehtml\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ehtml\u003c/span\u003e \u003cspan class=\"n\"\u003elang\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"en\"\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ehead\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003elink\u003c/span\u003e \u003cspan class=\"n\"\u003erel\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"stylesheet\"\u003c/span\u003e \u003cspan class=\"n\"\u003ehref\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"\u0026lt;%= Routes.static_path(@conn, \"\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eapp\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecss\u003c/span\u003e\u003cspan class=\"s2\"\u003e\") %\u0026gt;\"\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003ehead\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ebody\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e###\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003escript\u003c/span\u003e \u003cspan class=\"n\"\u003etype\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"text/javascript\"\u003c/span\u003e \u003cspan class=\"n\"\u003esrc\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"\u0026lt;%= Routes.static_path(@conn, \"\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eapp\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ejs\u003c/span\u003e\u003cspan class=\"s2\"\u003e\") %\u0026gt;\"\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003escript\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003ebody\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003ehtml\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eEt üéâ, √ßa ne marche pas üò¢\u003c/p\u003e\n\n\u003cp\u003eCe comportement vient du fait que Phoenix autorise uniquement les fichiers respectant certains patterns √† √™tre servi comme fichiers statiques. Ces patterns sont configurables dans le fichiers \u003ccode\u003elib/app_web/endpoint.ex\u003c/code\u003e\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight elixir\"\u003e\u003ccode\u003e  \u003cspan class=\"n\"\u003eplug\u003c/span\u003e \u003cspan class=\"no\"\u003ePlug\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"no\"\u003eStatic\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"ss\"\u003eat:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"/\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"ss\"\u003efrom:\u003c/span\u003e \u003cspan class=\"ss\"\u003e:app\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"ss\"\u003egzip:\u003c/span\u003e \u003cspan class=\"no\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"ss\"\u003eonly:\u003c/span\u003e \u003cspan class=\"sx\"\u003e~w(css fonts images js favicon.ico robots.txt)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eCette configuration signifie que seul les fichiers pr√©sents dans les dossiers \u003ccode\u003ecss\u003c/code\u003e \u003ccode\u003efonts\u003c/code\u003e \u003ccode\u003eimages\u003c/code\u003e \u003ccode\u003ejs\u003c/code\u003e ou les fichiers \u003ccode\u003efavicon.ico\u003c/code\u003e et \u003ccode\u003erobots.txt\u003c/code\u003e sont autoris√©s √† √™tre servi par Phoenix. Ces dossiers doivent bien entendu √™tre pr√©sent dans \u003ccode\u003epriv/static\u003c/code\u003e üòâ\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight elixir\"\u003e\u003ccode\u003e  \u003cspan class=\"n\"\u003eplug\u003c/span\u003e \u003cspan class=\"no\"\u003ePlug\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"no\"\u003eStatic\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"ss\"\u003eat:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"/\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"ss\"\u003efrom:\u003c/span\u003e \u003cspan class=\"ss\"\u003e:app\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"ss\"\u003egzip:\u003c/span\u003e \u003cspan class=\"no\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"ss\"\u003eonly:\u003c/span\u003e \u003cspan class=\"sx\"\u003e~w(app.css fonts images app.js favicon.ico robots.txt)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eComme nous n'avons pas de dossiers interm√©diaires \u003ccode\u003ecss\u003c/code\u003e et \u003ccode\u003ejs\u003c/code\u003e nous les rempla√ßons par les fichiers \u003ccode\u003eapp.css\u003c/code\u003e et \u003ccode\u003eapp.js\u003c/code\u003e g√©n√©r√© par Parcel.\u003c/p\u003e\n\n\u003cp\u003eMaintenant l'application fonctionne correctement. Si j'√©dite le fichier \u003ccode\u003eassets/js/app.js\u003c/code\u003e pour y ajouter un \u003ccode\u003econsole.log\u003c/code\u003e\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003ephoenix_html\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"nx\"\u003ecss\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e../css/app.css\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eMeeeeeeeeh\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eUn \"Meeeeeeeeh\" apparait dans la console de notre navigateur sans avoir besoin de recharger la page üéâ\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--VBJTwU80--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/hfxw2yb5q9qzcrz0joxh.png\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--VBJTwU80--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/hfxw2yb5q9qzcrz0joxh.png\" alt=\"meeeeeh\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"nettoyage\" href=\"#nettoyage\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Nettoyage\n\u003c/h1\u003e\n\n\u003cp\u003eMaintenant que nous avons ajout√© Parcel il ne nous reste plus qu'a supprimer les vestiges de Webpack :\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight shell\"\u003e\u003ccode\u003e\u003cspan class=\"nb\"\u003ecd \u003c/span\u003eassets \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e npm uninstall babel-loader copy-webpack-plugin css-loader mini-css-extract-plugin optimize-css-assets-webpack-plugin uglifyjs-webpack-plugin webpack webpack-cli \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"nb\"\u003erm \u003c/span\u003ewebpack.config.js\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003ch1\u003e\n  \u003ca name=\"conclusion\" href=\"#conclusion\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Conclusion\n\u003c/h1\u003e\n\n\u003cp\u003ePeut importe que vous choisissiez de garder Webpack, d'utiliser Rollup, Parcel‚Ä¶ Si vous choisissez de modifier la configuration de votre bundler, il faut penser √†¬†:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003econfigurer correctement son bundler (facile avec Parcel)\u003c/li\u003e\n\u003cli\u003echanger le script surveillant les modifications de fichiers (dev.exs)\u003c/li\u003e\n\u003cli\u003eveiller √† ce que le fichiers statiques puissent √™tre servi correctement (endpoint.ex)\u003c/li\u003e\n\u003cli\u003emodifier les chemins dans les templates (app.html.eex)\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"liens-utiles\" href=\"#liens-utiles\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Liens utiles\n\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003eJe me suis inspir√© de \u003ca href=\"https://github.com/ben-pr-p/elixir-phoenix-parcel-example\"\u003ece d√©p√¥t Github\u003c/a\u003e. La base de code reprend la structure d'une ancienne version de Phoenix, ne l'utilisez pas tel quel si vous voulez √™tre √† jour.\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://medium.com/@_MaximeBlanc/phoenix-changer-de-bundler-e53f00110740\"\u003eMon ancien article\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://hexdocs.pm/phoenix/Phoenix.Endpoint.html#module-runtime-configuration\"\u003eLa documentation sur la configuration du Endpoint\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n",
    "social_image": null,
    "body_markdown": "---\r\ntitle: Phoenix¬†: changer de¬†bundler\r\npublished: true\r\ndescription: Exemple de changement de bundler au sein de Phoenix en utilisant Parcel plut√¥t que Webpack\r\ncover_image: https://thepracticaldev.s3.amazonaws.com/i/nwfjogn36lospzcf659y.png\r\ntags: #elixir, #phoenix, #webpack, #parcel\r\n---\r\n\r\n# Initialisation\r\n\r\nDepuis sa version 1.4, Phoenix embarque Webpack pour bundler les diff√©rentes d√©pendances. Nous allons voir qu'il est facile de changer d'outil en prenant [Parcel](https://parceljs.org) comme exemple. \r\nCet outil a l'avantage de ne pas n√©cessiter de configuration pour fonctionner.\r\n\r\nCr√©ons un nouveau projet, sans \"ecto\" pour ne pas avoir besoin de configurer une base de donn√©es.\r\n\r\n```shell\r\nmix phx.new app --no-ecto\r\n```\r\n\r\nLan√ßons le serveur de Phoenix.\r\n\r\n```shell\r\nmix phx.server\r\n```\r\n\r\nPhoenix ex√©cute Webpack pour nous et √©coute les changements de fichiers pour nous apporter les modifications en hot reload.\r\n\r\n![phoenix-launch-webpack](https://thepracticaldev.s3.amazonaws.com/i/e5vss7cdew0xx0rzvtyo.png)\r\n\r\nSi j'√©dite le fichier `assets/css/app.css` pour changer la couleur de fond du body on peut voir le changement sans recharger la page.\r\n\r\n```css\r\n/* This file is for your main application css. */\r\n\r\n@import \"./phoenix.css\";\r\n\r\nbody {\r\n    background: darkgray;\r\n}\r\n```\r\n\r\n![webpack-change-color](https://thepracticaldev.s3.amazonaws.com/i/m9gzbiqplq37po3bghfn.png)\r\n\r\nNotre but est donc de garder ce comportement, qui offre un confort de d√©veloppement, mais en utilisant un autre outil.\r\n\r\nWebpack build nos assets √† destination de `priv/static`. Phoenix n√©cessite que nos fichiers statiques soient build√©s √† destination de ce dossier. [Cela reste n√©anmoins configurable](https://hexdocs.pm/plug/Plug.Static.html)\r\n\r\n![webpack-build](https://thepracticaldev.s3.amazonaws.com/i/rddnm8321om1epvab885.png) \r\n\r\nAvant de continuer coupons notre serveur et supprimons le dossier g√©n√©r√© par Webpack pour partir sur une base propre\r\n\r\n```shell\r\nrm -rf priv/static\r\n```\r\n\r\n# Configuration de Parcel au sein de Phoenix\r\n\r\nInstallons Parcel ainsi qu'un plugin magique dont le d√©tail ne rentre pas dans le cadre de cet article.\r\n\r\n```shell\r\ncd assets/ \u0026\u0026 npm install --save-dev parcel-bundler parcel-plugin-static-files-copy\r\n```\r\n\r\nDans le fichiers `config/dev.exs` il faut remplacer\r\n\r\n```elixir\r\nconfig :app, AppWeb.Endpoint,\r\n  http: [port: 4000],\r\n  debug_errors: true,\r\n  code_reloader: true,\r\n  check_origin: false,\r\n  watchers: [\r\n    node: [\r\n      \"node_modules/webpack/bin/webpack.js\",\r\n      \"--mode\",\r\n      \"development\",\r\n      \"--watch-stdin\",\r\n      cd: Path.expand(\"../assets\", __DIR__)\r\n    ]\r\n  ]\r\n```\r\n\r\npar \r\n\r\n```elixir\r\nconfig :app, AppWeb.Endpoint,\r\n  http: [port: 4000],\r\n  debug_errors: true,\r\n  code_reloader: true,\r\n  check_origin: false,\r\n  watchers: [\r\n    node: [\r\n      \"node_modules/.bin/parcel\",\r\n      \"watch\",\r\n      \"js/app.js\",\r\n      \"-d\",\r\n      \"../priv/static\",\r\n      cd: Path.expand(\"../assets\", __DIR__)\r\n    ]\r\n  ]\r\n```\r\n\r\nD√©sormais lorsque nous lan√ßons un `mix phx.server` nous pouvons voir que Phoenix lance d√©sormais Parcel. \r\n\r\n![phoenix-launch-parcel](https://thepracticaldev.s3.amazonaws.com/i/vrnxkb0eqfiesej2yogc.png)\r\n\r\nEt le dossier de destination est bien `priv/static`\r\n\r\n![build-parcel-priv](https://thepracticaldev.s3.amazonaws.com/i/i9nujjx3va2vkbgdaus2.png)\r\n\r\nMais malheureusement, nos css et js ne sont plus charg√©s\r\n\r\n![broken-page](https://thepracticaldev.s3.amazonaws.com/i/xdg3nkxf08k5a93kg2e1.png)\r\n\r\nWebpack g√©n√©rait un dossier `css` et un dossier `js` contenant chacun leur bundle. Parcel se passe des dossiers interm√©diaires. Il faut donc aller mettre √† jour les chemins des fichiers import√©s dans le template `lib/app_web/templates/layout/app.html.eex`.\r\n\r\nOn remplace\r\n\r\n```elixir\r\n\u003c!DOCTYPE html\u003e\r\n\u003chtml lang=\"en\"\u003e\r\n  \u003chead\u003e\r\n    \u003clink rel=\"stylesheet\" href=\"\u003c%= Routes.static_path(@conn, \"/css/app.css\") %\u003e\"/\u003e\r\n  \u003c/head\u003e\r\n  \u003cbody\u003e\r\n    ###\r\n    \u003cscript type=\"text/javascript\" src=\"\u003c%= Routes.static_path(@conn, \"/js/app.js\") %\u003e\"\u003e\u003c/script\u003e\r\n  \u003c/body\u003e\r\n\u003c/html\u003e\r\n```\r\n\r\npar\r\n\r\n```elixir\r\n\u003c!DOCTYPE html\u003e\r\n\u003chtml lang=\"en\"\u003e\r\n  \u003chead\u003e\r\n    \u003clink rel=\"stylesheet\" href=\"\u003c%= Routes.static_path(@conn, \"/app.css\") %\u003e\"/\u003e\r\n  \u003c/head\u003e\r\n  \u003cbody\u003e\r\n    ###\r\n    \u003cscript type=\"text/javascript\" src=\"\u003c%= Routes.static_path(@conn, \"/app.js\") %\u003e\"\u003e\u003c/script\u003e\r\n  \u003c/body\u003e\r\n\u003c/html\u003e\r\n```\r\n\r\nEt :tada:, √ßa ne marche pas :cry:\r\n\r\nCe comportement vient du fait que Phoenix autorise uniquement les fichiers respectant certains patterns √† √™tre servi comme fichiers statiques. Ces patterns sont configurables dans le fichiers `lib/app_web/endpoint.ex`\r\n\r\n```elixir\r\n  plug Plug.Static,\r\n    at: \"/\",\r\n    from: :app,\r\n    gzip: false,\r\n    only: ~w(css fonts images js favicon.ico robots.txt)\r\n```\r\n\r\nCette configuration signifie que seul les fichiers pr√©sents dans les dossiers `css` `fonts` `images` `js` ou les fichiers `favicon.ico` et `robots.txt` sont autoris√©s √† √™tre servi par Phoenix. Ces dossiers doivent bien entendu √™tre pr√©sent dans `priv/static` :wink:\r\n\r\n```elixir\r\n  plug Plug.Static,\r\n    at: \"/\",\r\n    from: :app,\r\n    gzip: false,\r\n    only: ~w(app.css fonts images app.js favicon.ico robots.txt)\r\n```\r\n\r\nComme nous n'avons pas de dossiers interm√©diaires `css` et `js` nous les rempla√ßons par les fichiers `app.css` et `app.js` g√©n√©r√© par Parcel.\r\n\r\nMaintenant l'application fonctionne correctement. Si j'√©dite le fichier `assets/js/app.js` pour y ajouter un `console.log`\r\n\r\n```js\r\nimport \"phoenix_html\";\r\nimport css from \"../css/app.css\";\r\n\r\nconsole.log(\"Meeeeeeeeh\");\r\n```\r\n\r\nUn \"Meeeeeeeeh\" apparait dans la console de notre navigateur sans avoir besoin de recharger la page :tada:\r\n\r\n\r\n![meeeeeh](https://thepracticaldev.s3.amazonaws.com/i/hfxw2yb5q9qzcrz0joxh.png)\r\n\r\n# Nettoyage\r\n\r\nMaintenant que nous avons ajout√© Parcel il ne nous reste plus qu'a supprimer les vestiges de Webpack :\r\n\r\n```shell\r\ncd assets \u0026\u0026 npm uninstall babel-loader copy-webpack-plugin css-loader mini-css-extract-plugin optimize-css-assets-webpack-plugin uglifyjs-webpack-plugin webpack webpack-cli \u0026\u0026 rm webpack.config.js\r\n```\r\n\r\n# Conclusion\r\n\r\nPeut importe que vous choisissiez de garder Webpack, d'utiliser Rollup, Parcel‚Ä¶ Si vous choisissez de modifier la configuration de votre bundler, il faut penser √†¬†:\r\n- configurer correctement son bundler (facile avec Parcel)\r\n- changer le script surveillant les modifications de fichiers (dev.exs)\r\n- veiller √† ce que le fichiers statiques puissent √™tre servi correctement (endpoint.ex)\r\n- modifier les chemins dans les templates (app.html.eex)\r\n\r\n# Liens utiles\r\n- Je me suis inspir√© de [ce d√©p√¥t Github](https://github.com/ben-pr-p/elixir-phoenix-parcel-example). La base de code reprend la structure d'une ancienne version de Phoenix, ne l'utilisez pas tel quel si vous voulez √™tre √† jour.\r\n- [Mon ancien article](https://medium.com/@_MaximeBlanc/phoenix-changer-de-bundler-e53f00110740)\r\n- [La documentation sur la configuration du Endpoint](https://hexdocs.pm/phoenix/Phoenix.Endpoint.html#module-runtime-configuration)",
    "canonical_url": null,
    "show_comments": true,
    "main_image_background_hex_color": "#dddddd",
    "published_from_feed": false,
    "comments_count": 6,
    "video": null,
    "video_code": null,
    "video_source_url": null,
    "video_thumbnail_url": null,
    "video_closed_caption_track_url": null,
    "feed_source_url": null,
    "positive_reactions_count": 4,
    "edited_at": "2019-03-30T15:52:55.208Z",
    "crossposted_at": null,
    "language": null,
    "cached_tag_list": "elixir, phoenix, webpack, parcel",
    "path": "/jeansmaug/phoenix-changer-de-bundler-4339",
    "cached_user_name": "jean-smaug",
    "cached_user_username": "jeansmaug",
    "last_comment_at": "2019-10-11T19:21:35.487Z"
  },
  {
    "title": "La testocumentation",
    "slug": "la-testocumentation-1gnm",
    "created_at": "2019-09-17T10:29:27.693Z",
    "main_image": "https://thepracticaldev.s3.amazonaws.com/i/xqvbxn3f5npir0t5s0os.png",
    "description": "La testocumentation est un n√©ologisme utilis√© par absolument personne pour d√©crire la fusion entre des tests et de la documentation.",
    "published": true,
    "published_at": "2019-09-17T10:51:23.352Z",
    "processed_html": "\u003cp\u003eJ'√©tais en train de cr√©er une API avec \u003ca href=\"https://adonisjs.com/docs/4.1/installation\"\u003eAdonis\u003c/a\u003e, un framework Node.JS, quand je me suis dit : \"Il serait peut-√™tre temps de faire des tests\".\u003c/p\u003e\n\n\u003cp\u003e√âtant en phase exp√©rimentale et n'√©tant pas certain de conserver Adonis voir m√™me Node pour mon projet, j'ai commenc√© √† regarder les frameworks de tests agnostiques. Je suis tomb√© sur \u003ca href=\"https://dredd.org/en/latest/index.html\"\u003eDredd\u003c/a\u003e, il permet de tester son API a partir d'un fichier de configuration Api Blueprint. Et c'est l√† que tout commence.\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"serveur\" href=\"#serveur\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Serveur\n\u003c/h1\u003e\n\n\u003cp\u003ePour simplifier la pr√©sentation, notre serveur aura deux routes retournant du JSON :\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003ela racine retournant un \"Hello world\"\u003c/li\u003e\n\u003cli\u003eune route avec param√®tre retournant les informations d'un utilisateur\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eexpress\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003erequire\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eexpress\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eapp\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eexpress\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eusers\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[{\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eJean Smaug\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\n\u003cspan class=\"p\"\u003e},\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eTimmy\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}]\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"kd\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003e/\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ereq\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ejson\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e \u003cspan class=\"na\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eHello World!\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"kd\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003e/bogass/:id\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ereq\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ejson\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eusers\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003efind\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003euser\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003euser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eid\u003c/span\u003e \u003cspan class=\"o\"\u003e===\u003c/span\u003e \u003cspan class=\"nb\"\u003eNumber\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ereq\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eparams\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e)))\u003c/span\u003e\n\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elisten\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e3000\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eListening on port 3000\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003ch1\u003e\n  \u003ca name=\"initialisation-de-dredd\" href=\"#initialisation-de-dredd\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Initialisation de Dredd\n\u003c/h1\u003e\n\n\u003cp\u003eApr√®s avoir install√© Dredd avec un \u003ccode\u003eyarn add -DE dredd\u003c/code\u003e, nous pouvons l'initialiser en lan√ßant \u003ccode\u003eyarn dredd init\u003c/code\u003e\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e? Location of the API description document apiary.apib\n? Command to start the API server under test yarn dev\n? Host of the API under test http://127.0.0.1:3000\n? Do you want to use hooks to customize Dredd's behavior? No\n? Do you want to report your tests to the Apiary inspector? No\n? Dredd is best served with Continuous Integration. Do you want to create CI configuration? No\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eNous venons de configurer Dredd pour qu'il lise un fichier \u003ccode\u003eapiary.apib\u003c/code\u003e. Ce fichier permettra de lancer des tests sur un serveur accessible via \u003ccode\u003ehttp://127.0.0.1:3000\u003c/code\u003e. Et ce serveur sera lanc√© via la commande \u003ccode\u003eyarn dev\u003c/code\u003e.\u003cbr\u003e\nMaintenant que Dredd est initialis√© nous pouvons nous concentrer sur API Blueprint.\u003c/p\u003e\n\u003ch1\u003e\n  \u003ca name=\"api-blueprint\" href=\"#api-blueprint\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  API Blueprint\n\u003c/h1\u003e\n\n\u003cp\u003eAPI Blueprint se d√©finit comme √©tant un \"puissant langage de description\" pour les API web. \u003cbr\u003e\nConcr√®tement, nous allons d√©finir vos routes, les param√®tres n√©cessaires et les valeurs de retour attendues, dans un fichier \u003ccode\u003e.apib\u003c/code\u003e, \u003ccode\u003eapiary.apib\u003c/code\u003e dans ce cas pr√©cis.\u003cbr\u003e\nDans ce fichier, nous allons √©crire du MSON (Markdown Syntax for Object Notation), donc attention √† bien respecter l'indentation.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight markdown\"\u003e\u003ccode\u003eFORMAT: 1A\n\n\u003cspan class=\"gh\"\u003e# Bogass\u003c/span\u003e\n\nAPI de l'application Bogass, l'application des bogass \n\n\u003cspan class=\"gh\"\u003e# GET /\u003c/span\u003e\n\u003cspan class=\"p\"\u003e\n+\u003c/span\u003e Response 200 (application/json; charset=utf-8)\u003cspan class=\"sb\"\u003e\n\n    + Body\n\n            { \n                \"message\": \"Hello World!\"\n            }\n\n\u003c/span\u003e\u003cspan class=\"gh\"\u003e# GET /bogass/{id}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e\n+\u003c/span\u003e Parameters\u003cspan class=\"sb\"\u003e\n\n    + id: 1 (number) - Identifiant du bogass\n\n\u003c/span\u003e\u003cspan class=\"p\"\u003e+\u003c/span\u003e Response 200 (application/json; charset=utf-8)\u003cspan class=\"sb\"\u003e\n\n    + Body\n\n            {\n                \"id\": 1,\n                \"name\": \"Jean Smaug\"\n            }\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eLorsque Dredd lira ce fichier, il lancera deux requ√™tes, une sur chaque route. On s'attendra pour chacune d'entre elle √† recevoir un code HTTP 200 et un content-type ayant \u003ccode\u003e(application/json; charset=utf-8)\u003c/code\u003e pour valeur.\u003c/p\u003e\n\n\u003cp\u003eLa grosse diff√©rence entre la premi√®re et la seconde requ√™te r√©side dans le passage de param√®tre qui s'effectue de la mani√®re suivante.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight markdown\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e+\u003c/span\u003e nom_du_champs: valeur_de_test (type) - Description\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003ePour lancer nos test un simple \u003ccode\u003eyarn dredd\u003c/code\u003e suffit.\u003c/p\u003e\n\n\u003cp\u003eAvoir un fichier de description de notre API est tout bonnement super, car il permet √† n'importe quel outil de venir le consommer. Ce qui me permet de faire une transition vers \u003ca href=\"https://github.com/bukalapak/snowboard\"\u003esnowboard\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"snowboard\" href=\"#snowboard\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Snowboard\n\u003c/h1\u003e\n\n\u003cp\u003eSnowboard va lui aussi lire notre fichier de configuration \u003ccode\u003e.apib\u003c/code\u003e, et il va g√©n√©rer une documentation.\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--Z73kYunl--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/5obdc6jef3chea9bn7if.jpg\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--Z73kYunl--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/5obdc6jef3chea9bn7if.jpg\" alt=\"snowboard-ducomentation\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003ePour obtenir ce r√©sultat il faut lancer la commande \u003ccode\u003eyarn snowboard html -o index.html apiary.apib\u003c/code\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"conclusion\" href=\"#conclusion\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Conclusion\n\u003c/h1\u003e\n\n\u003cp\u003eCr√©er un lien entre les tests et la documentation est une id√©e que je trouve tout bonnement excellente. Je pense qu'√©crire une documentation est quelque chose de chiant et primordial. Et la maintenir est quelque chose d'encore plus abominable. Avec ce genre d'outil, si la documentation n'est pas √† jour cela veut dire que les tests non plus, ce qui est... probl√©matique.\u003cbr\u003e\nEn bref n'h√©sitez pas a lire les documentations de Dredd, Api Blueprint et Snowboard qui sont bien plus compl√®te que cette succinte pr√©sentation.\u003cbr\u003e\nMerci de m'avoir lu.\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"bonus\" href=\"#bonus\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Bonus\n\u003c/h1\u003e\n\n\u003cp\u003eUne chose dont je n'ai pas parl√© : Dredd supporte aussi le format \u003ca href=\"https://www.openapis.org/\"\u003eOpen API\u003c/a\u003e (V2 pour le moment). Si vous √™tes un adepte de l'Open API vous pouvez consulter \u003ca href=\"https://blog.itnetwork.fr/blog-post/2019/05/06/dredd-partie-1-ecriture-documentation.html\"\u003ecet article\u003c/a\u003e.\u003c/p\u003e\n\n",
    "social_image": null,
    "body_markdown": "---\ntitle: La testocumentation\npublished: true\ndescription: La testocumentation est un n√©ologisme utilis√© par absolument personne pour d√©crire la fusion entre des tests et de la documentation.\ncover_image: https://thepracticaldev.s3.amazonaws.com/i/xqvbxn3f5npir0t5s0os.png\ntags: dredd, apiblueprint, nodejs\n---\n\nJ'√©tais en train de cr√©er une API avec [Adonis](https://adonisjs.com/docs/4.1/installation), un framework Node.JS, quand je me suis dit : \"Il serait peut-√™tre temps de faire des tests\".\n\n√âtant en phase exp√©rimentale et n'√©tant pas certain de conserver Adonis voir m√™me Node pour mon projet, j'ai commenc√© √† regarder les frameworks de tests agnostiques. Je suis tomb√© sur [Dredd](https://dredd.org/en/latest/index.html), il permet de tester son API a partir d'un fichier de configuration Api Blueprint. Et c'est l√† que tout commence.\n\n# Serveur\n\nPour simplifier la pr√©sentation, notre serveur aura deux routes retournant du JSON :\n- la racine retournant un \"Hello world\"\n- une route avec param√®tre retournant les informations d'un utilisateur\n\n```js\nconst express = require('express')\n\nconst app = express()\n\nconst users = [{\n    id: 1,\n    name: 'Jean Smaug'\n}, {\n    id: 2,\n    name: 'Timmy'\n}]\n\napp.get('/', function(req, res) {\n    res.json({ message: 'Hello World!' })\n})\n  \napp.get('/bogass/:id', function(req, res) {\n    res.json(users.find(user =\u003e user.id === Number(req.params.id)))\n})\n\napp.listen(3000, () =\u003e {\n    console.log('Listening on port 3000')\n})\n```\n\n# Initialisation de Dredd\n\nApr√®s avoir install√© Dredd avec un `yarn add -DE dredd`, nous pouvons l'initialiser en lan√ßant `yarn dredd init`\n\n```\n? Location of the API description document apiary.apib\n? Command to start the API server under test yarn dev\n? Host of the API under test http://127.0.0.1:3000\n? Do you want to use hooks to customize Dredd's behavior? No\n? Do you want to report your tests to the Apiary inspector? No\n? Dredd is best served with Continuous Integration. Do you want to create CI configuration? No\n\n```\nNous venons de configurer Dredd pour qu'il lise un fichier `apiary.apib`. Ce fichier permettra de lancer des tests sur un serveur accessible via `http://127.0.0.1:3000`. Et ce serveur sera lanc√© via la commande `yarn dev`.\nMaintenant que Dredd est initialis√© nous pouvons nous concentrer sur API Blueprint.\n\n# API Blueprint\n\nAPI Blueprint se d√©finit comme √©tant un \"puissant langage de description\" pour les API web. \nConcr√®tement, nous allons d√©finir vos routes, les param√®tres n√©cessaires et les valeurs de retour attendues, dans un fichier `.apib`, `apiary.apib` dans ce cas pr√©cis.\nDans ce fichier, nous allons √©crire du MSON (Markdown Syntax for Object Notation), donc attention √† bien respecter l'indentation.\n\n```markdown\nFORMAT: 1A\n\n# Bogass\n\nAPI de l'application Bogass, l'application des bogass \n\n# GET /\n\n+ Response 200 (application/json; charset=utf-8)\n    \n    + Body\n\n            { \n                \"message\": \"Hello World!\"\n            }\n\n# GET /bogass/{id}\n\n+ Parameters\n\n    + id: 1 (number) - Identifiant du bogass\n\n+ Response 200 (application/json; charset=utf-8)\n\n    + Body\n\n            {\n                \"id\": 1,\n                \"name\": \"Jean Smaug\"\n            }\n```\n\nLorsque Dredd lira ce fichier, il lancera deux requ√™tes, une sur chaque route. On s'attendra pour chacune d'entre elle √† recevoir un code HTTP 200 et un content-type ayant `(application/json; charset=utf-8)` pour valeur.\n\nLa grosse diff√©rence entre la premi√®re et la seconde requ√™te r√©side dans le passage de param√®tre qui s'effectue de la mani√®re suivante. \n\n```markdown\n+ nom_du_champs: valeur_de_test (type) - Description\n``` \n\nPour lancer nos test un simple `yarn dredd` suffit.\n\nAvoir un fichier de description de notre API est tout bonnement super, car il permet √† n'importe quel outil de venir le consommer. Ce qui me permet de faire une transition vers [snowboard](https://github.com/bukalapak/snowboard)\n\n# Snowboard\n\nSnowboard va lui aussi lire notre fichier de configuration `.apib`, et il va g√©n√©rer une documentation.\n\n![snowboard-ducomentation](https://thepracticaldev.s3.amazonaws.com/i/5obdc6jef3chea9bn7if.jpg)\n\nPour obtenir ce r√©sultat il faut lancer la commande `yarn snowboard html -o index.html apiary.apib`\n\n# Conclusion\n\nCr√©er un lien entre les tests et la documentation est une id√©e que je trouve tout bonnement excellente. Je pense qu'√©crire une documentation est quelque chose de chiant et primordial. Et la maintenir est quelque chose d'encore plus abominable. Avec ce genre d'outil, si la documentation n'est pas √† jour cela veut dire que les tests non plus, ce qui est... probl√©matique.\nEn bref n'h√©sitez pas a lire les documentations de Dredd, Api Blueprint et Snowboard qui sont bien plus compl√®te que cette succinte pr√©sentation.\nMerci de m'avoir lu.\n\n# Bonus\n\nUne chose dont je n'ai pas parl√© : Dredd supporte aussi le format [Open API](https://www.openapis.org/) (V2 pour le moment). Si vous √™tes un adepte de l'Open API vous pouvez consulter [cet article](https://blog.itnetwork.fr/blog-post/2019/05/06/dredd-partie-1-ecriture-documentation.html).",
    "canonical_url": null,
    "show_comments": true,
    "main_image_background_hex_color": "#dddddd",
    "published_from_feed": false,
    "comments_count": 0,
    "video": null,
    "video_code": null,
    "video_source_url": null,
    "video_thumbnail_url": null,
    "video_closed_caption_track_url": null,
    "feed_source_url": null,
    "positive_reactions_count": 5,
    "edited_at": null,
    "crossposted_at": null,
    "language": "fr",
    "cached_tag_list": "dredd, apiblueprint, node",
    "path": "/jeansmaug/la-testocumentation-1gnm",
    "cached_user_name": "jean-smaug",
    "cached_user_username": "jeansmaug",
    "last_comment_at": "2019-09-17T10:51:23.352Z"
  },
  {
    "title": "Utiliser Typescript avec Node.js ",
    "slug": "utiliser-typescript-avec-node-js-3api",
    "created_at": "2019-09-18T09:48:55.287Z",
    "main_image": "https://thepracticaldev.s3.amazonaws.com/i/rp78jvey4x5p0za7yk9k.jpg",
    "description": "Utiliser Typescript avec Node.js sans le l√©gendaire combo eco+ tsc --watch et nodemon.",
    "published": true,
    "published_at": "2019-09-18T18:07:15.966Z",
    "processed_html": "\u003cp\u003ePour utiliser Typescript c√¥t√© serveur, on peut choisir \u003ca href=\"https://deno.land/\"\u003eDeno\u003c/a\u003e, le moteur d'ex√©cution Typescript con√ßu par le cr√©ateur de Node.js. Probl√®me, il n'est pas \u003ca href=\"https://deno.land/manual.html#disclaimer\"\u003eencore stable\u003c/a\u003e. \u003cbr\u003e\nLa seconde solution consiste √† transpiler notre Typescript avant de l'ex√©cuter avec Node.js.\u003cbr\u003e\nIl existe d√©j√† \u003ca href=\"https://dev.to/kojikanao/hot-reload-for-nodejs-with-typescript-cel\"\u003edes tutoriels\u003c/a\u003e sur le sujet, mais peu d'entres eux parlent de \u003ca href=\"https://github.com/jaredpalmer/backpack\"\u003eBackpack\u003c/a\u003e. C'est un module bundler pour Node.js bas√© sur Webpack.\u003c/p\u003e\n\u003ch1\u003e\n  \u003ca name=\"backpack\" href=\"#backpack\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Backpack\n\u003c/h1\u003e\n\n\u003cp\u003eOn commence par installer Backpack\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eyarn add -DE backpack-core\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eEnsuite on va installer Koa qui sera notre serveur\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eyarn add -E koa\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eOn cr√©√© ensuite le serveur dans un fichier se situant dans \u003ccode\u003esrc/index.js\u003c/code\u003e. C'est le point d'entr√©e par d√©faut de Backpack\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// src/index.js\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eKoa\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003erequire\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003ekoa\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eapp\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eKoa\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003euse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ectx\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003ectx\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ebody\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eJon Snow meurt saison 5 √©pisode 10\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elisten\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e3000\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003elistening on port 3000\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eEnfin on ajoute les scripts dans notre package.json\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight json\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"scripts\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e \n        \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"dev\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"backpack\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n        \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"build\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"backpack build\"\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eOn lance un \u003ccode\u003eyarn dev\u003c/code\u003e et...\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--Z1y73rkM--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/mlfhg8v9ruxjpkxqmrl0.jpg\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--Z1y73rkM--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/mlfhg8v9ruxjpkxqmrl0.jpg\" alt=\"console-succes\" loading=\"lazy\"\u003e\u003c/a\u003e \u003c/p\u003e\n\n\u003cp\u003e...Backpack bundle nos sources Javascript sans probl√®me\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"ajout-de-typescript\" href=\"#ajout-de-typescript\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Ajout de Typescript\n\u003c/h1\u003e\n\n\u003cp\u003eOn commence par ajouter Typescript, ainsi que les types pour Node et Koa\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eyarn add -DE typescript @types/node @types/koa\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003ePuis on initialise une configuration Typescript avec\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eyarn tsc --init\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eIl faut renommer le fichier \u003ccode\u003esrc/index.js\u003c/code\u003e en \u003ccode\u003esrc/index.ts\u003c/code\u003e puis mettre √† jour le code.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight typescript\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// src/index.ts\u003c/span\u003e\n\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"nx\"\u003eKoa\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003eContext\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003ekoa\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eKoa\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eKoa\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003euse\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"nx\"\u003ectx\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eContext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003ectx\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ebody\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eJon Snow meurt saison 5 √©pisode 10\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elisten\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e3000\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003elistening on port 3000\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eDesormais si je lance de nouveau un \u003ccode\u003eyarn dev\u003c/code\u003e j'obtiens...\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--JTVBP25v--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/qhwpyptfojaqwi88xwym.png\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--JTVBP25v--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/qhwpyptfojaqwi88xwym.png\" alt=\"console-succes\" loading=\"lazy\"\u003e\u003c/a\u003e \u003cbr\u003e\n...une belle erreur. \u003c/p\u003e\n\n\u003cp\u003eL'erreur est explicite, Backpack ne parvient pas √† trouver un fichier dans \u003ccode\u003esrc/index.js\u003c/code\u003e. Nous allons donc surcharger la configuration par d√©faut de Backpack afin de lui indiquer que d√©sormais le point d'entr√©e est le fichier \u003ccode\u003esrc/index.ts\u003c/code\u003e et par la m√™me occasion nous allons lui donner la possibilit√© de comprendre les fichiers Typescript.\u003c/p\u003e\n\n\u003cp\u003eBackpack √©tant bas√© sur Webpack, on va pouvoir utiliser les loaders existants. Ajoutons le loader Typescript.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eyarn add -DE ts-loader\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eIl ne nous reste plus qu'a cr√©er un fichier de configuration nomm√© \u003ccode\u003ebackpack.config.js\u003c/code\u003e et √† y ajouter le nouveau point d'entr√©e et le loader Typescript.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// backpack.config.js\u003c/span\u003e\n\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eexports\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ewebpack\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eoptions\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ewebpack\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// nouveau point d'entr√©e\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eentry\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emain\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e./src/index.ts\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// r√©solution automatique des extensions\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eresolve\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eextensions\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e.ts\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e.js\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e.json\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// loader Typescript\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003erules\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epush\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\n      \u003cspan class=\"na\"\u003etest\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"sr\"\u003e/\u003c/span\u003e\u003cspan class=\"se\"\u003e\\.\u003c/span\u003e\u003cspan class=\"sr\"\u003ets$/\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eloader\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003ets-loader\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eOn lance un \u003ccode\u003eyarn dev\u003c/code\u003e et tout fonctionne !\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--Z1y73rkM--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/mlfhg8v9ruxjpkxqmrl0.jpg\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--Z1y73rkM--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/mlfhg8v9ruxjpkxqmrl0.jpg\" alt=\"console-succes\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eEt voila c'est fini. Simple non ?\u003c/p\u003e\n\n\u003cp\u003eMerci de m'avoir lu.\u003c/p\u003e\n\n",
    "social_image": null,
    "body_markdown": "---\ntitle: Utiliser Typescript avec Node.js \npublished: true\ndescription: Utiliser Typescript avec Node.js sans le l√©gendaire combo eco+ tsc --watch et nodemon.\ntags: nodejs, typescript, backpack, webpack\ncover_image: https://thepracticaldev.s3.amazonaws.com/i/rp78jvey4x5p0za7yk9k.jpg\n---\n\nPour utiliser Typescript c√¥t√© serveur, on peut choisir [Deno](https://deno.land/), le moteur d'ex√©cution Typescript con√ßu par le cr√©ateur de Node.js. Probl√®me, il n'est pas [encore stable](https://deno.land/manual.html#disclaimer). \nLa seconde solution consiste √† transpiler notre Typescript avant de l'ex√©cuter avec Node.js.\nIl existe d√©j√† [des tutoriels](https://dev.to/kojikanao/hot-reload-for-nodejs-with-typescript-cel) sur le sujet, mais peu d'entres eux parlent de [Backpack](https://github.com/jaredpalmer/backpack). C'est un module bundler pour Node.js bas√© sur Webpack.\n\n# Backpack\n\nOn commence par installer Backpack\n\n```\nyarn add -DE backpack-core\n```\n\nEnsuite on va installer Koa qui sera notre serveur\n\n```\nyarn add -E koa\n```\n\nOn cr√©√© ensuite le serveur dans un fichier se situant dans `src/index.js`. C'est le point d'entr√©e par d√©faut de Backpack\n\n```js\n// src/index.js\nconst Koa = require(\"koa\");\n\nconst app = new Koa();\n\napp.use(ctx =\u003e {\n  ctx.body = \"Jon Snow meurt saison 5 √©pisode 10\";\n});\n\napp.listen(3000);\nconsole.log(\"listening on port 3000\");\n```\n\nEnfin on ajoute les scripts dans notre package.json \n\n```json\n{\n    \"scripts\": { \n        \"dev\": \"backpack\",\n        \"build\": \"backpack build\"\n    }\n}\n```\n\nOn lance un `yarn dev` et...\n\n![console-succes](https://thepracticaldev.s3.amazonaws.com/i/mlfhg8v9ruxjpkxqmrl0.jpg) \n\n...Backpack bundle nos sources Javascript sans probl√®me\n\n\n# Ajout de Typescript\n\nOn commence par ajouter Typescript, ainsi que les types pour Node et Koa\n\n```\nyarn add -DE typescript @types/node @types/koa\n```\n\nPuis on initialise une configuration Typescript avec\n\n```\nyarn tsc --init\n```\n\nIl faut renommer le fichier `src/index.js` en `src/index.ts` puis mettre √† jour le code.\n\n```ts\n// src/index.ts\nimport Koa, { Context } from \"koa\";\n\nconst app: Koa = new Koa();\n\napp.use((ctx: Context) =\u003e {\n  ctx.body = \"Jon Snow meurt saison 5 √©pisode 10\";\n});\n\napp.listen(3000);\nconsole.log(\"listening on port 3000\");\n```\n\nDesormais si je lance de nouveau un `yarn dev` j'obtiens...\n\n![console-succes](https://thepracticaldev.s3.amazonaws.com/i/qhwpyptfojaqwi88xwym.png) \n...une belle erreur. \n\nL'erreur est explicite, Backpack ne parvient pas √† trouver un fichier dans `src/index.js`. Nous allons donc surcharger la configuration par d√©faut de Backpack afin de lui indiquer que d√©sormais le point d'entr√©e est le fichier `src/index.ts` et par la m√™me occasion nous allons lui donner la possibilit√© de comprendre les fichiers Typescript.\n\nBackpack √©tant bas√© sur Webpack, on va pouvoir utiliser les loaders existants. Ajoutons le loader Typescript.\n\n```\nyarn add -DE ts-loader\n```\n\nIl ne nous reste plus qu'a cr√©er un fichier de configuration nomm√© `backpack.config.js` et √† y ajouter le nouveau point d'entr√©e et le loader Typescript.\n\n```js\n// backpack.config.js\nmodule.exports = {\n  webpack: (config, options, webpack) =\u003e {\n    // nouveau point d'entr√©e\n    config.entry.main = [\"./src/index.ts\"];\n\n    // r√©solution automatique des extensions\n    config.resolve = {\n      extensions: [\".ts\", \".js\", \".json\"]\n    };\n\n    // loader Typescript\n    config.module.rules.push({\n      test: /\\.ts$/,\n      loader: \"ts-loader\"\n    });\n\n    return config;\n  }\n};\n```\n\nOn lance un `yarn dev` et tout fonctionne !\n\n![console-succes](https://thepracticaldev.s3.amazonaws.com/i/mlfhg8v9ruxjpkxqmrl0.jpg)\n\nEt voila c'est fini. Simple non ?\n\nMerci de m'avoir lu.",
    "canonical_url": null,
    "show_comments": true,
    "main_image_background_hex_color": "#dddddd",
    "published_from_feed": false,
    "comments_count": 0,
    "video": null,
    "video_code": null,
    "video_source_url": null,
    "video_thumbnail_url": null,
    "video_closed_caption_track_url": null,
    "feed_source_url": null,
    "positive_reactions_count": 7,
    "edited_at": "2019-11-28T08:12:39.132Z",
    "crossposted_at": null,
    "language": "xxx",
    "cached_tag_list": "node, typescript, backpack, webpack",
    "path": "/jeansmaug/utiliser-typescript-avec-node-js-3api",
    "cached_user_name": "jean-smaug",
    "cached_user_username": "jeansmaug",
    "last_comment_at": "2019-09-18T18:07:15.966Z"
  },
  {
    "title": "Use Typescript with Node.js ",
    "slug": "use-typescript-with-node-js-2d29",
    "created_at": "2019-09-30T08:39:54.788Z",
    "main_image": "https://thepracticaldev.s3.amazonaws.com/i/rp78jvey4x5p0za7yk9k.jpg",
    "description": "How to use Typescript with Node.js without the legendary combo tsc --watch and nodemon.",
    "published": true,
    "published_at": "2019-11-11T07:22:12.608Z",
    "processed_html": "\u003cp\u003eIn order to use Typescript on the server side, we can choose \u003ca href=\"https://deno.land/\"\u003eDeno\u003c/a\u003e, the Typescript runtime created by the creator of Node.js. There is a problem, it's not \u003ca href=\"https://deno.land/manual.html#disclaimer\"\u003eready yet\u003c/a\u003e\u003cbr\u003e\nThe second solution is to transpile our Typescript and execute the result with Node.js.\u003cbr\u003e\nThere are already \u003ca href=\"https://dev.to/wrrnwng/setting-up-typescript-for-node-3ej2\"\u003esome tutorials\u003c/a\u003e that show it but not many of themtalking about Backpack. It's a module bundler for Node.js based on Webpack\u003c/p\u003e\n\u003ch1\u003e\n  \u003ca name=\"backpack\" href=\"#backpack\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Backpack\n\u003c/h1\u003e\n\n\u003cp\u003eWe start with the installation of Backpack\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eyarn add -DE backpack-core\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eAfter that, we install Koa, which will be our web server example.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eyarn add -E koa\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eWe are now going to create the server in a file situated in \u003ccode\u003esrc/index.js\u003c/code\u003e. It's the default entrypoint for Backpack.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// src/index.js\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eKoa\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003erequire\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003ekoa\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eapp\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eKoa\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003euse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ectx\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003ectx\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ebody\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eJon Snow meurt saison 5 √©pisode 10\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elisten\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e3000\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003elistening on port 3000\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eThen we add the scripts to our package.json\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight json\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"scripts\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e \n        \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"dev\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"backpack\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n        \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"build\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"backpack build\"\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eWe now launch a \u003ccode\u003eyarn dev\u003c/code\u003e and...\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--Z1y73rkM--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/mlfhg8v9ruxjpkxqmrl0.jpg\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--Z1y73rkM--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/mlfhg8v9ruxjpkxqmrl0.jpg\" alt=\"console-succes\" loading=\"lazy\"\u003e\u003c/a\u003e \u003c/p\u003e\n\n\u003cp\u003e...Backpack is bundling our Javascript sources !\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"adding-typescript\" href=\"#adding-typescript\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Adding Typescript\n\u003c/h1\u003e\n\n\u003cp\u003eWe start by adding Typescript, and all the necessaries types for Node and Koa\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eyarn add -DE typescript @types/node @types/koa\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eAfter that, we initialized a Typescript configuration with\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eyarn tsc --init\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eWe'll now rename our \u003ccode\u003esrc/index.js\u003c/code\u003e in \u003ccode\u003esrc/index.ts\u003c/code\u003e and update the code\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight typescript\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// src/index.ts\u003c/span\u003e\n\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"nx\"\u003eKoa\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003eContext\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003ekoa\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eKoa\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eKoa\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003euse\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"nx\"\u003ectx\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eContext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003ectx\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ebody\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eJon Snow meurt saison 5 √©pisode 10\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elisten\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e3000\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003elistening on port 3000\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eIf we relaunch a \u003ccode\u003eyarn dev\u003c/code\u003e we got...\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--JTVBP25v--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/qhwpyptfojaqwi88xwym.png\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--JTVBP25v--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/qhwpyptfojaqwi88xwym.png\" alt=\"console-succes\" loading=\"lazy\"\u003e\u003c/a\u003e \u003cbr\u003e\n...a beautiful error. \u003c/p\u003e\n\n\u003cp\u003eThe error is very explicit, Backpack can't find the \u003ccode\u003esrc/index.js\u003c/code\u003e file. So, we'll overide the Backpack configuration and configure\u003ccode\u003esrc/index.ts\u003c/code\u003e as the new entrypoint. We'll also give Backpack the possibility to understand Typescript files.\u003c/p\u003e\n\n\u003cp\u003eBackpack is based on Webpack, so, we can use all of his loaders.\u003cbr\u003e\nLet's add the Typescript loader.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eyarn add -DE ts-loader\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eThe last step is to create a config file named \u003ccode\u003ebackpack.config.js\u003c/code\u003e, add the new entrypoint and the Typescript loader.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// backpack.config.js\u003c/span\u003e\n\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eexports\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ewebpack\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eoptions\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ewebpack\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// new entrypoint\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eentry\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emain\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e./src/index.ts\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// extensions resolution\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eresolve\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eextensions\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e.ts\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e.js\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e.json\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// Typescript loader\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003erules\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epush\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\n      \u003cspan class=\"na\"\u003etest\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"sr\"\u003e/\u003c/span\u003e\u003cspan class=\"se\"\u003e\\.\u003c/span\u003e\u003cspan class=\"sr\"\u003ets$/\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eloader\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003ets-loader\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eWe launch a \u003ccode\u003eyarn dev\u003c/code\u003e and everything is working !\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--Z1y73rkM--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/mlfhg8v9ruxjpkxqmrl0.jpg\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--Z1y73rkM--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/mlfhg8v9ruxjpkxqmrl0.jpg\" alt=\"console-succes\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eIt's over. Simple, no ? \u003c/p\u003e\n\n\u003cp\u003eThanks for reading.\u003c/p\u003e\n\n",
    "social_image": null,
    "body_markdown": "---\ntitle: Use Typescript with Node.js \npublished: true\ndescription: How to use Typescript with Node.js without the legendary combo tsc --watch and nodemon.\ntags: nodejs, typescript, backpack, webpack\ncover_image: https://thepracticaldev.s3.amazonaws.com/i/rp78jvey4x5p0za7yk9k.jpg\n---\n\nIn order to use Typescript on the server side, we can choose [Deno](https://deno.land/), the Typescript runtime created by the creator of Node.js. There is a problem, it's not [ready yet](https://deno.land/manual.html#disclaimer)\nThe second solution is to transpile our Typescript and execute the result with Node.js.\nThere are already [some tutorials](https://dev.to/wrrnwng/setting-up-typescript-for-node-3ej2) that show it but not many of themtalking about Backpack. It's a module bundler for Node.js based on Webpack\n\n# Backpack\n\nWe start with the installation of Backpack\n\n```\nyarn add -DE backpack-core\n```\n\nAfter that, we install Koa, which will be our web server example.\n\n```\nyarn add -E koa\n```\n\nWe are now going to create the server in a file situated in `src/index.js`. It's the default entrypoint for Backpack.\n\n```js\n// src/index.js\nconst Koa = require(\"koa\");\n\nconst app = new Koa();\n\napp.use(ctx =\u003e {\n  ctx.body = \"Jon Snow meurt saison 5 √©pisode 10\";\n});\n\napp.listen(3000);\nconsole.log(\"listening on port 3000\");\n```\n\nThen we add the scripts to our package.json\n\n```json\n{\n    \"scripts\": { \n        \"dev\": \"backpack\",\n        \"build\": \"backpack build\"\n    }\n}\n```\n\nWe now launch a `yarn dev` and...\n\n![console-succes](https://thepracticaldev.s3.amazonaws.com/i/mlfhg8v9ruxjpkxqmrl0.jpg) \n\n...Backpack is bundling our Javascript sources !\n\n\n# Adding Typescript\n\nWe start by adding Typescript, and all the necessaries types for Node and Koa\n\n```\nyarn add -DE typescript @types/node @types/koa\n```\n\nAfter that, we initialized a Typescript configuration with\n\n```\nyarn tsc --init\n```\n\nWe'll now rename our `src/index.js` in `src/index.ts` and update the code\n\n```ts\n// src/index.ts\nimport Koa, { Context } from \"koa\";\n\nconst app: Koa = new Koa();\n\napp.use((ctx: Context) =\u003e {\n  ctx.body = \"Jon Snow meurt saison 5 √©pisode 10\";\n});\n\napp.listen(3000);\nconsole.log(\"listening on port 3000\");\n```\n\nIf we relaunch a `yarn dev` we got...\n\n![console-succes](https://thepracticaldev.s3.amazonaws.com/i/qhwpyptfojaqwi88xwym.png) \n...a beautiful error. \n\nThe error is very explicit, Backpack can't find the `src/index.js` file. So, we'll overide the Backpack configuration and configure`src/index.ts` as the new entrypoint. We'll also give Backpack the possibility to understand Typescript files.\n\nBackpack is based on Webpack, so, we can use all of his loaders.\nLet's add the Typescript loader.\n\n```\nyarn add -DE ts-loader\n```\n\nThe last step is to create a config file named `backpack.config.js`, add the new entrypoint and the Typescript loader. \n\n```js\n// backpack.config.js\nmodule.exports = {\n  webpack: (config, options, webpack) =\u003e {\n    // new entrypoint\n    config.entry.main = [\"./src/index.ts\"];\n\n    // extensions resolution\n    config.resolve = {\n      extensions: [\".ts\", \".js\", \".json\"]\n    };\n\n    // Typescript loader\n    config.module.rules.push({\n      test: /\\.ts$/,\n      loader: \"ts-loader\"\n    });\n\n    return config;\n  }\n};\n```\n\nWe launch a `yarn dev` and everything is working !\n\n![console-succes](https://thepracticaldev.s3.amazonaws.com/i/mlfhg8v9ruxjpkxqmrl0.jpg)\n\nIt's over. Simple, no ? \n\nThanks for reading.",
    "canonical_url": null,
    "show_comments": true,
    "main_image_background_hex_color": "#dddddd",
    "published_from_feed": false,
    "comments_count": 0,
    "video": null,
    "video_code": null,
    "video_source_url": null,
    "video_thumbnail_url": null,
    "video_closed_caption_track_url": null,
    "feed_source_url": null,
    "positive_reactions_count": 7,
    "edited_at": "2019-11-28T08:12:52.775Z",
    "crossposted_at": null,
    "language": "fr",
    "cached_tag_list": "node, typescript, backpack, webpack",
    "path": "/jeansmaug/use-typescript-with-node-js-2d29",
    "cached_user_name": "jean-smaug",
    "cached_user_username": "jeansmaug",
    "last_comment_at": "2019-11-11T07:22:12.608Z"
  },
  {
    "title": "SQLite, json et d√©normalisation",
    "slug": "sqlite-json-et-denormalisation-2bdm",
    "created_at": "2019-10-22T06:40:09.708Z",
    "main_image": "https://thepracticaldev.s3.amazonaws.com/i/9dj0ule138xxyos7zax4.jpg",
    "description": "Gagner en performance et en espace sur une base relationnelle en utilisant la d√©normalisation",
    "published": true,
    "published_at": "2019-10-22T06:40:33.745Z",
    "processed_html": "\u003cp\u003eEn parcourant la documentation de \u003ca href=\"https://www.sqlite.org/docs.html\"\u003eSQLite\u003c/a\u003e j'ai vu qu'il existait une extension nomm√©e \u003ca href=\"https://www.sqlite.org/json1.html\"\u003eJSON1\u003c/a\u003e, qui, vous vous en doutez permet de manipuler du JSON au sein de SQLite.\u003c/p\u003e\n\n\u003cp\u003eDans cet article, nous allons voir comment utiliser cette extension sur une base d√©normalis√©e et l'impact que cela peut avoir sur les performances de lecture.\u003c/p\u003e\n\n\u003cp\u003eLe code utilis√© est disponible ici :\u003c/p\u003e\n\n\n\u003cdiv class=\"ltag-github-readme-tag\"\u003e\n  \u003cdiv class=\"readme-overview\"\u003e\n    \u003ch2\u003e\n      \u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--qF2jUiUG--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://practicaldev-herokuapp-com.freetls.fastly.net/assets/github-logo-6a5bca60a4ebf959a6df7f08217acd07ac2bc285164fae041eacb8a148b1bab9.svg\" alt=\"GitHub logo\" loading=\"lazy\"\u003e\n      \u003ca href=\"https://github.com/jean-smaug\"\u003e\n        jean-smaug\n      \u003c/a\u003e / \u003ca style=\"font-weight: 600;\" href=\"https://github.com/jean-smaug/demo-sqlite-denormalization\"\u003e\n        demo-sqlite-denormalization\n      \u003c/a\u003e\n    \u003c/h2\u003e\n    \u003ch3\u003e\n      \n    \u003c/h3\u003e\n  \u003c/div\u003e\n\u003c/div\u003e\n\n\n\u003ch1\u003e\n  \u003ca name=\"cest-quoi-la-d%C3%A9normalisation-\" href=\"#cest-quoi-la-d%C3%A9normalisation-\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  C'est quoi la d√©normalisation ?\n\u003c/h1\u003e\n\n\u003cp\u003eSi j'en crois \u003ca href=\"https://stph.scenari-community.org/bdd/0/co/optUC004.html\"\u003ecette page\u003c/a\u003e. C'est un \"Processus consistant √† regrouper plusieurs tables li√©es par des r√©f√©rences, en une seule table, en r√©alisant statiquement les op√©rations de jointure ad√©quates.\"\u003c/p\u003e\n\n\u003cp\u003eMa version, c'est de dire que l'on va s'autoriser √† ne pas utiliser les bonnes pratiques enseign√©es par nos professeurs #ThugLife. \u003cbr\u003e\nDans une base d√©normalis√©e on s'√©loigne (un peu) du Graal que repr√©sente la 3e forme normale et on s'autorise √† dupliquer des donn√©es notamment en rapatriant les donn√©es des tables de jointure dans les \"tables normales\".\u003cbr\u003e\nSi ce n'est toujours pas clair, l'exemple qui suit devrait vous aider √† mieux comprendre. \u003c/p\u003e\n\u003ch1\u003e\n  \u003ca name=\"les-tables\" href=\"#les-tables\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Les tables\n\u003c/h1\u003e\n\n\u003cp\u003ePlut√¥t que d'utiliser l'exemple des posts avec des tags, cette fois-ci, on va avoir des bars et des bouteilles de vin. On aura une relation de type many-to-many ou chaque bar peut proposer plusieurs vins et de la m√™me mani√®re, un vin peut √™tre servi dans plusieurs bars.\u003c/p\u003e\n\n\u003cp\u003eNous aurons 4 tables :\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003cstrong\u003ewines\u003c/strong\u003e : table des vins\u003c/li\u003e\n\u003cli\u003e\n\u003cstrong\u003ebars_normalized\u003c/strong\u003e : tables des bars\u003c/li\u003e\n\u003cli\u003e\n\u003cstrong\u003ebars_wines\u003c/strong\u003e : table de jointure entre wines et bars_normalized\u003c/li\u003e\n\u003cli\u003e\n\u003cstrong\u003ebars_denormalized\u003c/strong\u003e : la table des bars o√π les vins servis dans ce bar sont stock√©s en tant que tableau d'identifiant sous le champ wines_ids\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight sql\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eCREATE\u003c/span\u003e \u003cspan class=\"k\"\u003eTABLE\u003c/span\u003e \u003cspan class=\"n\"\u003eIF\u003c/span\u003e \u003cspan class=\"k\"\u003eNOT\u003c/span\u003e \u003cspan class=\"k\"\u003eEXISTS\u003c/span\u003e \u003cspan class=\"n\"\u003ewines\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eid\u003c/span\u003e \u003cspan class=\"nb\"\u003eTEXT\u003c/span\u003e \u003cspan class=\"k\"\u003ePRIMARY\u003c/span\u003e \u003cspan class=\"k\"\u003eKEY\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"n\"\u003ename\u003c/span\u003e \u003cspan class=\"nb\"\u003eTEXT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"n\"\u003ecountry\u003c/span\u003e \u003cspan class=\"nb\"\u003eTEXT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nb\"\u003eyear\u003c/span\u003e \u003cspan class=\"nb\"\u003eINTEGER\u003c/span\u003e\n\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eCREATE\u003c/span\u003e \u003cspan class=\"k\"\u003eTABLE\u003c/span\u003e \u003cspan class=\"n\"\u003eIF\u003c/span\u003e \u003cspan class=\"k\"\u003eNOT\u003c/span\u003e \u003cspan class=\"k\"\u003eEXISTS\u003c/span\u003e \u003cspan class=\"n\"\u003ebars_normalized\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eid\u003c/span\u003e \u003cspan class=\"nb\"\u003eTEXT\u003c/span\u003e \u003cspan class=\"k\"\u003ePRIMARY\u003c/span\u003e \u003cspan class=\"k\"\u003eKEY\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"n\"\u003ename\u003c/span\u003e \u003cspan class=\"nb\"\u003eTEXT\u003c/span\u003e\n\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eCREATE\u003c/span\u003e \u003cspan class=\"k\"\u003eTABLE\u003c/span\u003e \u003cspan class=\"n\"\u003eIF\u003c/span\u003e \u003cspan class=\"k\"\u003eNOT\u003c/span\u003e \u003cspan class=\"k\"\u003eEXISTS\u003c/span\u003e \u003cspan class=\"n\"\u003ebars_wines\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"n\"\u003ebar_id\u003c/span\u003e \u003cspan class=\"nb\"\u003eTEXT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"n\"\u003ewine_id\u003c/span\u003e \u003cspan class=\"nb\"\u003eTEXT\u003c/span\u003e\n\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eCREATE\u003c/span\u003e \u003cspan class=\"k\"\u003eTABLE\u003c/span\u003e \u003cspan class=\"n\"\u003eIF\u003c/span\u003e \u003cspan class=\"k\"\u003eNOT\u003c/span\u003e \u003cspan class=\"k\"\u003eEXISTS\u003c/span\u003e \u003cspan class=\"n\"\u003ebars_denormalized\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eid\u003c/span\u003e \u003cspan class=\"nb\"\u003eTEXT\u003c/span\u003e \u003cspan class=\"k\"\u003ePRIMARY\u003c/span\u003e \u003cspan class=\"k\"\u003eKEY\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"n\"\u003ename\u003c/span\u003e \u003cspan class=\"nb\"\u003eTEXT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"n\"\u003ecountry\u003c/span\u003e \u003cspan class=\"nb\"\u003eTEXT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"n\"\u003ewines_ids\u003c/span\u003e \u003cspan class=\"n\"\u003eJSON\u003c/span\u003e \u003cspan class=\"cm\"\u003e/* contiendra: [\"wine-uuid-1\",\"wine-uuid-234\"...] */\u003c/span\u003e\n\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"pr%C3%A9sentation-de-json1\" href=\"#pr%C3%A9sentation-de-json1\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Pr√©sentation de JSON1\n\u003c/h1\u003e\n\n\u003cp\u003eRegardons comment effectuer les op√©rations usuelles sur la table \u003cstrong\u003ebar_denormalized\u003c/strong\u003e.\u003c/p\u003e\n\u003ch2\u003e\n  \u003ca name=\"insertion\" href=\"#insertion\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Insertion\n\u003c/h2\u003e\n\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight sql\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eINSERT\u003c/span\u003e \u003cspan class=\"k\"\u003eINTO\u003c/span\u003e \u003cspan class=\"n\"\u003ebars_denormalized\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ewines_ids\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"k\"\u003eVALUES\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"s1\"\u003e'random-uuid'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"s1\"\u003e'La taverne'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"cm\"\u003e/* La m√©thode json() permet de v√©rifier que le JSON fourni est valide\n  et aussi de supprimer les espaces inutiles */\u003c/span\u003e\n  \u003cspan class=\"n\"\u003ejson\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'[\"wine-uuid-1\", \"wine-uuid-45\", \"wine-uuid-423\"]'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"lecture\" href=\"#lecture\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Lecture\n\u003c/h2\u003e\n\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight sql\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eSELECT\u003c/span\u003e \u003cspan class=\"k\"\u003eDISTINCT\u003c/span\u003e \u003cspan class=\"n\"\u003ebars_denormalized\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebars_denormalized\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\n\u003cspan class=\"cm\"\u003e/* 1 - La m√©thode json_each() permet de s√©lectionner le champ \nsur lequel nous allons it√©rer */\u003c/span\u003e\n\u003cspan class=\"k\"\u003eFROM\u003c/span\u003e \u003cspan class=\"n\"\u003ebars_denormalized\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ejson_each\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebars_denormalized\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewines_ids\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"cm\"\u003e/* 2 - Une fois qu'un champ a √©t√© s√©lctionn√© avec json_each(),\non peut utiliser json_each.value pour r√©cup√©rer la valeur\nde chacun des √©l√©ments du tableau */\u003c/span\u003e\n\u003cspan class=\"k\"\u003eWHERE\u003c/span\u003e \u003cspan class=\"n\"\u003ejson_each\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'wine-uuid-1'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\u003cp\u003eLa requ√™te ci-dessus va, pour chaque bar, it√©rer sur la tableau \u003ccode\u003ewines_ids\u003c/code\u003e. Et pour chaque √©lement du tableau, il va v√©rifier s'il est √©gal √† l'identifiant \u003ccode\u003ewine-uuid-1\u003c/code\u003e.\u003cbr\u003e\nAu final, cette requ√™te renvoie tous les bars proposant le vin ayant pour identifiant \u003ccode\u003ewine-uuid-1\u003c/code\u003e.\u003cbr\u003e\nSi nous avions eu un objet nous aurions pu utiliser la m√©thode \u003ccode\u003ejson_extract\u003c/code\u003e. Si nous avions un tableau d'objets, la m√©thode \u003ccode\u003ejson_tree\u003c/code\u003e.\u003c/p\u003e\n\u003ch2\u003e\n  \u003ca name=\"mise-%C3%A0-jour-et-suppression\" href=\"#mise-%C3%A0-jour-et-suppression\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Mise √† jour et suppression\n\u003c/h2\u003e\n\n\u003cp\u003eCes deux op√©rations vont fonctionner de mani√®re similaire. Dans un cas, on va venir ajouter un nouvel identifiant dans le tableau \u003ccode\u003ewines_ids\u003c/code\u003e et dans l'autre cas, on viendra en supprimer un.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight sql\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eUPDATE\u003c/span\u003e \u003cspan class=\"n\"\u003ebars_denormalized\u003c/span\u003e\n\u003cspan class=\"k\"\u003eSET\u003c/span\u003e \u003cspan class=\"n\"\u003ewines_ids\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"cm\"\u003e/* 2 - On insert la valeur √† l'indice donn√©, √† la fin du tableau */\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eSELECT\u003c/span\u003e \u003cspan class=\"n\"\u003ejson_insert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ebars_denormalized\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewines_ids\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"cm\"\u003e/* 1 - On r√©cup√®re la longueur du tableau actuel, qui sera l'indice \n    du nouvel √©l√©ment */\u003c/span\u003e\n    \u003cspan class=\"s1\"\u003e'$['\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"n\"\u003ejson_array_length\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebars_denormalized\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewines_ids\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"s1\"\u003e']'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s1\"\u003e'wine-uuid-297'\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"k\"\u003eWHERE\u003c/span\u003e \u003cspan class=\"n\"\u003eid\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'bar-uuid-3'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eLa fonction \u003ccode\u003ejson_insert\u003c/code\u003e prend trois param√®tres : \u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003ele champ dans lequel on va ins√©rer une valeur\u003c/li\u003e\n\u003cli\u003el'indice auquel on va ins√©rer cette valeur \u003c/li\u003e\n\u003cli\u003ela valeur\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight sql\"\u003e\u003ccode\u003e\u003cspan class=\"cm\"\u003e/* 3 - On met √† jour le champ wines_ids avec le nouveau tableau */\u003c/span\u003e\n\u003cspan class=\"k\"\u003eUPDATE\u003c/span\u003e \u003cspan class=\"n\"\u003ebars_denormalized\u003c/span\u003e\n\u003cspan class=\"k\"\u003eSET\u003c/span\u003e \u003cspan class=\"n\"\u003ewines_ids\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"cm\"\u003e/* 2 - On retourne un tableau sans l'√©l√©ment dont l'indice a √©t√© \n  retourn√© par la sous-requ√™te en 1  */\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eSELECT\u003c/span\u003e \u003cspan class=\"n\"\u003ejson_remove\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebars_denormalized\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewines_ids\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s1\"\u003e'$['\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\n      \u003cspan class=\"cm\"\u003e/* 1 - On cherche l'indice de l'√©l√©ment √† supprimer */\u003c/span\u003e\n      \u003cspan class=\"k\"\u003eSELECT\u003c/span\u003e \u003cspan class=\"n\"\u003ejson_each\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"k\"\u003ekey\u003c/span\u003e \n      \u003cspan class=\"k\"\u003eFROM\u003c/span\u003e \u003cspan class=\"n\"\u003ejson_each\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebars_denormalized\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewines_ids\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"k\"\u003eWHERE\u003c/span\u003e \u003cspan class=\"n\"\u003ejson_each\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'wine-uuid-297'\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"s1\"\u003e']'\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e \n\u003cspan class=\"k\"\u003eWHERE\u003c/span\u003e \u003cspan class=\"n\"\u003eid\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'bar-uuid-3'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eLa fonction \u003ccode\u003ejson_remove\u003c/code\u003e prend deux param√®tres : \u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003ele champ dans lequel on va retirer une valeur\u003c/li\u003e\n\u003cli\u003el'indice de la valeur que l'on souhaite supprimer\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"les-requ%C3%AAtes\" href=\"#les-requ%C3%AAtes\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Les requ√™tes\n\u003c/h1\u003e\n\n\u003cp\u003ePour tester les performances des deux sch√©mas de bases de donn√©es, les requ√™tes auront les buts suivants :\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eobtenir les noms des bars proposant des vins datant des ann√©es sup√©rieures √† 2018\u003c/li\u003e\n\u003cli\u003eobtenir les noms des vins portugais qui sont servis dans des bars du royaume-uni\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eAvec ces deux requ√™tes, on pourra voir comment faire des requ√™tes \"dans les deux sens\".\u003c/p\u003e\n\n\u003cp\u003ePour la version normalis√©e, on va effectuer une jointure entre les tables  \u003cstrong\u003ewines\u003c/strong\u003e, \u003cstrong\u003ebars_normalized\u003c/strong\u003e et \u003cstrong\u003ebars_wines\u003c/strong\u003e. On viendra ensuite appliquer les filtres selon nos besoins.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight sql\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eSELECT\u003c/span\u003e \u003cspan class=\"k\"\u003eDISTINCT\u003c/span\u003e \u003cspan class=\"n\"\u003ebars_normalized\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebars_normalized\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\n\u003cspan class=\"k\"\u003eFROM\u003c/span\u003e \u003cspan class=\"n\"\u003ebars_normalized\u003c/span\u003e\n\u003cspan class=\"k\"\u003eLEFT\u003c/span\u003e \u003cspan class=\"k\"\u003eOUTER\u003c/span\u003e \u003cspan class=\"k\"\u003eJOIN\u003c/span\u003e \u003cspan class=\"n\"\u003ebars_wines\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eON\u003c/span\u003e \u003cspan class=\"n\"\u003ebars_normalized\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ebars_wines\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebar_id\u003c/span\u003e\n\u003cspan class=\"k\"\u003eLEFT\u003c/span\u003e \u003cspan class=\"k\"\u003eOUTER\u003c/span\u003e \u003cspan class=\"k\"\u003eJOIN\u003c/span\u003e \u003cspan class=\"n\"\u003ewines\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eON\u003c/span\u003e \u003cspan class=\"n\"\u003ewines\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ebars_wines\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewine_id\u003c/span\u003e\n\u003cspan class=\"k\"\u003eWHERE\u003c/span\u003e \u003cspan class=\"nb\"\u003eyear\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e2018\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight sql\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eSELECT\u003c/span\u003e \u003cspan class=\"k\"\u003eDISTINCT\u003c/span\u003e \u003cspan class=\"n\"\u003ewines\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ewines\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\n\u003cspan class=\"k\"\u003eFROM\u003c/span\u003e \u003cspan class=\"n\"\u003ewines\u003c/span\u003e\n\u003cspan class=\"k\"\u003eLEFT\u003c/span\u003e \u003cspan class=\"k\"\u003eOUTER\u003c/span\u003e \u003cspan class=\"k\"\u003eJOIN\u003c/span\u003e \u003cspan class=\"n\"\u003ebars_wines\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eON\u003c/span\u003e \u003cspan class=\"n\"\u003ewines\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ebars_wines\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewine_id\u003c/span\u003e\n\u003cspan class=\"k\"\u003eLEFT\u003c/span\u003e \u003cspan class=\"k\"\u003eOUTER\u003c/span\u003e \u003cspan class=\"k\"\u003eJOIN\u003c/span\u003e \u003cspan class=\"n\"\u003ebars_normalized\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eON\u003c/span\u003e \u003cspan class=\"n\"\u003ebars_normalized\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ebars_wines\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebar_id\u003c/span\u003e\n\u003cspan class=\"k\"\u003eWHERE\u003c/span\u003e \u003cspan class=\"n\"\u003ebars_normalized\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecountry\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'United Kingdom'\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eAND\u003c/span\u003e \u003cspan class=\"n\"\u003ewines\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecountry\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'Portugal'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eConcernant la version d√©normalis√©e on va utiliser les m√©thodes fournies par l'extension JSON1, \u003ccode\u003ejson_each\u003c/code\u003e dans notre cas.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight sql\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eSELECT\u003c/span\u003e \u003cspan class=\"k\"\u003eDISTINCT\u003c/span\u003e \u003cspan class=\"n\"\u003ebars_denormalized\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e \n\u003cspan class=\"k\"\u003eFROM\u003c/span\u003e \u003cspan class=\"n\"\u003ebars_denormalized\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ejson_each\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebars_denormalized\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewines_ids\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"k\"\u003eWHERE\u003c/span\u003e \u003cspan class=\"n\"\u003ejson_each\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e \u003cspan class=\"k\"\u003eIN\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eSELECT\u003c/span\u003e \u003cspan class=\"n\"\u003eid\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eFROM\u003c/span\u003e \u003cspan class=\"n\"\u003ewines\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eWHERE\u003c/span\u003e \u003cspan class=\"nb\"\u003eyear\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e2018\u003c/span\u003e\n\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight sql\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eSELECT\u003c/span\u003e \u003cspan class=\"k\"\u003eDISTINCT\u003c/span\u003e \u003cspan class=\"n\"\u003ewines\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ewines\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\n\u003cspan class=\"k\"\u003eFROM\u003c/span\u003e \u003cspan class=\"n\"\u003ewines\u003c/span\u003e\n\u003cspan class=\"k\"\u003eWHERE\u003c/span\u003e \u003cspan class=\"n\"\u003eid\u003c/span\u003e \u003cspan class=\"k\"\u003eIN\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eSELECT\u003c/span\u003e \u003cspan class=\"k\"\u003eDISTINCT\u003c/span\u003e \u003cspan class=\"n\"\u003ejson_each\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e \u003cspan class=\"k\"\u003eAS\u003c/span\u003e \u003cspan class=\"n\"\u003eid\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eFROM\u003c/span\u003e \u003cspan class=\"n\"\u003ebars_denormalized\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ejson_each\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebars_denormalized\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewines_ids\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eWHERE\u003c/span\u003e \u003cspan class=\"n\"\u003ebars_denormalized\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecountry\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'United Kingdom'\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003eAND\u003c/span\u003e \u003cspan class=\"n\"\u003ewines\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecountry\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'Portugal'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003ePetit apart√© concernant la requ√™te ci-dessus, ou plut√¥t la sous-requ√™te. Si on s'en tient au sens de lecture, il peut paraitre bizarre que j'utilise \u003ccode\u003ejson_each.value\u003c/code\u003e dans le \u003ccode\u003eSELECT\u003c/code\u003e alors que je vais charger ces donn√©es dans la clause \u003ccode\u003eFROM\u003c/code\u003e qui est la ligne suivante. Et justement, il faut comprendre comment les bases relationnelles interpr√®tent les requ√™tes, elles sont execut√©es comme pr√©sent√©e dans le schema suivant.\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--71zs0ix5--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/12ay7mtvjfzjncgs7o5x.jpeg\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--71zs0ix5--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/12ay7mtvjfzjncgs7o5x.jpeg\" alt=\"sql-query-order\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eAinsi, m√™me si cela ne semble pas naturel au vu du sens de lecture, c'est en revanche tout √† fait valide d'un point de vue technique. \u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"r%C3%A9sultats\" href=\"#r%C3%A9sultats\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  R√©sultats\n\u003c/h1\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"lectures\" href=\"#lectures\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Lectures\n\u003c/h2\u003e\n\n\u003cp\u003eJ'ai effectu√© les tests en faisant varier diff√©rents param√®tres. Sur chacune des requ√™tes ci-dessous, les nombres entre parenth√®ses repr√©sentent : \u003cbr\u003e\n(nombre de bars, nombre de vins, nombre de vins par bar). \u003c/p\u003e\n\n\u003cp\u003eLes r√©sultats sont des m√©dianes d'une s√©rie de 5 requ√™tes.\u003c/p\u003e\n\n\u003cdiv class=\"table-wrapper-paragraph\"\u003e\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e\u003c/th\u003e\n\u003cth\u003eNormalis√©e\u003c/th\u003e\n\u003cth\u003eD√©normalis√©e\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003eRequ√™te 1 (500, 1000, 100)\u003c/td\u003e\n\u003ctd\u003e874ms\u003c/td\u003e\n\u003ctd\u003e74ms\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eRequ√™te 1 (5000, 10000, 100)\u003c/td\u003e\n\u003ctd\u003e9143ms\u003c/td\u003e\n\u003ctd\u003e569ms\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eRequ√™te 1 (500, 1000, 500)\u003c/td\u003e\n\u003ctd\u003e4212ms\u003c/td\u003e\n\u003ctd\u003e197ms\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eRequ√™te 2 (500, 1000, 100)\u003c/td\u003e\n\u003ctd\u003e726ms\u003c/td\u003e\n\u003ctd\u003e16ms\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eRequ√™te 2 (5000, 10000, 100)\u003c/td\u003e\n\u003ctd\u003e8648ms\u003c/td\u003e\n\u003ctd\u003e83ms\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eRequ√™te 2 (500, 1000, 500)\u003c/td\u003e\n\u003ctd\u003e4132ms\u003c/td\u003e\n\u003ctd\u003e27ms\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\u003c/div\u003e\n\n\u003cp\u003eCela saute aux yeux, la version d√©normalis√©e est plus rapide que la version normalis√©e et de loin lorsque l'on augmente la quantit√© de donn√©es. Les jointures sont des op√©rations tr√®s voraces. \u003cbr\u003e\nPour les bases normalis√©es la dur√©e semble plus ou moins corr√©l√©e √† la taille de la table de jointure. \u003cbr\u003e\nPrenons comme exemple la requ√™te 1 :\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e50000 entr√©es ‚Üí 874ms\u003c/li\u003e\n\u003cli\u003e500000 entr√©es ‚Üí 9143ms (x10 par rapport √† ci-dessus)\u003c/li\u003e\n\u003cli\u003e250000 entr√©es ‚Üí 4212ms (√∑2 par rapport √† ci-dessus)\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eLes valeurs sont similaires pour la requ√™te 2. Ainsi, la dur√©e devrait √©voluer lin√©airement par rapport √† la quantit√© de donn√©es. Ce n'est pas un ph√©nom√®ne que l'on peut observer avec la forme d√©normalis√©e, qui semble, mieux supporter l'augmentation de la quantit√© de donn√©es.\u003c/p\u003e\n\n\u003cp\u003eDe plus, on peut observer quelque chose d'int√©ressant sur la partie d√©normalis√©e. La requ√™te 2 est plus performante que la requ√™te 1. Autrement dit, requ√™ter sur la table qui ne porte pas le tableau d'identifiant est plus performant. Ce qui veut dire que l'on a int√©r√™t √† faire porter le tableau d'identifiants √† la table sur laquelle on ne veut pas faire de traitement complexe. Dans mon exemple si j'ai besoin de charger plus souvent les donn√©es relatives au bar, j'aurais tout int√©r√™t √† faire porter un \u003ccode\u003ebars_ids\u003c/code\u003e √† ma table \u003cstrong\u003ewines\u003c/strong\u003e, plut√¥t que de conserver le \u003ccode\u003ewines_ids\u003c/code\u003e.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"taille-des-tables\" href=\"#taille-des-tables\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Taille des tables\n\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--s6p3tfxZ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/u8dk6e76az4x8gtqsy2j.png\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--s6p3tfxZ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/u8dk6e76az4x8gtqsy2j.png\" alt=\"database-size\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eCes statistiques sont fournies par l'outil \u003ca href=\"https://www.sqlite.org/sqlanalyze.html\"\u003esqlite3_analyzer\u003c/a\u003e.\u003cbr\u003e\nLa version table des bars en version d√©normalis√©e est environ deux fois plus l√©g√®re que la version normalis√©e comprenant les tables \u003cstrong\u003ebars_normalized\u003c/strong\u003e et \u003cstrong\u003ebars_wines\u003c/strong\u003e.\u003cbr\u003e\nLa d√©normalisation en plus d'un gain de performances en lecture permet d'all√©ger la taille totale de notre base ! Qui l'e√ªt cru ?\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"conclusion\" href=\"#conclusion\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Conclusion\n\u003c/h1\u003e\n\n\u003cp\u003eLa d√©normalisation est assur√©ment une bonne solution pour gagner en performance de lecture. Cependant, il faut √™tre vigilant sur les op√©rations d'√©critures. Notamment, lors d'une suppression, on ne pourra pas profiter des suppressions en cascades offertes par les bases relationnelles.\u003c/p\u003e\n\n\u003cp\u003e√Ä travers cet article, je voulais aussi montrer que la d√©normalisation n'est pas un concept exclusif aux bases NoSQL. D'apr√®s les recherches rapides que j'ai pu effectu√©es, MySQL/MariaDB et PostreSQL supportent aussi la manipulation de JSON. Je ne jette pas le discredit sur les bases NoSQL, elles peuvent √™tre plus adapt√©es que les bases relationnelles dans certains cas, Redis et ElasticSearch sont de parfaits exemples. Mais il n'est pas n√©cessaire de mettre de c√¥t√© les solutions √©prouv√©es.\u003c/p\u003e\n\n\u003cp\u003eMerci de m'avoir lu.\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"liens\" href=\"#liens\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Liens\n\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://www.sqlitetutorial.net\"\u003ehttps://www.sqlitetutorial.net\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://stackoverflow.com/questions/49451777/sqlite-append-a-new-element-to-an-existing-array\"\u003ehttps://stackoverflow.com/questions/49451777/sqlite-append-a-new-element-to-an-existing-array\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"le-mot-de-la-fin\" href=\"#le-mot-de-la-fin\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Le mot de la fin\n\u003c/h1\u003e\n\n\u003cp\u003eMerci √† J√©r√©my Merle et Marvin Frachet pour la relecture.\u003c/p\u003e\n\n\u003cp\u003eQuand √† Val, l'autre J√©rem et Clapette üñïüòâ\u003c/p\u003e\n\n",
    "social_image": null,
    "body_markdown": "---\ntitle: SQLite, json et d√©normalisation\npublished: true\ndescription: Gagner en performance et en espace sur une base relationnelle en utilisant la d√©normalisation\ntags: sql, sqlite, db, perf\ncover_image: https://thepracticaldev.s3.amazonaws.com/i/9dj0ule138xxyos7zax4.jpg\n---\n\nEn parcourant la documentation de [SQLite](https://www.sqlite.org/docs.html) j'ai vu qu'il existait une extension nomm√©e [JSON1](https://www.sqlite.org/json1.html), qui, vous vous en doutez permet de manipuler du JSON au sein de SQLite.\n\nDans cet article, nous allons voir comment utiliser cette extension sur une base d√©normalis√©e et l'impact que cela peut avoir sur les performances de lecture.\n\nLe code utilis√© est disponible ici :\n\n{% github jean-smaug/demo-sqlite-denormalization no-readme %}\n\n# C'est quoi la d√©normalisation ?\n\nSi j'en crois [cette page](https://stph.scenari-community.org/bdd/0/co/optUC004.html). C'est un \"Processus consistant √† regrouper plusieurs tables li√©es par des r√©f√©rences, en une seule table, en r√©alisant statiquement les op√©rations de jointure ad√©quates.\"\n\nMa version, c'est de dire que l'on va s'autoriser √† ne pas utiliser les bonnes pratiques enseign√©es par nos professeurs #ThugLife. \nDans une base d√©normalis√©e on s'√©loigne (un peu) du Graal que repr√©sente la 3e forme normale et on s'autorise √† dupliquer des donn√©es notamment en rapatriant les donn√©es des tables de jointure dans les \"tables normales\".\nSi ce n'est toujours pas clair, l'exemple qui suit devrait vous aider √† mieux comprendre. \n\n# Les tables\n\nPlut√¥t que d'utiliser l'exemple des posts avec des tags, cette fois-ci, on va avoir des bars et des bouteilles de vin. On aura une relation de type many-to-many ou chaque bar peut proposer plusieurs vins et de la m√™me mani√®re, un vin peut √™tre servi dans plusieurs bars.\n\nNous aurons 4 tables :\n\n- **wines** : table des vins\n- **bars_normalized** : tables des bars\n- **bars_wines** : table de jointure entre wines et bars_normalized\n- **bars_denormalized** : la table des bars o√π les vins servis dans ce bar sont stock√©s en tant que tableau d'identifiant sous le champ wines_ids\n\n```sql\nCREATE TABLE IF NOT EXISTS wines (\n  id TEXT PRIMARY KEY,\n  name TEXT,\n  country TEXT,\n  year INTEGER\n);\n\nCREATE TABLE IF NOT EXISTS bars_normalized (\n  id TEXT PRIMARY KEY,\n  name TEXT\n);\n\nCREATE TABLE IF NOT EXISTS bars_wines (\n  bar_id TEXT,\n  wine_id TEXT\n);\n\nCREATE TABLE IF NOT EXISTS bars_denormalized (\n  id TEXT PRIMARY KEY,\n  name TEXT,\n  country TEXT,\n  wines_ids JSON /* contiendra: [\"wine-uuid-1\",\"wine-uuid-234\"...] */\n);\n```\n\n# Pr√©sentation de JSON1\n\nRegardons comment effectuer les op√©rations usuelles sur la table **bar_denormalized**.\n\n## Insertion\n\n```sql\nINSERT INTO bars_denormalized (id, name, wines_ids)\nVALUES (\n  'random-uuid',\n  'La taverne',\n  /* La m√©thode json() permet de v√©rifier que le JSON fourni est valide\n  et aussi de supprimer les espaces inutiles */\n  json('[\"wine-uuid-1\", \"wine-uuid-45\", \"wine-uuid-423\"]')\n);\n```\n\n## Lecture\n\n```sql\nSELECT DISTINCT bars_denormalized.id, bars_denormalized.name\n/* 1 - La m√©thode json_each() permet de s√©lectionner le champ \nsur lequel nous allons it√©rer */\nFROM bars_denormalized, json_each(bars_denormalized.wines_ids)\n/* 2 - Une fois qu'un champ a √©t√© s√©lctionn√© avec json_each(),\non peut utiliser json_each.value pour r√©cup√©rer la valeur\nde chacun des √©l√©ments du tableau */\nWHERE json_each.value = 'wine-uuid-1';\n```\n\nLa requ√™te ci-dessus va, pour chaque bar, it√©rer sur la tableau `wines_ids`. Et pour chaque √©lement du tableau, il va v√©rifier s'il est √©gal √† l'identifiant `wine-uuid-1`.\nAu final, cette requ√™te renvoie tous les bars proposant le vin ayant pour identifiant `wine-uuid-1`.\nSi nous avions eu un objet nous aurions pu utiliser la m√©thode `json_extract`. Si nous avions un tableau d'objets, la m√©thode `json_tree`.\n\n## Mise √† jour et suppression\n\nCes deux op√©rations vont fonctionner de mani√®re similaire. Dans un cas, on va venir ajouter un nouvel identifiant dans le tableau `wines_ids` et dans l'autre cas, on viendra en supprimer un.\n\n```sql\nUPDATE bars_denormalized\nSET wines_ids = (\n  /* 2 - On insert la valeur √† l'indice donn√©, √† la fin du tableau */\n  SELECT json_insert(\n    bars_denormalized.wines_ids,\n    /* 1 - On r√©cup√®re la longueur du tableau actuel, qui sera l'indice \n    du nouvel √©l√©ment */\n    '$[' || json_array_length(bars_denormalized.wines_ids) || ']',\n    'wine-uuid-297'\n  )\n)\nWHERE id = 'bar-uuid-3';\n```\n\nLa fonction `json_insert` prend trois param√®tres : \n- le champ dans lequel on va ins√©rer une valeur\n- l'indice auquel on va ins√©rer cette valeur \n- la valeur\n\n```sql\n/* 3 - On met √† jour le champ wines_ids avec le nouveau tableau */\nUPDATE bars_denormalized\nSET wines_ids = (\n  /* 2 - On retourne un tableau sans l'√©l√©ment dont l'indice a √©t√© \n  retourn√© par la sous-requ√™te en 1  */\n  SELECT json_remove(bars_denormalized.wines_ids,\n    '$[' || (\n      /* 1 - On cherche l'indice de l'√©l√©ment √† supprimer */\n      SELECT json_each.key \n      FROM json_each(bars_denormalized.wines_ids)\n      WHERE json_each.value = 'wine-uuid-297'\n  ) || ']'\n) \nWHERE id = 'bar-uuid-3';\n```\n\nLa fonction `json_remove` prend deux param√®tres : \n- le champ dans lequel on va retirer une valeur\n- l'indice de la valeur que l'on souhaite supprimer\n\n# Les requ√™tes\n\nPour tester les performances des deux sch√©mas de bases de donn√©es, les requ√™tes auront les buts suivants :\n\n1. obtenir les noms des bars proposant des vins datant des ann√©es sup√©rieures √† 2018\n2. obtenir les noms des vins portugais qui sont servis dans des bars du royaume-uni\n\nAvec ces deux requ√™tes, on pourra voir comment faire des requ√™tes \"dans les deux sens\".\n\nPour la version normalis√©e, on va effectuer une jointure entre les tables  **wines**, **bars_normalized** et **bars_wines**. On viendra ensuite appliquer les filtres selon nos besoins.\n\n```sql\nSELECT DISTINCT bars_normalized.id, bars_normalized.name\nFROM bars_normalized\nLEFT OUTER JOIN bars_wines\n  ON bars_normalized.id = bars_wines.bar_id\nLEFT OUTER JOIN wines\n  ON wines.id = bars_wines.wine_id\nWHERE year \u003e 2018;\n```\n\n```sql\nSELECT DISTINCT wines.id, wines.name\nFROM wines\nLEFT OUTER JOIN bars_wines\n  ON wines.id = bars_wines.wine_id\nLEFT OUTER JOIN bars_normalized\n  ON bars_normalized.id = bars_wines.bar_id\nWHERE bars_normalized.country = 'United Kingdom'\n  AND wines.country = 'Portugal';\n```\n\nConcernant la version d√©normalis√©e on va utiliser les m√©thodes fournies par l'extension JSON1, `json_each` dans notre cas.\n\n```sql\nSELECT DISTINCT bars_denormalized.id, name \nFROM bars_denormalized, json_each(bars_denormalized.wines_ids)\nWHERE json_each.value IN (\n  SELECT id\n  FROM wines\n  WHERE year \u003e 2018\n);\n```\n\n```sql\nSELECT DISTINCT wines.id, wines.name\nFROM wines\nWHERE id IN (\n  SELECT DISTINCT json_each.value AS id\n  FROM bars_denormalized, json_each(bars_denormalized.wines_ids)\n  WHERE bars_denormalized.country = 'United Kingdom'\n) AND wines.country = 'Portugal';\n```\n\nPetit apart√© concernant la requ√™te ci-dessus, ou plut√¥t la sous-requ√™te. Si on s'en tient au sens de lecture, il peut paraitre bizarre que j'utilise `json_each.value` dans le `SELECT` alors que je vais charger ces donn√©es dans la clause `FROM` qui est la ligne suivante. Et justement, il faut comprendre comment les bases relationnelles interpr√®tent les requ√™tes, elles sont execut√©es comme pr√©sent√©e dans le schema suivant.\n\n![sql-query-order](https://thepracticaldev.s3.amazonaws.com/i/12ay7mtvjfzjncgs7o5x.jpeg)\n\nAinsi, m√™me si cela ne semble pas naturel au vu du sens de lecture, c'est en revanche tout √† fait valide d'un point de vue technique. \n\n# R√©sultats\n\n## Lectures\n\nJ'ai effectu√© les tests en faisant varier diff√©rents param√®tres. Sur chacune des requ√™tes ci-dessous, les nombres entre parenth√®ses repr√©sentent : \n(nombre de bars, nombre de vins, nombre de vins par bar). \n\nLes r√©sultats sont des m√©dianes d'une s√©rie de 5 requ√™tes.\n\n|                              | Normalis√©e | D√©normalis√©e |\n|------------------------------|------------|--------------|\n| Requ√™te 1 (500, 1000, 100)   | 874ms      | 74ms         |\n| Requ√™te 1 (5000, 10000, 100) | 9143ms     | 569ms        |\n| Requ√™te 1 (500, 1000, 500)   | 4212ms     | 197ms        |\n| Requ√™te 2 (500, 1000, 100)   | 726ms      | 16ms         |\n| Requ√™te 2 (5000, 10000, 100) | 8648ms     | 83ms         |\n| Requ√™te 2 (500, 1000, 500)   | 4132ms     | 27ms         |\n\nCela saute aux yeux, la version d√©normalis√©e est plus rapide que la version normalis√©e et de loin lorsque l'on augmente la quantit√© de donn√©es. Les jointures sont des op√©rations tr√®s voraces. \nPour les bases normalis√©es la dur√©e semble plus ou moins corr√©l√©e √† la taille de la table de jointure. \nPrenons comme exemple la requ√™te 1 :\n- 50000 entr√©es \u0026rarr; 874ms\n- 500000 entr√©es \u0026rarr; 9143ms (x10 par rapport √† ci-dessus)\n- 250000 entr√©es \u0026rarr; 4212ms (√∑2 par rapport √† ci-dessus)\n\nLes valeurs sont similaires pour la requ√™te 2. Ainsi, la dur√©e devrait √©voluer lin√©airement par rapport √† la quantit√© de donn√©es. Ce n'est pas un ph√©nom√®ne que l'on peut observer avec la forme d√©normalis√©e, qui semble, mieux supporter l'augmentation de la quantit√© de donn√©es.\n\nDe plus, on peut observer quelque chose d'int√©ressant sur la partie d√©normalis√©e. La requ√™te 2 est plus performante que la requ√™te 1. Autrement dit, requ√™ter sur la table qui ne porte pas le tableau d'identifiant est plus performant. Ce qui veut dire que l'on a int√©r√™t √† faire porter le tableau d'identifiants √† la table sur laquelle on ne veut pas faire de traitement complexe. Dans mon exemple si j'ai besoin de charger plus souvent les donn√©es relatives au bar, j'aurais tout int√©r√™t √† faire porter un `bars_ids` √† ma table **wines**, plut√¥t que de conserver le `wines_ids`.\n\n## Taille des tables\n\n![database-size](https://thepracticaldev.s3.amazonaws.com/i/u8dk6e76az4x8gtqsy2j.png)\n\nCes statistiques sont fournies par l'outil [sqlite3_analyzer](https://www.sqlite.org/sqlanalyze.html).\nLa version table des bars en version d√©normalis√©e est environ deux fois plus l√©g√®re que la version normalis√©e comprenant les tables **bars_normalized** et **bars_wines**.\nLa d√©normalisation en plus d'un gain de performances en lecture permet d'all√©ger la taille totale de notre base ! Qui l'e√ªt cru ?\n\n# Conclusion\n\nLa d√©normalisation est assur√©ment une bonne solution pour gagner en performance de lecture. Cependant, il faut √™tre vigilant sur les op√©rations d'√©critures. Notamment, lors d'une suppression, on ne pourra pas profiter des suppressions en cascades offertes par les bases relationnelles.\n\n√Ä travers cet article, je voulais aussi montrer que la d√©normalisation n'est pas un concept exclusif aux bases NoSQL. D'apr√®s les recherches rapides que j'ai pu effectu√©es, MySQL/MariaDB et PostreSQL supportent aussi la manipulation de JSON. Je ne jette pas le discredit sur les bases NoSQL, elles peuvent √™tre plus adapt√©es que les bases relationnelles dans certains cas, Redis et ElasticSearch sont de parfaits exemples. Mais il n'est pas n√©cessaire de mettre de c√¥t√© les solutions √©prouv√©es.\n\nMerci de m'avoir lu.\n\n# Liens\n\n- [https://www.sqlitetutorial.net](https://www.sqlitetutorial.net)\n- [https://stackoverflow.com/questions/49451777/sqlite-append-a-new-element-to-an-existing-array](https://stackoverflow.com/questions/49451777/sqlite-append-a-new-element-to-an-existing-array)\n\n# Le mot de la fin\n\nMerci √† J√©r√©my Merle et Marvin Frachet pour la relecture.\n\nQuand √† Val, l'autre J√©rem et Clapette üñïüòâ",
    "canonical_url": null,
    "show_comments": true,
    "main_image_background_hex_color": "#dddddd",
    "published_from_feed": false,
    "comments_count": 7,
    "video": null,
    "video_code": null,
    "video_source_url": null,
    "video_thumbnail_url": null,
    "video_closed_caption_track_url": null,
    "feed_source_url": null,
    "positive_reactions_count": 4,
    "edited_at": "2019-11-01T11:56:37.635Z",
    "crossposted_at": null,
    "language": "fr",
    "cached_tag_list": "sql, sqlite, db, perf",
    "path": "/jeansmaug/sqlite-json-et-denormalisation-2bdm",
    "cached_user_name": "jean-smaug",
    "cached_user_username": "jeansmaug",
    "last_comment_at": "2019-10-29T09:12:46.057Z"
  },
  {
    "title": "SQLite, json and denormalization",
    "slug": "sqlite-json-and-denormalization-38mk-temp-slug-8383001",
    "created_at": "2019-10-22T10:49:50.145Z",
    "main_image": "https://thepracticaldev.s3.amazonaws.com/i/9dj0ule138xxyos7zax4.jpg",
    "description": "Improve performances and size of a relational database using denormalization",
    "published": false,
    "published_at": null,
    "processed_html": "\u003cp\u003eI was reading \u003ca href=\"https://www.sqlite.org/docs.html\"\u003eSQLite\u003c/a\u003e's documentation and I discovered an extension called \u003ca href=\"https://www.sqlite.org/json1.html\"\u003eJSON1\u003c/a\u003e, which, you guess, allow us to manipulate JSON inside SQLite.\u003c/p\u003e\n\n\u003cp\u003eIn this article we'll see how we can use this extension on a denormalied database. And the benefits it can have on the read performances\u003c/p\u003e\n\n\u003cp\u003eThe code used to generate the database is available here :\u003c/p\u003e\n\n\n\u003cdiv class=\"ltag-github-readme-tag\"\u003e\n  \u003cdiv class=\"readme-overview\"\u003e\n    \u003ch2\u003e\n      \u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--qF2jUiUG--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://practicaldev-herokuapp-com.freetls.fastly.net/assets/github-logo-6a5bca60a4ebf959a6df7f08217acd07ac2bc285164fae041eacb8a148b1bab9.svg\" alt=\"GitHub logo\" loading=\"lazy\"\u003e\n      \u003ca href=\"https://github.com/jean-smaug\"\u003e\n        jean-smaug\n      \u003c/a\u003e / \u003ca style=\"font-weight: 600;\" href=\"https://github.com/jean-smaug/demo-sqlite-denormalization\"\u003e\n        demo-sqlite-denormalization\n      \u003c/a\u003e\n    \u003c/h2\u003e\n    \u003ch3\u003e\n      \n    \u003c/h3\u003e\n  \u003c/div\u003e\n\u003c/div\u003e\n\n\n\u003ch1\u003e\n  \u003ca name=\"what-is-denormalization-\" href=\"#what-is-denormalization-\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  What is denormalization ?\n\u003c/h1\u003e\n\n\u003cp\u003eAccording to Wikipedia, \"denormalization is a strategy used on a previously-normalized database to increase performance. In computing, denormalization is the process of trying to improve the read performance of a database, at the expense of losing some write performance, by adding redundant copies of data or by grouping data.\"\u003c/p\u003e\n\n\u003cp\u003eI'll add that it's a mecanisme in which we're allowing ourselves to not use the goods practices taught by our teachers #ThugLife.\u003cbr\u003e\nWe forget about 3rd normal form by putting data from joins tables into \"normals tables\".\u003cbr\u003e\nIf it's still not clear, the following example should help.\u003c/p\u003e\n\u003ch1\u003e\n  \u003ca name=\"the-tables\" href=\"#the-tables\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  The tables\n\u003c/h1\u003e\n\n\u003cp\u003eInstead of using the classical example with posts and tags, this time, we'll use wines and bars. We'll have a many to many relationship where each bar can serve multiple wines and each wine can be served into multiple bars. \u003c/p\u003e\n\n\u003cp\u003eSo, we'll need four tables :\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003ewines\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003ebars_normalized\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003ebars_wines\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003e\n\u003cstrong\u003ebars_denormalized\u003c/strong\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight sql\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eCREATE\u003c/span\u003e \u003cspan class=\"k\"\u003eTABLE\u003c/span\u003e \u003cspan class=\"n\"\u003eIF\u003c/span\u003e \u003cspan class=\"k\"\u003eNOT\u003c/span\u003e \u003cspan class=\"k\"\u003eEXISTS\u003c/span\u003e \u003cspan class=\"n\"\u003ewines\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eid\u003c/span\u003e \u003cspan class=\"nb\"\u003eTEXT\u003c/span\u003e \u003cspan class=\"k\"\u003ePRIMARY\u003c/span\u003e \u003cspan class=\"k\"\u003eKEY\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"n\"\u003ename\u003c/span\u003e \u003cspan class=\"nb\"\u003eTEXT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"n\"\u003ecountry\u003c/span\u003e \u003cspan class=\"nb\"\u003eTEXT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nb\"\u003eyear\u003c/span\u003e \u003cspan class=\"nb\"\u003eINTEGER\u003c/span\u003e\n\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eCREATE\u003c/span\u003e \u003cspan class=\"k\"\u003eTABLE\u003c/span\u003e \u003cspan class=\"n\"\u003eIF\u003c/span\u003e \u003cspan class=\"k\"\u003eNOT\u003c/span\u003e \u003cspan class=\"k\"\u003eEXISTS\u003c/span\u003e \u003cspan class=\"n\"\u003ebars_normalized\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eid\u003c/span\u003e \u003cspan class=\"nb\"\u003eTEXT\u003c/span\u003e \u003cspan class=\"k\"\u003ePRIMARY\u003c/span\u003e \u003cspan class=\"k\"\u003eKEY\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"n\"\u003ename\u003c/span\u003e \u003cspan class=\"nb\"\u003eTEXT\u003c/span\u003e\n\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eCREATE\u003c/span\u003e \u003cspan class=\"k\"\u003eTABLE\u003c/span\u003e \u003cspan class=\"n\"\u003eIF\u003c/span\u003e \u003cspan class=\"k\"\u003eNOT\u003c/span\u003e \u003cspan class=\"k\"\u003eEXISTS\u003c/span\u003e \u003cspan class=\"n\"\u003ebars_wines\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"n\"\u003ebar_id\u003c/span\u003e \u003cspan class=\"nb\"\u003eTEXT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"n\"\u003ewine_id\u003c/span\u003e \u003cspan class=\"nb\"\u003eTEXT\u003c/span\u003e\n\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eCREATE\u003c/span\u003e \u003cspan class=\"k\"\u003eTABLE\u003c/span\u003e \u003cspan class=\"n\"\u003eIF\u003c/span\u003e \u003cspan class=\"k\"\u003eNOT\u003c/span\u003e \u003cspan class=\"k\"\u003eEXISTS\u003c/span\u003e \u003cspan class=\"n\"\u003ebars_denormalized\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eid\u003c/span\u003e \u003cspan class=\"nb\"\u003eTEXT\u003c/span\u003e \u003cspan class=\"k\"\u003ePRIMARY\u003c/span\u003e \u003cspan class=\"k\"\u003eKEY\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"n\"\u003ename\u003c/span\u003e \u003cspan class=\"nb\"\u003eTEXT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"n\"\u003ecountry\u003c/span\u003e \u003cspan class=\"nb\"\u003eTEXT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"n\"\u003ewines_ids\u003c/span\u003e \u003cspan class=\"n\"\u003eJSON\u003c/span\u003e \u003cspan class=\"cm\"\u003e/* will contain: [\"wine-uuid-1\",\"wine-uuid-234\"...] */\u003c/span\u003e\n\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"json1-presentation\" href=\"#json1-presentation\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  JSON1 presentation\n\u003c/h1\u003e\n\n\u003cp\u003eLet's look how we can do usuals operations on \u003cstrong\u003ebar_denormalized\u003c/strong\u003e.\u003c/p\u003e\n\u003ch2\u003e\n  \u003ca name=\"inserting\" href=\"#inserting\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Inserting\n\u003c/h2\u003e\n\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight sql\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eINSERT\u003c/span\u003e \u003cspan class=\"k\"\u003eINTO\u003c/span\u003e \u003cspan class=\"n\"\u003ebars_denormalized\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ewines_ids\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"k\"\u003eVALUES\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"s1\"\u003e'random-uuid'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"s1\"\u003e'La taverne'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"cm\"\u003e/* The json() function validate the provided JSON\n  and also remove useless spaces. */\u003c/span\u003e\n  \u003cspan class=\"n\"\u003ejson\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'[\"wine-uuid-1\", \"wine-uuid-45\", \"wine-uuid-423\"]'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"reading\" href=\"#reading\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Reading\n\u003c/h2\u003e\n\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight sql\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eSELECT\u003c/span\u003e \u003cspan class=\"k\"\u003eDISTINCT\u003c/span\u003e \u003cspan class=\"n\"\u003ebars_denormalized\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebars_denormalized\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\n\u003cspan class=\"cm\"\u003e/* 1 - The json_each() function gives us the ability\nto iterate over a field */\u003c/span\u003e\n\u003cspan class=\"k\"\u003eFROM\u003c/span\u003e \u003cspan class=\"n\"\u003ebars_denormalized\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ejson_each\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebars_denormalized\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewines_ids\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"cm\"\u003e/* 2 - When a field has been selected with json_each(),\nwe can use json_each.value to get the value of each item\nof the array */\u003c/span\u003e\n\u003cspan class=\"k\"\u003eWHERE\u003c/span\u003e \u003cspan class=\"n\"\u003ejson_each\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'wine-uuid-1'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\u003cp\u003eThe query above will, for each bar, iterate over the \u003ccode\u003ewines_ids\u003c/code\u003e array. And for each item of this array, it will verify if this value equal \u003ccode\u003ewine-uuid-1\u003c/code\u003e.\u003cbr\u003e\nFinally this query is returning all bars that serve wines having \u003ccode\u003ewine-uuid-1\u003c/code\u003e as identifier.\u003cbr\u003e\nIf we had an object we could have used the \u003ccode\u003ejson_extract\u003c/code\u003e function. And for and array of object, the \u003ccode\u003ejson_tree\u003c/code\u003e function.\u003c/p\u003e\n\u003ch2\u003e\n  \u003ca name=\"updating-and-deleting\" href=\"#updating-and-deleting\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Updating and deleting\n\u003c/h2\u003e\n\n\u003cp\u003eBoth operations will almost act the same. In th first case we'll push a new item into the \u003ccode\u003ewines_ids\u003c/code\u003e array and in the second case we'll remove one.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight sql\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eUPDATE\u003c/span\u003e \u003cspan class=\"n\"\u003ebars_denormalized\u003c/span\u003e\n\u003cspan class=\"k\"\u003eSET\u003c/span\u003e \u003cspan class=\"n\"\u003ewines_ids\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"cm\"\u003e/* 2 - We insert the data at the given index, in other words,\n  the end of the array */\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eSELECT\u003c/span\u003e \u003cspan class=\"n\"\u003ejson_insert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ebars_denormalized\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewines_ids\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"cm\"\u003e/* 1 - We get the length of the array, which will be the index\n    of the new item */\u003c/span\u003e\n    \u003cspan class=\"s1\"\u003e'$['\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"n\"\u003ejson_array_length\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebars_denormalized\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewines_ids\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"s1\"\u003e']'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s1\"\u003e'wine-uuid-297'\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"k\"\u003eWHERE\u003c/span\u003e \u003cspan class=\"n\"\u003eid\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'bar-uuid-3'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eThe \u003ccode\u003ejson_insert\u003c/code\u003e function takes three parameters : \u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003ethe field we want inserting a new value\u003c/li\u003e\n\u003cli\u003ethe index where  the value should be inserted\u003c/li\u003e\n\u003cli\u003ethe value\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight sql\"\u003e\u003ccode\u003e\u003cspan class=\"cm\"\u003e/* 3 - We update wines_ids with our new array */\u003c/span\u003e\n\u003cspan class=\"k\"\u003eUPDATE\u003c/span\u003e \u003cspan class=\"n\"\u003ebars_denormalized\u003c/span\u003e\n\u003cspan class=\"k\"\u003eSET\u003c/span\u003e \u003cspan class=\"n\"\u003ewines_ids\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"cm\"\u003e/* 2 - We return an array without the item that should be removed */\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eSELECT\u003c/span\u003e \u003cspan class=\"n\"\u003ejson_remove\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebars_denormalized\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewines_ids\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s1\"\u003e'$['\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\n      \u003cspan class=\"cm\"\u003e/* 1 - We search the index of the item to remove */\u003c/span\u003e\n      \u003cspan class=\"k\"\u003eSELECT\u003c/span\u003e \u003cspan class=\"n\"\u003ejson_each\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"k\"\u003ekey\u003c/span\u003e \n      \u003cspan class=\"k\"\u003eFROM\u003c/span\u003e \u003cspan class=\"n\"\u003ejson_each\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebars_denormalized\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewines_ids\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"k\"\u003eWHERE\u003c/span\u003e \u003cspan class=\"n\"\u003ejson_each\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'wine-uuid-297'\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"s1\"\u003e']'\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e \n\u003cspan class=\"k\"\u003eWHERE\u003c/span\u003e \u003cspan class=\"n\"\u003eid\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'bar-uuid-3'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eThe \u003ccode\u003ejson_remove\u003c/code\u003e function takes two parameters : \u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003ethe field we want removing a value\u003c/li\u003e\n\u003cli\u003ethe index of the value that we want to remove\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"request\" href=\"#request\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Request\n\u003c/h1\u003e\n\n\u003cp\u003eIn order to test performances of both data model, we'll perform two queries :\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eobtain the bars names serving wines that are more recent than 2018\u003c/li\u003e\n\u003cli\u003eobtain the wines names of Portuguese's wines served into UK's bars\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eWith these two queries, we'll be able to see how to get data ob each table.\u003c/p\u003e\n\n\u003cp\u003eFor the normalized version we'll make a joint between the \u003cstrong\u003ewines\u003c/strong\u003e, \u003cstrong\u003ebars_normalized\u003c/strong\u003e and \u003cstrong\u003ebars_wines\u003c/strong\u003e tables. After the joint we'll apply filter based on our needs.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight sql\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eSELECT\u003c/span\u003e \u003cspan class=\"k\"\u003eDISTINCT\u003c/span\u003e \u003cspan class=\"n\"\u003ebars_normalized\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebars_normalized\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\n\u003cspan class=\"k\"\u003eFROM\u003c/span\u003e \u003cspan class=\"n\"\u003ebars_normalized\u003c/span\u003e\n\u003cspan class=\"k\"\u003eLEFT\u003c/span\u003e \u003cspan class=\"k\"\u003eOUTER\u003c/span\u003e \u003cspan class=\"k\"\u003eJOIN\u003c/span\u003e \u003cspan class=\"n\"\u003ebars_wines\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eON\u003c/span\u003e \u003cspan class=\"n\"\u003ebars_normalized\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ebars_wines\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebar_id\u003c/span\u003e\n\u003cspan class=\"k\"\u003eLEFT\u003c/span\u003e \u003cspan class=\"k\"\u003eOUTER\u003c/span\u003e \u003cspan class=\"k\"\u003eJOIN\u003c/span\u003e \u003cspan class=\"n\"\u003ewines\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eON\u003c/span\u003e \u003cspan class=\"n\"\u003ewines\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ebars_wines\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewine_id\u003c/span\u003e\n\u003cspan class=\"k\"\u003eWHERE\u003c/span\u003e \u003cspan class=\"nb\"\u003eyear\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e2018\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight sql\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eSELECT\u003c/span\u003e \u003cspan class=\"k\"\u003eDISTINCT\u003c/span\u003e \u003cspan class=\"n\"\u003ewines\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ewines\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\n\u003cspan class=\"k\"\u003eFROM\u003c/span\u003e \u003cspan class=\"n\"\u003ewines\u003c/span\u003e\n\u003cspan class=\"k\"\u003eLEFT\u003c/span\u003e \u003cspan class=\"k\"\u003eOUTER\u003c/span\u003e \u003cspan class=\"k\"\u003eJOIN\u003c/span\u003e \u003cspan class=\"n\"\u003ebars_wines\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eON\u003c/span\u003e \u003cspan class=\"n\"\u003ewines\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ebars_wines\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewine_id\u003c/span\u003e\n\u003cspan class=\"k\"\u003eLEFT\u003c/span\u003e \u003cspan class=\"k\"\u003eOUTER\u003c/span\u003e \u003cspan class=\"k\"\u003eJOIN\u003c/span\u003e \u003cspan class=\"n\"\u003ebars_normalized\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eON\u003c/span\u003e \u003cspan class=\"n\"\u003ebars_normalized\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ebars_wines\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebar_id\u003c/span\u003e\n\u003cspan class=\"k\"\u003eWHERE\u003c/span\u003e \u003cspan class=\"n\"\u003ebars_normalized\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecountry\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'United Kingdom'\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eAND\u003c/span\u003e \u003cspan class=\"n\"\u003ewines\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecountry\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'Portugal'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eFor the denormalized version we'll use the functions which are provided by the JSON1 extension, \u003ccode\u003ejson_each\u003c/code\u003e in this case.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight sql\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eSELECT\u003c/span\u003e \u003cspan class=\"k\"\u003eDISTINCT\u003c/span\u003e \u003cspan class=\"n\"\u003ebars_denormalized\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e \n\u003cspan class=\"k\"\u003eFROM\u003c/span\u003e \u003cspan class=\"n\"\u003ebars_denormalized\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ejson_each\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebars_denormalized\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewines_ids\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"k\"\u003eWHERE\u003c/span\u003e \u003cspan class=\"n\"\u003ejson_each\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e \u003cspan class=\"k\"\u003eIN\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eSELECT\u003c/span\u003e \u003cspan class=\"n\"\u003eid\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eFROM\u003c/span\u003e \u003cspan class=\"n\"\u003ewines\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eWHERE\u003c/span\u003e \u003cspan class=\"nb\"\u003eyear\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e2018\u003c/span\u003e\n\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight sql\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eSELECT\u003c/span\u003e \u003cspan class=\"k\"\u003eDISTINCT\u003c/span\u003e \u003cspan class=\"n\"\u003ewines\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ewines\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\n\u003cspan class=\"k\"\u003eFROM\u003c/span\u003e \u003cspan class=\"n\"\u003ewines\u003c/span\u003e\n\u003cspan class=\"k\"\u003eWHERE\u003c/span\u003e \u003cspan class=\"n\"\u003eid\u003c/span\u003e \u003cspan class=\"k\"\u003eIN\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eSELECT\u003c/span\u003e \u003cspan class=\"k\"\u003eDISTINCT\u003c/span\u003e \u003cspan class=\"n\"\u003ejson_each\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e \u003cspan class=\"k\"\u003eAS\u003c/span\u003e \u003cspan class=\"n\"\u003eid\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eFROM\u003c/span\u003e \u003cspan class=\"n\"\u003ebars_denormalized\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ejson_each\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebars_denormalized\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewines_ids\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eWHERE\u003c/span\u003e \u003cspan class=\"n\"\u003ebars_denormalized\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecountry\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'United Kingdom'\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003eAND\u003c/span\u003e \u003cspan class=\"n\"\u003ewines\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecountry\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'Portugal'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eLet's talk a little bit about the query above, or more precisely about the sub-query. If we just read it, it can be strange to see that i'm using the \u003ccode\u003ejson_each.value\u003c/code\u003e inside the \u003ccode\u003eSELECT\u003c/code\u003e whereas I will get this information into the \u003ccode\u003eFROM\u003c/code\u003e which is the next line. That's the point ! It's necessary to understand that relationnal databases are treating queries. They are executed like described in the following schema.\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--71zs0ix5--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/12ay7mtvjfzjncgs7o5x.jpeg\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--71zs0ix5--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/12ay7mtvjfzjncgs7o5x.jpeg\" alt=\"sql-query-order\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eEven if it can be strange according the reading direction, it's perfectly valid on a technical side.\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"results\" href=\"#results\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Results\n\u003c/h1\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"reads\" href=\"#reads\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Reads\n\u003c/h2\u003e\n\n\u003cp\u003eI've made tests with various parameters. On each query I changed some parameters.\u003cbr\u003e\nOn queries below, number in parenthesis represents :\u003cbr\u003e\n(number of bars, number of wines, number of wines per bar). \u003c/p\u003e\n\n\u003cp\u003eResults are based on a median of five values per query.\u003c/p\u003e\n\n\u003cdiv class=\"table-wrapper-paragraph\"\u003e\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e\u003c/th\u003e\n\u003cth\u003eNormalized\u003c/th\u003e\n\u003cth\u003eDenormalized\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003eQuery 1 (500, 1000, 100)\u003c/td\u003e\n\u003ctd\u003e874ms\u003c/td\u003e\n\u003ctd\u003e74ms\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eQuery 1 (5000, 10000, 100)\u003c/td\u003e\n\u003ctd\u003e9143ms\u003c/td\u003e\n\u003ctd\u003e569ms\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eQuery 1 (500, 1000, 500)\u003c/td\u003e\n\u003ctd\u003e4212ms\u003c/td\u003e\n\u003ctd\u003e197ms\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eQuery 2 (500, 1000, 100)\u003c/td\u003e\n\u003ctd\u003e726ms\u003c/td\u003e\n\u003ctd\u003e16ms\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eQuery 2 (5000, 10000, 100)\u003c/td\u003e\n\u003ctd\u003e8648ms\u003c/td\u003e\n\u003ctd\u003e83ms\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eQuery 2 (500, 1000, 500)\u003c/td\u003e\n\u003ctd\u003e4132ms\u003c/td\u003e\n\u003ctd\u003e27ms\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\u003c/div\u003e\n\n\u003cp\u003eCela saute aux yeux, la version d√©normalis√©e est plus rapide que la version normalis√©e et de loin lorsque l'on augmente la quantit√© de donn√©es. Les jointures sont des op√©rations tr√®s voraces. \u003cbr\u003e\nPour les bases normalis√©es la dur√©e semble plus ou moins corr√©l√© √† la taille de la table de jointure. \u003cbr\u003e\nPrenons comme exemple la requ√™te 1 :\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e50000 entr√©e ‚Üí 874ms\u003c/li\u003e\n\u003cli\u003e500000 entr√©e ‚Üí 9143ms (x10 par rapport √† ci-dessus)\u003c/li\u003e\n\u003cli\u003e250000 entr√©e ‚Üí 4212ms (√∑2 par rapport √† ci-dessus)\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eLes valeurs sont similaires pour la requ√™te 2. Ainsi, la dur√©e devrait √©voluer lin√©airement par rapport √† la quantit√© de donn√©es. Ce n'est pas un ph√©nom√®ne que l'on peut observer avec la forme d√©normalis√©e, qui semble, mieux supporter l'augmentation de la quantit√© de donn√©es.\u003c/p\u003e\n\n\u003cp\u003eDe plus, on peut observer quelque chose d'int√©ressant sur la partie d√©normalis√©e. La requ√™te 2 est plus performante que la requ√™te 1. Autrement dit, requ√™ter sur la table qui ne porte pas le tableau d'identifiant est plus performant. Ce qui veut dire que l'on a int√©r√™t √† faire porter le tableau d'identifiants √† la table sur laquelle on ne veut pas faire de traitement complexe. Dans mon exemple si j'ai besoin de charger plus souvent les donn√©es relatives au bar, j'aurais tout int√©r√™t √† faire porter un \u003ccode\u003ebars_ids\u003c/code\u003e √† ma table \u003cstrong\u003ewines\u003c/strong\u003e, plut√¥t que de conserver le \u003ccode\u003ewines_ids\u003c/code\u003e.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"tables-size\" href=\"#tables-size\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Tables size\n\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--s6p3tfxZ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/u8dk6e76az4x8gtqsy2j.png\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--s6p3tfxZ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/u8dk6e76az4x8gtqsy2j.png\" alt=\"database-size\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eThese statistics are provided by \u003ca href=\"https://www.sqlite.org/sqlanalyze.html\"\u003esqlite3_analyzer\u003c/a\u003e.\u003cbr\u003e\nThe denormalized version is two times lighter than the normalized one which includes \u003cstrong\u003ebars_normalized\u003c/strong\u003e and \u003cstrong\u003ebars_wines\u003c/strong\u003e.\u003cbr\u003e\nWe're winning on on performances and on database size.\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"conclusion\" href=\"#conclusion\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Conclusion\n\u003c/h1\u003e\n\n\u003cp\u003eDenormalization is a great solution to gain space and reading performances. But, we have to care more about writing operations. For example during deletions we will not be able to use the cascad deletions provided by RDBMS.\u003c/p\u003e\n\n\u003cp\u003eThrough this post I wanted to show that denormalization isn't a concept reserved for NoSQL. Based on my researches, MySQL/MariaDB and PostreSQL also provide JSON manipulations. I'm not saying that NoSQL databases are bad, they can be more adapted in certains use cases, Redis and ElasticSearch are perfect examples. But it's not necessary to throw away solutions that resists to time. \u003c/p\u003e\n\n\u003cp\u003eThanks for reading.\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"links\" href=\"#links\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Links\n\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://www.sqlitetutorial.net\"\u003ehttps://www.sqlitetutorial.net\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://stackoverflow.com/questions/49451777/sqlite-append-a-new-element-to-an-existing-array\"\u003ehttps://stackoverflow.com/questions/49451777/sqlite-append-a-new-element-to-an-existing-array\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n",
    "social_image": null,
    "body_markdown": "---\ntitle: SQLite, json and denormalization\npublished: false\ndescription: Improve performances and size of a relational database using denormalization\ntags: sqlite, db, perf\ncover_image: https://thepracticaldev.s3.amazonaws.com/i/9dj0ule138xxyos7zax4.jpg\n---\n\nI was reading [SQLite](https://www.sqlite.org/docs.html)'s documentation and I discovered an extension called [JSON1](https://www.sqlite.org/json1.html), which, you guess, allow us to manipulate JSON inside SQLite.\n\nIn this article we'll see how we can use this extension on a denormalied database. And the benefits it can have on the read performances\n\nThe code used to generate the database is available here :\n\n{% github jean-smaug/sqlite-denormalization no-readme %}\n\n# What is denormalization ?\n\nAccording to Wikipedia, \"denormalization is a strategy used on a previously-normalized database to increase performance. In computing, denormalization is the process of trying to improve the read performance of a database, at the expense of losing some write performance, by adding redundant copies of data or by grouping data.\"\n\nI'll add that it's a mecanisme in which we're allowing ourselves to not use the goods practices taught by our teachers #ThugLife.\nWe forget about 3rd normal form by putting data from joins tables into \"normals tables\".\nIf it's still not clear, the following example should help.\n\n# The tables\n\nInstead of using the classical example with posts and tags, this time, we'll use wines and bars. We'll have a many to many relationship where each bar can serve multiple wines and each wine can be served into multiple bars. \n\nSo, we'll need four tables :\n\n- **wines**\n- **bars_normalized**\n- **bars_wines**\n- **bars_denormalized**\n\n```sql\nCREATE TABLE IF NOT EXISTS wines (\n  id TEXT PRIMARY KEY,\n  name TEXT,\n  country TEXT,\n  year INTEGER\n);\n\nCREATE TABLE IF NOT EXISTS bars_normalized (\n  id TEXT PRIMARY KEY,\n  name TEXT\n);\n\nCREATE TABLE IF NOT EXISTS bars_wines (\n  bar_id TEXT,\n  wine_id TEXT\n);\n\nCREATE TABLE IF NOT EXISTS bars_denormalized (\n  id TEXT PRIMARY KEY,\n  name TEXT,\n  country TEXT,\n  wines_ids JSON /* will contain: [\"wine-uuid-1\",\"wine-uuid-234\"...] */\n);\n```\n\n# JSON1 presentation\n\nLet's look how we can do usuals operations on **bar_denormalized**.\n\n## Inserting\n\n```sql\nINSERT INTO bars_denormalized (id, name, wines_ids)\nVALUES (\n  'random-uuid',\n  'La taverne',\n  /* The json() function validate the provided JSON\n  and also remove useless spaces. */\n  json('[\"wine-uuid-1\", \"wine-uuid-45\", \"wine-uuid-423\"]')\n);\n```\n\n## Reading\n\n```sql\nSELECT DISTINCT bars_denormalized.id, bars_denormalized.name\n/* 1 - The json_each() function gives us the ability\nto iterate over a field */\nFROM bars_denormalized, json_each(bars_denormalized.wines_ids)\n/* 2 - When a field has been selected with json_each(),\nwe can use json_each.value to get the value of each item\nof the array */\nWHERE json_each.value = 'wine-uuid-1';\n```\nThe query above will, for each bar, iterate over the `wines_ids` array. And for each item of this array, it will verify if this value equal `wine-uuid-1`.\nFinally this query is returning all bars that serve wines having `wine-uuid-1` as identifier.\nIf we had an object we could have used the `json_extract` function. And for and array of object, the `json_tree` function.\n\n## Updating and deleting\n\nBoth operations will almost act the same. In th first case we'll push a new item into the `wines_ids` array and in the second case we'll remove one.\n\n```sql\nUPDATE bars_denormalized\nSET wines_ids = (\n  /* 2 - We insert the data at the given index, in other words,\n  the end of the array */\n  SELECT json_insert(\n    bars_denormalized.wines_ids,\n    /* 1 - We get the length of the array, which will be the index\n    of the new item */\n    '$[' || json_array_length(bars_denormalized.wines_ids) || ']',\n    'wine-uuid-297'\n  )\n)\nWHERE id = 'bar-uuid-3';\n```\n\nThe `json_insert` function takes three parameters : \n- the field we want inserting a new value\n- the index where  the value should be inserted\n- the value\n\n```sql\n/* 3 - We update wines_ids with our new array */\nUPDATE bars_denormalized\nSET wines_ids = (\n  /* 2 - We return an array without the item that should be removed */\n  SELECT json_remove(bars_denormalized.wines_ids,\n    '$[' || (\n      /* 1 - We search the index of the item to remove */\n      SELECT json_each.key \n      FROM json_each(bars_denormalized.wines_ids)\n      WHERE json_each.value = 'wine-uuid-297'\n  ) || ']'\n) \nWHERE id = 'bar-uuid-3';\n```\n\nThe `json_remove` function takes two parameters : \n- the field we want removing a value\n- the index of the value that we want to remove\n\n# Request\n\nIn order to test performances of both data model, we'll perform two queries :\n\n1. obtain the bars names serving wines that are more recent than 2018\n2. obtain the wines names of Portuguese's wines served into UK's bars\n\nWith these two queries, we'll be able to see how to get data ob each table.\n\nFor the normalized version we'll make a joint between the **wines**, **bars_normalized** and **bars_wines** tables. After the joint we'll apply filter based on our needs.\n\n```sql\nSELECT DISTINCT bars_normalized.id, bars_normalized.name\nFROM bars_normalized\nLEFT OUTER JOIN bars_wines\n  ON bars_normalized.id = bars_wines.bar_id\nLEFT OUTER JOIN wines\n  ON wines.id = bars_wines.wine_id\nWHERE year \u003e 2018;\n```\n\n```sql\nSELECT DISTINCT wines.id, wines.name\nFROM wines\nLEFT OUTER JOIN bars_wines\n  ON wines.id = bars_wines.wine_id\nLEFT OUTER JOIN bars_normalized\n  ON bars_normalized.id = bars_wines.bar_id\nWHERE bars_normalized.country = 'United Kingdom'\n  AND wines.country = 'Portugal';\n```\n\nFor the denormalized version we'll use the functions which are provided by the JSON1 extension, `json_each` in this case.\n\n```sql\nSELECT DISTINCT bars_denormalized.id, name \nFROM bars_denormalized, json_each(bars_denormalized.wines_ids)\nWHERE json_each.value IN (\n  SELECT id\n  FROM wines\n  WHERE year \u003e 2018\n);\n```\n\n```sql\nSELECT DISTINCT wines.id, wines.name\nFROM wines\nWHERE id IN (\n  SELECT DISTINCT json_each.value AS id\n  FROM bars_denormalized, json_each(bars_denormalized.wines_ids)\n  WHERE bars_denormalized.country = 'United Kingdom'\n) AND wines.country = 'Portugal';\n```\n\nLet's talk a little bit about the query above, or more precisely about the sub-query. If we just read it, it can be strange to see that i'm using the `json_each.value` inside the `SELECT` whereas I will get this information into the `FROM` which is the next line. That's the point ! It's necessary to understand that relationnal databases are treating queries. They are executed like described in the following schema.\n\n![sql-query-order](https://thepracticaldev.s3.amazonaws.com/i/12ay7mtvjfzjncgs7o5x.jpeg)\n\nEven if it can be strange according the reading direction, it's perfectly valid on a technical side.\n\n# Results\n\n## Reads\n\nI've made tests with various parameters. On each query I changed some parameters.\nOn queries below, number in parenthesis represents :\n(number of bars, number of wines, number of wines per bar). \n\nResults are based on a median of five values per query.\n\n|                              | Normalized | Denormalized |\n|------------------------------|------------|--------------|\n| Query 1 (500, 1000, 100)     | 874ms      | 74ms         |\n| Query 1 (5000, 10000, 100)   | 9143ms     | 569ms        |\n| Query 1 (500, 1000, 500)     | 4212ms     | 197ms        |\n| Query 2 (500, 1000, 100)     | 726ms      | 16ms         |\n| Query 2 (5000, 10000, 100)   | 8648ms     | 83ms         |\n| Query 2 (500, 1000, 500)     | 4132ms     | 27ms         |\n\nCela saute aux yeux, la version d√©normalis√©e est plus rapide que la version normalis√©e et de loin lorsque l'on augmente la quantit√© de donn√©es. Les jointures sont des op√©rations tr√®s voraces. \nPour les bases normalis√©es la dur√©e semble plus ou moins corr√©l√© √† la taille de la table de jointure. \nPrenons comme exemple la requ√™te 1 :\n- 50000 entr√©e \u0026rarr; 874ms\n- 500000 entr√©e \u0026rarr; 9143ms (x10 par rapport √† ci-dessus)\n- 250000 entr√©e \u0026rarr; 4212ms (√∑2 par rapport √† ci-dessus)\n\nLes valeurs sont similaires pour la requ√™te 2. Ainsi, la dur√©e devrait √©voluer lin√©airement par rapport √† la quantit√© de donn√©es. Ce n'est pas un ph√©nom√®ne que l'on peut observer avec la forme d√©normalis√©e, qui semble, mieux supporter l'augmentation de la quantit√© de donn√©es.\n\nDe plus, on peut observer quelque chose d'int√©ressant sur la partie d√©normalis√©e. La requ√™te 2 est plus performante que la requ√™te 1. Autrement dit, requ√™ter sur la table qui ne porte pas le tableau d'identifiant est plus performant. Ce qui veut dire que l'on a int√©r√™t √† faire porter le tableau d'identifiants √† la table sur laquelle on ne veut pas faire de traitement complexe. Dans mon exemple si j'ai besoin de charger plus souvent les donn√©es relatives au bar, j'aurais tout int√©r√™t √† faire porter un `bars_ids` √† ma table **wines**, plut√¥t que de conserver le `wines_ids`.\n\n## Tables size\n\n![database-size](https://thepracticaldev.s3.amazonaws.com/i/u8dk6e76az4x8gtqsy2j.png)\n\nThese statistics are provided by [sqlite3_analyzer](https://www.sqlite.org/sqlanalyze.html).\nThe denormalized version is two times lighter than the normalized one which includes **bars_normalized** and **bars_wines**.\nWe're winning on on performances and on database size.\n\n# Conclusion\n\nDenormalization is a great solution to gain space and reading performances. But, we have to care more about writing operations. For example during deletions we will not be able to use the cascad deletions provided by RDBMS.\n\nThrough this post I wanted to show that denormalization isn't a concept reserved for NoSQL. Based on my researches, MySQL/MariaDB and PostreSQL also provide JSON manipulations. I'm not saying that NoSQL databases are bad, they can be more adapted in certains use cases, Redis and ElasticSearch are perfect examples. But it's not necessary to throw away solutions that resists to time. \n\nThanks for reading.\n\n# Links\n\n- [https://www.sqlitetutorial.net](https://www.sqlitetutorial.net)\n- [https://stackoverflow.com/questions/49451777/sqlite-append-a-new-element-to-an-existing-array](https://stackoverflow.com/questions/49451777/sqlite-append-a-new-element-to-an-existing-array)",
    "canonical_url": null,
    "show_comments": true,
    "main_image_background_hex_color": "#dddddd",
    "published_from_feed": false,
    "comments_count": 0,
    "video": null,
    "video_code": null,
    "video_source_url": null,
    "video_thumbnail_url": null,
    "video_closed_caption_track_url": null,
    "feed_source_url": null,
    "positive_reactions_count": 0,
    "edited_at": null,
    "crossposted_at": null,
    "language": "fr",
    "cached_tag_list": "sqlite, db, perf",
    "path": "/jeansmaug/sqlite-json-and-denormalization-38mk-temp-slug-8383001",
    "cached_user_name": "jean-smaug",
    "cached_user_username": "jeansmaug",
    "last_comment_at": "2017-01-01T05:00:00.000Z"
  },
  {
    "title": "Git, configuration et fourberies",
    "slug": "git-configuration-et-fourberies-2ajc",
    "created_at": "2019-10-28T12:47:47.921Z",
    "main_image": "https://thepracticaldev.s3.amazonaws.com/i/9ajlkl8jv168bup7cdl8.png",
    "description": "Comment configurer Git pour son usage personnel et pour troller ses coll√®gues ",
    "published": true,
    "published_at": "2019-10-29T07:54:28.150Z",
    "processed_html": "\u003cp\u003eSouvenez-vous, les lignes de commandes suivantes sont celles que vous avez ex√©cut√©es apr√®s avoir install√© Git.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight shell\"\u003e\u003ccode\u003egit config \u003cspan class=\"nt\"\u003e--global\u003c/span\u003e user.name jean-smaug\ngit config \u003cspan class=\"nt\"\u003e--global\u003c/span\u003e user.email maximeblanc.dev@gmail.fr\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eElles ont permis √† Git de vous connaitre en tant qu'utilisateur. Preuve en est, si vous faites un \u003ccode\u003egit log --pretty=full\u003c/code\u003e, votre nom d'utilisateur et votre email sont associ√©s √† tous les commits que vous avez cr√©√©s.\u003c/p\u003e\n\n\u003cp\u003eVous √™tes-vous d√©j√† demand√© pourquoi il y avait un \u003ccode\u003e--global\u003c/code\u003e dans cette commande ?\u003cbr\u003e\nAujourd'hui on r√©pond √† cette question et on voit comment gagner du temps dans l'utilisation de Git.  \u003c/p\u003e\n\u003ch1\u003e\n  \u003ca name=\"les-fichiers-de-configuration\" href=\"#les-fichiers-de-configuration\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Les fichiers de configuration\n\u003c/h1\u003e\n\n\u003cp\u003eIl existe trois fichiers de configuration : \u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003cstrong\u003esyst√®me\u003c/strong\u003e : relatif √† la machine, nous ne l'utiliserons pas \u003c/li\u003e\n\u003cli\u003e\n\u003cstrong\u003eglobal\u003c/strong\u003e : relatif √† un utilisateur du syst√®me\u003c/li\u003e\n\u003cli\u003e\n\u003cstrong\u003elocal\u003c/strong\u003e : relatif au d√©p√¥t\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eAvec cette information vous aurez compris que si on configurait l'utilisateur sans l'option \u003ccode\u003e--global\u003c/code\u003e on devrait le configurer pour chacun de nos d√©p√¥ts Git. Dans une logique de non-perte de temps, ce n'est pas la meilleure solution.\u003c/p\u003e\n\n\u003cp\u003eLes chemins des fichiers de configuration sont les suivants :\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003e~/.gitconfig\u003c/code\u003e pour le global\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003edossier-projet/.git/config\u003c/code\u003e pour le local \u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eCommen√ßons par inspecter le fichier de configuration globale. Soit vous l'ouvrez √† l'emplacement pr√©c√©demment mentionn√© soit vous pouvez lancer la commande \u003ccode\u003egit config --global --edit\u003c/code\u003e. Il est √©crit en \u003ca href=\"https://github.com/toml-lang/toml\"\u003eTOML\u003c/a\u003e et ressemble √† cela :\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight shell\"\u003e\u003ccode\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003euser]\n    email \u003cspan class=\"o\"\u003e=\u003c/span\u003e maximeblanc.dev@gmail.com\n    name \u003cspan class=\"o\"\u003e=\u003c/span\u003e jean-smaug\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eCet exemple contient la section \u003cstrong\u003euser\u003c/strong\u003e que l'on a configur√© via la ligne de commande. Il est bien entendu possible de configurer Git en √©ditant de fichier manuellement.\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"hi%C3%A9rarchie-de-configuration\" href=\"#hi%C3%A9rarchie-de-configuration\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Hi√©rarchie de configuration\n\u003c/h1\u003e\n\n\u003cp\u003eImaginons que la configuration globale utilis√©e est celle de mon ordinateur personnel et que je doive travailler sur un projet d'entreprise. Je ne vais pas committer sous l'appellation \"jean-smaug\", vous vous en doutez.\u003cbr\u003e\nDepuis le r√©pertoire du projet il me suffit de lancer\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003egit config user.name maxime blanc\ngit config user.email maxime@blanc.fr\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eDe cette fa√ßon, les commits de ce projet appartiendront √† \u003cstrong\u003emaxime blanc\u003c/strong\u003e alors que les commits des autres projets appartiendront √† \u003cstrong\u003ejean-smaug\u003c/strong\u003e.\u003c/p\u003e\n\n\u003cp\u003eM√™me si \u003ccode\u003euser.name\u003c/code\u003e et \u003ccode\u003euser.email\u003c/code\u003e sont d√©finis dans les deux configurations, une seule est prise en compte. La configuration locale est prioritaire sur la configuration globale, elle-m√™me prioritaire sur la configuration syst√®me.\u003c/p\u003e\n\n\u003cp\u003eSi vous voulez voir la configuration que Git utilise au sein de votre projet la commande \u003ccode\u003egit config --list --show-origin\u003c/code\u003e fera votre bonheur. Cette commande indique les options qui viennent de la configuration locale et celles qui viennent de la configuration globale.\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"quelques-options-%C3%A0-modifier-ou-pas\" href=\"#quelques-options-%C3%A0-modifier-ou-pas\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Quelques options √† modifier (ou pas)\n\u003c/h1\u003e\n\n\u003cp\u003eDans cette partie on va passer en revue quelques options qu'il peut √™tre int√©ressant de modifier. Il en existe \u003ca href=\"https://git-scm.com/docs/git-config\"\u003ebeaucoup d'autres\u003c/a\u003e, ici je pr√©sente celle qui pourraient int√©resser la majorit√© d'entre vous.\u003c/p\u003e\n\n\u003ch3\u003e\n  \u003ca name=\"core\" href=\"#core\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Core\n\u003c/h3\u003e\n\n\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight shell\"\u003e\u003ccode\u003egit config core.editor vim\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eL'√©diteur utilis√© pendant les rebases interactifs, les commits... Vim ou Nano sont de bons choix car l√©ger mais VSCode peut aussi convenir.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight shell\"\u003e\u003ccode\u003egit config core.ignoreCase \u003cspan class=\"nb\"\u003etrue\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003ePar d√©faut Git fait la diff√©rence entre \u003ccode\u003eindex.js\u003c/code\u003e et \u003ccode\u003eINDEX.js\u003c/code\u003e. Les syst√®mes de fichier FAT et NTFS n'√©tant pas sensible √† la casse, ce param√®tre peut √™tre utile pour √©viter les probl√®mes.\u003c/p\u003e\n\n\u003ch3\u003e\n  \u003ca name=\"reseau\" href=\"#reseau\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Reseau\n\u003c/h3\u003e\n\n\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight shell\"\u003e\u003ccode\u003egit config fetch.prune \u003cspan class=\"nb\"\u003etrue\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eSupprime les copies des r√©f√©rences distantes (branches, tags...), qui n'existent plus sur le d√©p√¥t distant.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight shell\"\u003e\u003ccode\u003egit config pull.rebase \u003cspan class=\"nb\"\u003etrue\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eLa commande pull utilisera le rebase plut√¥t que le merge comme strat√©gie de mise √† jour.\u003c/p\u003e\n\n\u003ch3\u003e\n  \u003ca name=\"rebase\" href=\"#rebase\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Rebase\n\u003c/h3\u003e\n\n\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight shell\"\u003e\u003ccode\u003egit config rebase.autoSquash \u003cspan class=\"nb\"\u003etrue\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003ePermet de squasher les commits de fixup.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight shell\"\u003e\u003ccode\u003egit config rebase.autoStash \u003cspan class=\"nb\"\u003etrue\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eStash les modifications de l'espace de travail avant un rebase et applique le stash √† la fin du rebase.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight shell\"\u003e\u003ccode\u003egit config rebase.abbreviateCommands \u003cspan class=\"nb\"\u003etrue\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eUtilise les versions courtes des options de rebase, \u003ccode\u003ep\u003c/code\u003e pour \u003ccode\u003epick\u003c/code\u003e, \u003ccode\u003er\u003c/code\u003e pour \u003ccode\u003erename\u003c/code\u003e... lors d'un rebase interactif.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight shell\"\u003e\u003ccode\u003egit config rerere.enabled \u003cspan class=\"nb\"\u003etrue\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eRerere ou \u003cstrong\u003eRe\u003c/strong\u003euse \u003cstrong\u003ere\u003c/strong\u003ecorded \u003cstrong\u003ere\u003c/strong\u003esolution, sauvegarde les r√©solutions de conflits que vous avez trait√© et les r√©-applique automatiquement en cas de conflits identiques.\u003c/p\u003e\n\n\u003ch3\u003e\n  \u003ca name=\"divers\" href=\"#divers\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Divers\n\u003c/h3\u003e\n\n\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight shell\"\u003e\u003ccode\u003egit config blame.showEmail \u003cspan class=\"nb\"\u003etrue\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eAffiche les emails pendant un \u003ccode\u003egit blame\u003c/code\u003e\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight shell\"\u003e\u003ccode\u003egit config status.short \u003cspan class=\"nb\"\u003etrue\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eVersion all√©g√©e du \u003ccode\u003egit status\u003c/code\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n  \u003ca name=\"doisje-activer-ces-options-\" href=\"#doisje-activer-ces-options-\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Dois-je activer ces options ?\n\u003c/h3\u003e\n\n\u003cp\u003eIl n'y a pas de r√©ponse unique, cela d√©pend de votre fa√ßon de travailler. \u003c/p\u003e\n\n\u003cp\u003eIl faut savoir que la majorit√© des customisations propos√©es est r√©alisable via la ligne de commande.\u003cbr\u003e\nPar exemple, executer \u003ccode\u003egit pull --rebase\u003c/code\u003e √©quivaut √† un \u003ccode\u003egit pull\u003c/code\u003e en ayant au pr√©alable activ√© l'option \u003ccode\u003epull.rebase\u003c/code\u003e dans la configuration.\u003c/p\u003e\n\n\u003cp\u003eDonc si vous ajoutez souvent des options √† vos commandes il peut √™tre utile de modifier la configuration.\u003c/p\u003e\n\u003ch1\u003e\n  \u003ca name=\"%C3%A7a-reste-entre-nous\" href=\"#%C3%A7a-reste-entre-nous\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  √áa reste entre nous ü§´\n\u003c/h1\u003e\n\n\u003cp\u003eDans cette section, je vais pr√©senter quelques techniques pour briser la confiance mutuelle que vous avez avec vos coll√®gues. Et pour cela nous aurons uniquement besoin d'une configuration Git.\u003c/p\u003e\n\u003ch2\u003e\n  \u003ca name=\"un-monde-au-mille-et-une-couleurs\" href=\"#un-monde-au-mille-et-une-couleurs\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Un monde au mille et une couleurs\n\u003c/h2\u003e\n\n\u003cp\u003eOn peut modifier le comportement des commandes mais aussi les couleurs des textes dans la console.\u003cbr\u003e\u003cbr\u003e\nJe vais vous proposer ici 3 configurations √† essayer sur votre poste mais surtout sur celui de vos coll√®gues.\u003c/p\u003e\n\u003ch3\u003e\n  \u003ca name=\"la-version-nostalgique-des-ann%C3%A9es-80\" href=\"#la-version-nostalgique-des-ann%C3%A9es-80\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  La version nostalgique des ann√©es 80\n\u003c/h3\u003e\n\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight shell\"\u003e\u003ccode\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003ecolor \u003cspan class=\"s2\"\u003e\"status\"\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n    hint \u003cspan class=\"o\"\u003e=\u003c/span\u003e red\n    header \u003cspan class=\"o\"\u003e=\u003c/span\u003e magenta\n    added \u003cspan class=\"o\"\u003e=\u003c/span\u003e green\n    updated \u003cspan class=\"o\"\u003e=\u003c/span\u003e blue\n    changed \u003cspan class=\"o\"\u003e=\u003c/span\u003e yellow\n    untracked \u003cspan class=\"o\"\u003e=\u003c/span\u003e cyan\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\u003cp\u003eJe vous montre le splendide resultat ici, et je vous laisse tester les suivantes par vous m√™me.\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--2B1mMTka--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/mwngfqqgqh4npqwi4riw.jpg\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--2B1mMTka--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/mwngfqqgqh4npqwi4riw.jpg\" alt=\"80's\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch3\u003e\n  \u003ca name=\"la-version-pompes-fun%C3%A8bres\" href=\"#la-version-pompes-fun%C3%A8bres\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  La version pompes fun√®bres\n\u003c/h3\u003e\n\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight shell\"\u003e\u003ccode\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003ecolor \u003cspan class=\"s2\"\u003e\"status\"\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n    hint \u003cspan class=\"o\"\u003e=\u003c/span\u003e black\n    header \u003cspan class=\"o\"\u003e=\u003c/span\u003e black\n    added \u003cspan class=\"o\"\u003e=\u003c/span\u003e black\n    updated \u003cspan class=\"o\"\u003e=\u003c/span\u003e black\n    changed \u003cspan class=\"o\"\u003e=\u003c/span\u003e black\n    untracked \u003cspan class=\"o\"\u003e=\u003c/span\u003e black\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n  \u003ca name=\"la-version-ne-pas-utiliser-si-vous-%C3%AAtes-daltonien\" href=\"#la-version-ne-pas-utiliser-si-vous-%C3%AAtes-daltonien\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  La version ne pas utiliser si vous √™tes daltonien üôÉ\n\u003c/h3\u003e\n\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight shell\"\u003e\u003ccode\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003ecolor \u003cspan class=\"s2\"\u003e\"status\"\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n    hint \u003cspan class=\"o\"\u003e=\u003c/span\u003e yellow green\n    header \u003cspan class=\"o\"\u003e=\u003c/span\u003e yellow green\n    added \u003cspan class=\"o\"\u003e=\u003c/span\u003e yellow green\n    updated \u003cspan class=\"o\"\u003e=\u003c/span\u003e yellow green\n    changed \u003cspan class=\"o\"\u003e=\u003c/span\u003e yellow green\n    untracked \u003cspan class=\"o\"\u003e=\u003c/span\u003e yellow green\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\u003cp\u003eIci j'ai pr√©sent√© la customisation de la commande \u003ccode\u003egit status\u003c/code\u003e, il faut savoir qu'il est aussi possible d'appliquer ces changements sur les blames, les diffs, les branches...\u003cbr\u003e\nCertes, la configuration de couleur n'est pas la fonctionnalit√© qui va r√©volutionner votre fa√ßon de travailler, mais le style √† son importance comme dirait l'autre.\u003c/p\u003e\n\u003ch2\u003e\n  \u003ca name=\"le-capitaine-crochet\" href=\"#le-capitaine-crochet\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Le capitaine Crochet\n\u003c/h2\u003e\n\n\u003cp\u003eSi votre √©quipe a d√©cid√© d'utiliser les hooks de pr√©-commit et/ou de pr√©-push, vous avez deux solutions : \u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eLa quitter\u003c/li\u003e\n\u003cli\u003eUtiliser l'astuce qui suit tout en planifiant votre d√©part\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003ePour ignorer les hooks il faut ajouter le param√®tre \u003ccode\u003e--no-verify\u003c/code\u003e a sa commande. Mais le taper √† chaque fois est p√©nible.\u003c/p\u003e\n\n\u003cp\u003ePour automatiser le processus il est possible de cr√©er des alias dans le fichier de configuration.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight shell\"\u003e\u003ccode\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"nb\"\u003ealias\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n    cm \u003cspan class=\"o\"\u003e=\u003c/span\u003e commit \u003cspan class=\"nt\"\u003e--no-verify\u003c/span\u003e\n    pu \u003cspan class=\"o\"\u003e=\u003c/span\u003e push \u003cspan class=\"nt\"\u003e--no-verify\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eAinsi, les commandes \u003ccode\u003egit cm\u003c/code\u003e et \u003ccode\u003egit pu\u003c/code\u003e, \"committerons\" et \"pusherons\" en ignorant les hooks. \u003c/p\u003e\n\n\u003cp\u003eBien plus que pour ignorer des hooks, les alias sont tr√®s pratiques, ils permettent d'aller plus beaucoup plus vite. Mes alias sont disponibles \u003ca href=\"https://github.com/jean-smaug/config-files/blob/master/.gitconfig\"\u003eici\u003c/a\u003e mais n'h√©sitez pas √† cr√©er les votres !\u003c/p\u003e\n\n\u003cp\u003eLe tour est jou√©, vous pouvez d√©velopper tranquillement.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"sattribuer-le-travail-dun-coll%C3%A8gue\" href=\"#sattribuer-le-travail-dun-coll%C3%A8gue\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  S'attribuer le travail d'un coll√®gue\n\u003c/h2\u003e\n\n\u003cp\u003eNous avons vu plus haut comment configurer un utilisateur. Lors de cette op√©ration, Git va configurer deux choses : \u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003el'auteur : celui qui a √©crit et commit√© le code \u003c/li\u003e\n\u003cli\u003ele \"committeur\": celui qui √† r√©alis√© les deni√®res manipulations sur les commits\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eC'est pour cela que sur Github, lorsque vous rebasez le travail d'un autre, vous pouvez voir appara√Ætre deux avatars sur un commit.\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--Xtl5j7hz--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/no9ks9d68x0zayiq9fkk.jpg\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--Xtl5j7hz--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/no9ks9d68x0zayiq9fkk.jpg\" alt=\"author-and-committer\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eM√™me dans la partie WTF, on peut apprendre des choses üëç\u003c/p\u003e\n\n\u003cp\u003eLe but est de modifier l'auteur, car c'est sur l'auteur que Github se base pour les statistiques de contribution.\u003c/p\u003e\n\n\u003cp\u003eVous avez s√ªrement envie de modifier le fichier de configuration local et d'y apposer votre email, afin d'avoir la priorit√© sur la configuration globale. Excellent r√©flexe !\u003cbr\u003e\nIl existe cependant une fa√ßon plus discr√®te de configurer un utilisateur qui √† la priorit√© sur la configuration locale : les variables d'environnement.\u003c/p\u003e\n\n\u003cp\u003eSur la machine cible, lancez les commandes suivantes laissez le bosser pour vous.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight shell\"\u003e\u003ccode\u003e\u003cspan class=\"nb\"\u003eexport \u003c/span\u003e\u003cspan class=\"nv\"\u003eGIT_AUTHOR_EMAIL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ejack@sparrow.io\n\u003cspan class=\"nb\"\u003eexport \u003c/span\u003e\u003cspan class=\"nv\"\u003eGIT_AUTHOR_NAME\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ejack sparrow\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eCroyez-moi, √ßa marche.\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--6rgpdA7A--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/8s9eva7271fgyb9catow.png\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--6rgpdA7A--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/8s9eva7271fgyb9catow.png\" alt=\"crook\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"bonus-le-jeu-de-la-gitime\" href=\"#bonus-le-jeu-de-la-gitime\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  BONUS : le jeu de la Gitime\n\u003c/h2\u003e\n\n\u003cp\u003eUne fois la variable d'environnement modifi√©e, et que votre coll√®gue a pouss√© son code sur le d√©p√¥t, plusieurs solutions :\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eIl s'en aper√ßoit avant de demander une revue, il fait 10 squats pour avoir laiss√© son poste non verrouill√©.\u003c/li\u003e\n\u003cli\u003eC'est un autre coll√®gue qui s'en aper√ßoit pendant la revue, la Gitime prend un gage. Et alors l√†, il faut √™tre cr√©atif. On peut choisir les classiques chocolatines mais on peut aussi le d√©guiser, en f√©e, en Babouche (le singe, pas la chaussure)... √áa lui apprendra √† ne pas relire ses PR avant de demander une revue.\u003c/li\u003e\n\u003cli\u003eSi jamais la PR est merg√©e sans qu'il s'en aper√ßoive alors la, je vous laisse vous arranger entre vous. Mais il ne doit pas s'en sortir indemne.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"conclusion\" href=\"#conclusion\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Conclusion\n\u003c/h2\u003e\n\n\u003cp\u003eNous avons pass√© en revue les diff√©rentes mani√®res pour adapter Git √† sa fa√ßon de travailler : configuration, alias, variables d'environnement.\u003c/p\u003e\n\n\u003cp\u003eRetenez que l'ordre appliqu√© pour les options est le suivant :\u003cbr\u003e\nConfiguration syst√®me \u0026gt; Configuration globale \u0026gt; Configuration locale \u0026gt; Variable d'environnement \u0026gt; Options de commandes.\u003c/p\u003e\n\n\u003cp\u003eLe plus important √©tant que, vous √™tes d√©sormais arm√©s pour lutter contre vos coll√®gues. Puisse le sort vous √™tre favorable.\u003c/p\u003e\n\n\u003cp\u003eSi jamais certaines notions ou commandes mentionn√©es dans l'article ne sont pas claires, restez √† l'aff√ªt des prochains articles qui aborderont ces points. Je vous invite aussi √† consulter la documentation qui est tr√®s bien faite.\u003c/p\u003e\n\n\u003cp\u003eMerci √† Aubin Dugelet pour la relecture.\u003c/p\u003e\n\n\u003cp\u003eMerci de m'avoir lu.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"liens\" href=\"#liens\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Liens\n\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://stackoverflow.com/questions/18329621/storing-git-config-as-part-of-the-repository\"\u003ehttps://stackoverflow.com/questions/18329621/storing-git-config-as-part-of-the-repository\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://stackoverflow.com/questions/12254076/how-do-i-show-my-global-git-configuration\"\u003ehttps://stackoverflow.com/questions/12254076/how-do-i-show-my-global-git-configuration\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://git-scm.com/docs/git-config\"\u003ehttps://git-scm.com/docs/git-config\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n",
    "social_image": null,
    "body_markdown": "---\ntitle: Git, configuration et fourberies\npublished: true\ndescription: Comment configurer Git pour son usage personnel et pour troller ses coll√®gues \ntags: git, wtf\ncover_image: https://thepracticaldev.s3.amazonaws.com/i/9ajlkl8jv168bup7cdl8.png\n---\n\nSouvenez-vous, les lignes de commandes suivantes sont celles que vous avez ex√©cut√©es apr√®s avoir install√© Git. \n\n```bash\ngit config --global user.name jean-smaug\ngit config --global user.email maximeblanc.dev@gmail.fr\n```\n\nElles ont permis √† Git de vous connaitre en tant qu'utilisateur. Preuve en est, si vous faites un `git log --pretty=full`, votre nom d'utilisateur et votre email sont associ√©s √† tous les commits que vous avez cr√©√©s.\n\nVous √™tes-vous d√©j√† demand√© pourquoi il y avait un `--global` dans cette commande ?\nAujourd'hui on r√©pond √† cette question et on voit comment gagner du temps dans l'utilisation de Git.  \n\n# Les fichiers de configuration\n\nIl existe trois fichiers de configuration : \n- **syst√®me** : relatif √† la machine, nous ne l'utiliserons pas \n- **global** : relatif √† un utilisateur du syst√®me\n- **local** : relatif au d√©p√¥t\n\nAvec cette information vous aurez compris que si on configurait l'utilisateur sans l'option `--global` on devrait le configurer pour chacun de nos d√©p√¥ts Git. Dans une logique de non-perte de temps, ce n'est pas la meilleure solution.\n\nLes chemins des fichiers de configuration sont les suivants :\n- `~/.gitconfig` pour le global\n- `dossier-projet/.git/config` pour le local \n\nCommen√ßons par inspecter le fichier de configuration globale. Soit vous l'ouvrez √† l'emplacement pr√©c√©demment mentionn√© soit vous pouvez lancer la commande `git config --global --edit`. Il est √©crit en [TOML](https://github.com/toml-lang/toml) et ressemble √† cela :\n\n```bash\n[user]\n\temail = maximeblanc.dev@gmail.com\n\tname = jean-smaug\n```\n\nCet exemple contient la section **user** que l'on a configur√© via la ligne de commande. Il est bien entendu possible de configurer Git en √©ditant de fichier manuellement.\n\n# Hi√©rarchie de configuration\n\nImaginons que la configuration globale utilis√©e est celle de mon ordinateur personnel et que je doive travailler sur un projet d'entreprise. Je ne vais pas committer sous l'appellation \"jean-smaug\", vous vous en doutez.\nDepuis le r√©pertoire du projet il me suffit de lancer\n\n```\ngit config user.name maxime blanc\ngit config user.email maxime@blanc.fr\n```\n\nDe cette fa√ßon, les commits de ce projet appartiendront √† **maxime blanc** alors que les commits des autres projets appartiendront √† **jean-smaug**.\n\nM√™me si `user.name` et `user.email` sont d√©finis dans les deux configurations, une seule est prise en compte. La configuration locale est prioritaire sur la configuration globale, elle-m√™me prioritaire sur la configuration syst√®me.\n\nSi vous voulez voir la configuration que Git utilise au sein de votre projet la commande `git config --list --show-origin` fera votre bonheur. Cette commande indique les options qui viennent de la configuration locale et celles qui viennent de la configuration globale.\n\n# Quelques options √† modifier (ou pas)\n\nDans cette partie on va passer en revue quelques options qu'il peut √™tre int√©ressant de modifier. Il en existe [beaucoup d'autres](https://git-scm.com/docs/git-config), ici je pr√©sente celle qui pourraient int√©resser la majorit√© d'entre vous.\n\n### Core\n\n```bash\ngit config core.editor vim\n```\n\nL'√©diteur utilis√© pendant les rebases interactifs, les commits... Vim ou Nano sont de bons choix car l√©ger mais VSCode peut aussi convenir.\n\n```bash\ngit config core.ignoreCase true\n```\n\nPar d√©faut Git fait la diff√©rence entre `index.js` et `INDEX.js`. Les syst√®mes de fichier FAT et NTFS n'√©tant pas sensible √† la casse, ce param√®tre peut √™tre utile pour √©viter les probl√®mes.\n\n### Reseau\n\n```bash\ngit config fetch.prune true\n```\n\nSupprime les copies des r√©f√©rences distantes (branches, tags...), qui n'existent plus sur le d√©p√¥t distant.\n\n```bash\ngit config pull.rebase true\n```\n\nLa commande pull utilisera le rebase plut√¥t que le merge comme strat√©gie de mise √† jour.\n\n### Rebase\n\n```bash\ngit config rebase.autoSquash true\n``` \n\nPermet de squasher les commits de fixup.\n\n```bash\ngit config rebase.autoStash true\n```\n\nStash les modifications de l'espace de travail avant un rebase et applique le stash √† la fin du rebase.\n\n```bash\ngit config rebase.abbreviateCommands true\n```\n\nUtilise les versions courtes des options de rebase, `p` pour `pick`, `r` pour `rename`... lors d'un rebase interactif.\n\n```bash\ngit config rerere.enabled true\n```\n\nRerere ou **Re**use **re**corded **re**solution, sauvegarde les r√©solutions de conflits que vous avez trait√© et les r√©-applique automatiquement en cas de conflits identiques.\n\n### Divers\n\n```bash\ngit config blame.showEmail true\n```\n\nAffiche les emails pendant un `git blame`\n\n```bash\ngit config status.short true\n```\n\nVersion all√©g√©e du `git status`\n\n### Dois-je activer ces options ?\n\nIl n'y a pas de r√©ponse unique, cela d√©pend de votre fa√ßon de travailler. \n\nIl faut savoir que la majorit√© des customisations propos√©es est r√©alisable via la ligne de commande.\nPar exemple, executer `git pull --rebase` √©quivaut √† un `git pull` en ayant au pr√©alable activ√© l'option `pull.rebase` dans la configuration.\n\nDonc si vous ajoutez souvent des options √† vos commandes il peut √™tre utile de modifier la configuration.\n\n# √áa reste entre nous ü§´\n\nDans cette section, je vais pr√©senter quelques techniques pour briser la confiance mutuelle que vous avez avec vos coll√®gues. Et pour cela nous aurons uniquement besoin d'une configuration Git.\n\n## Un monde au mille et une couleurs\n\nOn peut modifier le comportement des commandes mais aussi les couleurs des textes dans la console.  \nJe vais vous proposer ici 3 configurations √† essayer sur votre poste mais surtout sur celui de vos coll√®gues.\n\n### La version nostalgique des ann√©es 80 \n\n```bash\n[color \"status\"]\n\thint = red\n\theader = magenta\n \tadded = green\n \tupdated = blue\n \tchanged = yellow\n \tuntracked = cyan\n```\n\nJe vous montre le splendide resultat ici, et je vous laisse tester les suivantes par vous m√™me.\n\n![80's](https://thepracticaldev.s3.amazonaws.com/i/mwngfqqgqh4npqwi4riw.jpg)\n\n### La version pompes fun√®bres\n\n```bash\n[color \"status\"]\n\thint = black\n\theader = black\n \tadded = black\n \tupdated = black\n \tchanged = black\n \tuntracked = black\n```\n\n### La version ne pas utiliser si vous √™tes daltonien üôÉ\n\n```bash\n[color \"status\"]\n\thint = yellow green\n\theader = yellow green\n \tadded = yellow green\n \tupdated = yellow green\n \tchanged = yellow green\n \tuntracked = yellow green\n```\n\nIci j'ai pr√©sent√© la customisation de la commande `git status`, il faut savoir qu'il est aussi possible d'appliquer ces changements sur les blames, les diffs, les branches...\nCertes, la configuration de couleur n'est pas la fonctionnalit√© qui va r√©volutionner votre fa√ßon de travailler, mais le style √† son importance comme dirait l'autre.\n\n## Le capitaine Crochet\n\nSi votre √©quipe a d√©cid√© d'utiliser les hooks de pr√©-commit et/ou de pr√©-push, vous avez deux solutions : \n- La quitter\n- Utiliser l'astuce qui suit tout en planifiant votre d√©part\n\nPour ignorer les hooks il faut ajouter le param√®tre `--no-verify` a sa commande. Mais le taper √† chaque fois est p√©nible.\n\nPour automatiser le processus il est possible de cr√©er des alias dans le fichier de configuration.  \n\n```bash\n[alias]\n\tcm = commit --no-verify\n\tpu = push --no-verify\n```\n\nAinsi, les commandes `git cm` et `git pu`, \"committerons\" et \"pusherons\" en ignorant les hooks. \n\nBien plus que pour ignorer des hooks, les alias sont tr√®s pratiques, ils permettent d'aller plus beaucoup plus vite. Mes alias sont disponibles [ici](https://github.com/jean-smaug/config-files/blob/master/.gitconfig) mais n'h√©sitez pas √† cr√©er les votres !\n\nLe tour est jou√©, vous pouvez d√©velopper tranquillement.\n\n## S'attribuer le travail d'un coll√®gue\n\nNous avons vu plus haut comment configurer un utilisateur. Lors de cette op√©ration, Git va configurer deux choses : \n- l'auteur : celui qui a √©crit et commit√© le code \n- le \"committeur\": celui qui √† r√©alis√© les deni√®res manipulations sur les commits\n\nC'est pour cela que sur Github, lorsque vous rebasez le travail d'un autre, vous pouvez voir appara√Ætre deux avatars sur un commit.\n\n![author-and-committer](https://thepracticaldev.s3.amazonaws.com/i/no9ks9d68x0zayiq9fkk.jpg)\n\nM√™me dans la partie WTF, on peut apprendre des choses üëç\n\nLe but est de modifier l'auteur, car c'est sur l'auteur que Github se base pour les statistiques de contribution.\n\nVous avez s√ªrement envie de modifier le fichier de configuration local et d'y apposer votre email, afin d'avoir la priorit√© sur la configuration globale. Excellent r√©flexe !\nIl existe cependant une fa√ßon plus discr√®te de configurer un utilisateur qui √† la priorit√© sur la configuration locale : les variables d'environnement.\n\nSur la machine cible, lancez les commandes suivantes laissez le bosser pour vous.\n\n```bash\nexport GIT_AUTHOR_EMAIL=jack@sparrow.io\nexport GIT_AUTHOR_NAME=jack sparrow\n```\n\nCroyez-moi, √ßa marche.\n\n![crook](https://thepracticaldev.s3.amazonaws.com/i/8s9eva7271fgyb9catow.png)\n\n## BONUS : le jeu de la Gitime\n\nUne fois la variable d'environnement modifi√©e, et que votre coll√®gue a pouss√© son code sur le d√©p√¥t, plusieurs solutions :\n- Il s'en aper√ßoit avant de demander une revue, il fait 10 squats pour avoir laiss√© son poste non verrouill√©.\n- C'est un autre coll√®gue qui s'en aper√ßoit pendant la revue, la Gitime prend un gage. Et alors l√†, il faut √™tre cr√©atif. On peut choisir les classiques chocolatines mais on peut aussi le d√©guiser, en f√©e, en Babouche (le singe, pas la chaussure)... √áa lui apprendra √† ne pas relire ses PR avant de demander une revue.\n- Si jamais la PR est merg√©e sans qu'il s'en aper√ßoive alors la, je vous laisse vous arranger entre vous. Mais il ne doit pas s'en sortir indemne.\n\n## Conclusion\n\nNous avons pass√© en revue les diff√©rentes mani√®res pour adapter Git √† sa fa√ßon de travailler : configuration, alias, variables d'environnement.\n\nRetenez que l'ordre appliqu√© pour les options est le suivant :\nConfiguration syst√®me \u003e Configuration globale \u003e Configuration locale \u003e Variable d'environnement \u003e Options de commandes.\n\nLe plus important √©tant que, vous √™tes d√©sormais arm√©s pour lutter contre vos coll√®gues. Puisse le sort vous √™tre favorable.\n\nSi jamais certaines notions ou commandes mentionn√©es dans l'article ne sont pas claires, restez √† l'aff√ªt des prochains articles qui aborderont ces points. Je vous invite aussi √† consulter la documentation qui est tr√®s bien faite.\n\nMerci √† Aubin Dugelet pour la relecture.\n\nMerci de m'avoir lu.\n\n## Liens\n\n- https://stackoverflow.com/questions/18329621/storing-git-config-as-part-of-the-repository\n- https://stackoverflow.com/questions/12254076/how-do-i-show-my-global-git-configuration\n- https://git-scm.com/docs/git-config",
    "canonical_url": null,
    "show_comments": true,
    "main_image_background_hex_color": "#dddddd",
    "published_from_feed": false,
    "comments_count": 2,
    "video": null,
    "video_code": null,
    "video_source_url": null,
    "video_thumbnail_url": null,
    "video_closed_caption_track_url": null,
    "feed_source_url": null,
    "positive_reactions_count": 7,
    "edited_at": "2019-11-01T07:53:36.385Z",
    "crossposted_at": null,
    "language": "fr",
    "cached_tag_list": "git, wtf",
    "path": "/jeansmaug/git-configuration-et-fourberies-2ajc",
    "cached_user_name": "jean-smaug",
    "cached_user_username": "jeansmaug",
    "last_comment_at": "2019-10-29T11:08:31.394Z"
  },
  {
    "title": "Uploader un fichier en Javascript avec fetch",
    "slug": "uploader-un-fichier-en-javascript-avec-fetch-cc5",
    "created_at": "2019-11-01T11:24:09.578Z",
    "main_image": "https://thepracticaldev.s3.amazonaws.com/i/uingc1g058bkex15174s.jpg",
    "description": "Am√©liorer l'exp√©rience utilisateur en utilisant Javascript pour un upload de fichier.",
    "published": true,
    "published_at": "2019-11-04T07:21:00.864Z",
    "processed_html": "\u003cp\u003eDans cet article on va voir comment uploader un fichier en utilisant Javascript et l'API fetch. On partira d'un exemple en PHP que l'on fera √©voluer pour atteindre le r√©sultat souhait√©.\u003c/p\u003e\n\n\u003cp\u003eLe code complet est disponible ici\u003c/p\u003e\n\n\n\u003cdiv class=\"ltag-github-readme-tag\"\u003e\n  \u003cdiv class=\"readme-overview\"\u003e\n    \u003ch2\u003e\n      \u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--qF2jUiUG--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://practicaldev-herokuapp-com.freetls.fastly.net/assets/github-logo-6a5bca60a4ebf959a6df7f08217acd07ac2bc285164fae041eacb8a148b1bab9.svg\" alt=\"GitHub logo\" loading=\"lazy\"\u003e\n      \u003ca href=\"https://github.com/jean-smaug\"\u003e\n        jean-smaug\n      \u003c/a\u003e / \u003ca style=\"font-weight: 600;\" href=\"https://github.com/jean-smaug/demo-file-upload\"\u003e\n        demo-file-upload\n      \u003c/a\u003e\n    \u003c/h2\u003e\n    \u003ch3\u003e\n      \n    \u003c/h3\u003e\n  \u003c/div\u003e\n\u003c/div\u003e\n \n\u003ch1\u003e\n  \u003ca name=\"version-php\" href=\"#version-php\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Version PHP\n\u003c/h1\u003e\n\n\u003cp\u003eConsiderons l'exemple suivant :\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--YwxkmAoZ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/p8a2f0b5wkwcxobuxktz.gif\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--YwxkmAoZ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/p8a2f0b5wkwcxobuxktz.gif\" alt=\"upload-php\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eApr√®s la soumission du formulaire, on voit que l'URL change vers \u003ccode\u003eupload.php\u003c/code\u003e. Cette page enregistre le fichier upload√© et affiche un message de succ√®s. Il est ensuite redirig√© vers la page \u003ccode\u003eindex.html\u003c/code\u003e. Ce syst√®me fonctionne, mais il implique trois chargements de pages.\u003c/p\u003e\n\n\u003cp\u003eRegardons le code utilis√©.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight html\"\u003e\u003ccode\u003e\u003cspan class=\"cp\"\u003e\u0026lt;!DOCTYPE html\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;html\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;head\u0026gt;\u003c/span\u003e\u003cspan class=\"c\"\u003e\u0026lt;!-- ... --\u0026gt;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026lt;/head\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;body\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;form\u003c/span\u003e \u003cspan class=\"na\"\u003eaction=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"upload.php\"\u003c/span\u003e \u003cspan class=\"na\"\u003emethod=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"post\"\u003c/span\u003e \u003cspan class=\"na\"\u003eenctype=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"multipart/form-data\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"nt\"\u003e\u0026lt;input\u003c/span\u003e \u003cspan class=\"na\"\u003etype=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"file\"\u003c/span\u003e \u003cspan class=\"na\"\u003ename=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"background\"\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"nt\"\u003e\u0026lt;button\u003c/span\u003e \u003cspan class=\"na\"\u003etype=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"submit\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003eEnvoyer\u003cspan class=\"nt\"\u003e\u0026lt;/button\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;/form\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;/body\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/html\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eCe code HTML est standard. Le seul point d'attention est l'attribut \u003ca href=\"https://www.w3schools.com/tags/att_form_enctype.asp\"\u003e\u003cstrong\u003eenctype\u003c/strong\u003e\u003c/a\u003e dont la valeur doit obligatoirement √™tre \u003cstrong\u003emultipart/form-data\u003c/strong\u003e pour pouvoir uploader un fichier.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight php\"\u003e\u003ccode\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?php\u003c/span\u003e\n    \u003cspan class=\"nb\"\u003eheader\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"Access-Control-Allow-Origin: *\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"cm\"\u003e/* La variable superglobale $_FILES nous donne acc√®s aux fichiers\n    qui ont √©t√© upload√©s. La cl√© \"background\" fait r√©f√©rence √†\n    l'attribut name de \u0026lt;input name=\"background\" /\u0026gt; */\u003c/span\u003e\n    \u003cspan class=\"nv\"\u003e$file\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_FILES\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"background\"\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"nv\"\u003e$isFileUploaded\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003emove_uploaded_file\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$file\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"tmp_name\"\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"nx\"\u003e__DIR__\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"/../storage/\"\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e \u003cspan class=\"nv\"\u003e$file\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"name\"\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$isFileUploaded\u003c/span\u003e \u003cspan class=\"o\"\u003e===\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nb\"\u003ehttp_response_code\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e500\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"Probl√®me serveur\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e \n    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nb\"\u003ehttp_response_code\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e201\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"nb\"\u003ereadfile\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'success.html'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// Redirection sur index.html apr√®s 2 secondes\u003c/span\u003e\n    \u003cspan class=\"nb\"\u003eheader\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"Refresh:2; url=index.html\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e303\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eLa partie serveur r√©cup√®re le fichier et de le d√©place dans le dossier storage. Une fois le traitement termin√© on affiche un message √† l'utilisateur puis on le redirige vers la page \u003ccode\u003eindex.html\u003c/code\u003e apr√®s deux seconde. L'essentiel √©tant de retenir que le nom donn√© √† l'input √† son importance et sera utilis√© par le code PHP pour r√©cup√©rer le fichier.\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"apis-web\" href=\"#apis-web\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  APIs web\n\u003c/h1\u003e\n\n\u003cp\u003eNous allons avoir besoin de deux API web : \u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/API/FormData/FormData\"\u003eFormData\u003c/a\u003e et \u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch\"\u003eFetch\u003c/a\u003e.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"formdata\" href=\"#formdata\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  FormData\n\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--TLv0NXVu--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/ck8wpzeskzq7ymvsqvq0.jpg\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--TLv0NXVu--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/ck8wpzeskzq7ymvsqvq0.jpg\" alt=\"Form Data\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eFormData dispose d'un tr√®s bon support de la part des navigateurs.\u003c/p\u003e\n\n\u003cp\u003eCette API permet de repr√©senter un formulaire c√¥t√© Javascript. Ce formulaire aura un encodage de type \u003cstrong\u003emultipart/form-data\u003c/strong\u003e, donc il n'est pas n√©cessaire de le pr√©ciser dans le HTML. Ce type d'encodage est n√©cessaire d√®s lors que l'on souhaite uploader un fichier.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"fetch\" href=\"#fetch\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Fetch\n\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--i8WhveDl--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/guf8nore5xbot17hf0w4.jpg\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--i8WhveDl--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/guf8nore5xbot17hf0w4.jpg\" alt=\"Fetch\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eAussi surprenant que cela puisse para√Ætre, c'est Internet Explorer qui nous casse les ligaments. Il existe deux solutions pour contourner le probl√®me de compatibilit√© :\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eUtiliser un \u003ca href=\"https://github.com/github/fetch\"\u003epolyfill\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eL'astuce que je pr√©sente plus bas\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eL'API fetch est la fa√ßon moderne pour faire des requ√™tes HTTP. Elle repose sur les promesses (\u003ca href=\"https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Objets_globaux/Promise\"\u003ePromise\u003c/a\u003e). On peut utiliser les promesses avec plusieurs syntaxe, ici, on utilisera \u003ca href=\"https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Instructions/async_function\"\u003easync/await\u003c/a\u003e.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"cm\"\u003e/* Le mot-cl√© async signifie que le mot cl√© await va √™tre \nutilis√© dans le corps de la fonction */\u003c/span\u003e\n\u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003egetLucky\u003c/span\u003e\u003cspan class=\"p\"\u003e(){\u003c/span\u003e\n   \u003cspan class=\"cm\"\u003e/* Le mot cl√© await signifie que l'on attend le resultat d'une\n   fonction, ici somethingThatTakesTime. On ne sait pas combien\n   de temps mettra la fonction √† r√©pondre donc on attend le resultat\n   avant d'executer les instructions suivantes */\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eluck\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"nx\"\u003esomethingThatTakesTime\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\n   \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003eluck\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eMon explication est tr√®s succinte, car je ne veux pas trop digresser. Cependant, je vous conseille \u003ca href=\"https://www.youtube.com/watch?v=uUZxHkcidps\"\u003ecette vid√©o\u003c/a\u003e de Grafikart pour en apprendre plus.\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"version-javascript\" href=\"#version-javascript\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Version Javascript\n\u003c/h1\u003e\n\n\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight html\"\u003e\u003ccode\u003e\u003cspan class=\"cp\"\u003e\u0026lt;!DOCTYPE html\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;html\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;head\u0026gt;\u003c/span\u003e\u003cspan class=\"c\"\u003e\u0026lt;!-- ... --\u0026gt;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026lt;/head\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;body\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"nt\"\u003e\u0026lt;form\u003c/span\u003e \u003cspan class=\"na\"\u003eid=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"form\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n          \u003cspan class=\"nt\"\u003e\u0026lt;input\u003c/span\u003e \u003cspan class=\"na\"\u003etype=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"file\"\u003c/span\u003e \u003cspan class=\"na\"\u003ename=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"background\"\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n          \u003cspan class=\"nt\"\u003e\u0026lt;button\u003c/span\u003e \u003cspan class=\"na\"\u003etype=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"submit\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003eEnvoyer\u003cspan class=\"nt\"\u003e\u0026lt;/button\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"nt\"\u003e\u0026lt;/form\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"nt\"\u003e\u0026lt;p\u003c/span\u003e \u003cspan class=\"na\"\u003eid=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"message\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u0026lt;/p\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"nt\"\u003e\u0026lt;script \u003c/span\u003e\u003cspan class=\"na\"\u003esrc=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"./app.js\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u0026lt;/script\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;/body\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/html\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eLa partie HTML reste sensiblement la m√™me. Les anciens attributs du \u003ccode\u003eform\u003c/code\u003e on laiss√© place √† un id. On ajoute un paragraphe pour afficher le message de succ√®s ou d'√©chec. Enfin, on charge notre script.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"cm\"\u003e/* On r√©cup√®re les √©l√©ments form et message */\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eform\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetElementById\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eform\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003emessage\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetElementById\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003emessage\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"cm\"\u003e/* Lors de la soumission du formulaire on previent\nle comportement par d√©faut */\u003c/span\u003e\n\u003cspan class=\"nx\"\u003eform\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eaddEventListener\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003esubmit\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epreventDefault\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n  \u003cspan class=\"cm\"\u003e/* L'astuce pour IE, si vous n'utilisez pas de polyfill, consiste\n  √† inviter l'utilisateur √† utiliser un autre navigateur */\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"nb\"\u003ewindow\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003efetch\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"nb\"\u003ewindow\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eFormData\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003ealert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eTu crois que c'est du respect mon gar√ßon ? Est ce que tu crois que c'est du respect d'utiliser un navigateur archa√Øque ?\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"cm\"\u003e/* Lorsque l'on instancie FormData on peut lui passer un √©l√©ment\n  form en param√®tre. De cette fa√ßon, FormData peut detecter chaque\n  input du formulaire et leur valeur. \n  Ici, this fait r√©f√©rence √† form */\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eformData\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eFormData\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003etry\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"cm\"\u003e/* fetch() prend en 1er param√®tre l'url et en second param√®tre\n    les options. Ici, nous indiquons que notre requ√™te sera en POST\n    et que le corps de la requ√™te sera constitu√© de nos formData. */\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"nx\"\u003efetch\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003ehttp://localhost:4000/upload.php\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"na\"\u003emethod\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003ePOST\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ebody\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eformData\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// On affiche un message suivant le r√©sultat de la requ√™te\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003einnerText\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eFichier upload√© avec succ√®s \u003c/span\u003e\u003cspan class=\"se\"\u003e\\\\\u003c/span\u003e\u003cspan class=\"s2\"\u003eo/\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003ecatch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003einnerText\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e\n      \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eC'est la cata, c'est la cata, c'est la catastrophe /o\u003c/span\u003e\u003cspan class=\"se\"\u003e\\\\\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"c1\"\u003e// On r√©initialise le formulaire\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ereset\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\n  \u003cspan class=\"c1\"\u003e// On efface le message apr√®s deux secondes\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003esetTimeout\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003einnerText\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e},\u003c/span\u003e \u003cspan class=\"mi\"\u003e2000\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eC'est ainsi que l'on arrive √† ce r√©sultat.\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--79uuPWtX--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/hh1a5jinny4d83hw7rd8.gif\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--79uuPWtX--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/hh1a5jinny4d83hw7rd8.gif\" alt=\"upload-js\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eLa derni√®re √©tape est une optimisation du serveur. Les commentaires repr√©sentent les lignes devenue inutile et que nous pouvons donc supprimer.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight php\"\u003e\u003ccode\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?php\u003c/span\u003e\n    \u003cspan class=\"nb\"\u003eheader\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"Access-Control-Allow-Origin: *\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"nv\"\u003e$file\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_FILES\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"background\"\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"nv\"\u003e$isFileUploaded\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003emove_uploaded_file\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$file\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"tmp_name\"\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"nx\"\u003e__DIR__\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"/../storage/\"\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e \u003cspan class=\"nv\"\u003e$file\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"name\"\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$isFileUploaded\u003c/span\u003e \u003cspan class=\"o\"\u003e===\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nb\"\u003ehttp_response_code\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e500\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// echo \"Probl√®me serveur\";\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e \n    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nb\"\u003ehttp_response_code\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e201\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// readfile('success.html');\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// header(\"Refresh:2; url=index.html\", true, 303);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003ch1\u003e\n  \u003ca name=\"conclusion\" href=\"#conclusion\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Conclusion\n\u003c/h1\u003e\n\n\u003cp\u003eLa combinaison des APIs FormData et fetch, rend l'upload de fichier tr√®s simple. On √©vite le rechargement de page ce qui am√©liore l'exp√©rience utilisateur.\u003c/p\u003e\n\n\u003cp\u003ePour effectuer des requ√™te HTTP, vous pouvez tr√®s bien utiliser Fetch, comme pr√©sent√© dans l'article mais vous devriez jeter un oeil √† :\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"https://github.com/axios/axios\"\u003eAxios\u003c/a\u003e, une librairie bas√©e sur XMLHttpRequest, l'anc√®tre de fetch. Elle est donc compatible avec IE.\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://github.com/sindresorhus/ky\"\u003eKy\u003c/a\u003e, une librairie qui englobe fetch et propose de nouvelles fonctionnalit√©s. \u003ca href=\"https://twitter.com/sindresorhus/status/1037763588826398720\"\u003eKy compar√© √† axios\u003c/a\u003e par le cr√©ateur de Ky.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eEnfin, il est tout √† fait possible d'utiliser ces principes avec des librairies comme React ou Vue.js. Il faudra simplement utiliser les r√©f√©rences sur vos formulaires.\u003c/p\u003e\n\n\u003cp\u003eMerci de m'avoir lu.\u003c/p\u003e\n\n",
    "social_image": null,
    "body_markdown": "---\ntitle: Uploader un fichier en Javascript avec fetch\npublished: true\ndescription: Am√©liorer l'exp√©rience utilisateur en utilisant Javascript pour un upload de fichier.\ncover_image: https://thepracticaldev.s3.amazonaws.com/i/uingc1g058bkex15174s.jpg\ntags: js, upload, fetch\n---\n\nDans cet article on va voir comment uploader un fichier en utilisant Javascript et l'API fetch. On partira d'un exemple en PHP que l'on fera √©voluer pour atteindre le r√©sultat souhait√©.\n\nLe code complet est disponible ici\n\n{% github jean-smaug/demo-file-upload no-readme %} \n\n# Version PHP\n\nConsiderons l'exemple suivant :\n\n![upload-php](https://thepracticaldev.s3.amazonaws.com/i/p8a2f0b5wkwcxobuxktz.gif)\n\nApr√®s la soumission du formulaire, on voit que l'URL change vers `upload.php`. Cette page enregistre le fichier upload√© et affiche un message de succ√®s. Il est ensuite redirig√© vers la page `index.html`. Ce syst√®me fonctionne, mais il implique trois chargements de pages.\n\nRegardons le code utilis√©.\n\n```html\n\u003c!DOCTYPE html\u003e\n\u003chtml\u003e\n  \u003chead\u003e\u003c!-- ... --\u003e\u003c/head\u003e\n  \u003cbody\u003e\n    \u003cform action=\"upload.php\" method=\"post\" enctype=\"multipart/form-data\"\u003e\n      \u003cinput type=\"file\" name=\"background\" /\u003e\n      \u003cbutton type=\"submit\"\u003eEnvoyer\u003c/button\u003e\n    \u003c/form\u003e\n  \u003c/body\u003e\n\u003c/html\u003e\n```\n\nCe code HTML est standard. Le seul point d'attention est l'attribut [**enctype**](https://www.w3schools.com/tags/att_form_enctype.asp) dont la valeur doit obligatoirement √™tre **multipart/form-data** pour pouvoir uploader un fichier.\n\n```php\n\u003c?php\n    header(\"Access-Control-Allow-Origin: *\");\n    \n    /* La variable superglobale $_FILES nous donne acc√®s aux fichiers\n    qui ont √©t√© upload√©s. La cl√© \"background\" fait r√©f√©rence √†\n    l'attribut name de \u003cinput name=\"background\" /\u003e */\n    $file = $_FILES[\"background\"];\n    $isFileUploaded = move_uploaded_file($file[\"tmp_name\"], __DIR__ . \"/../storage/\" . $file[\"name\"]);\n\n    if($isFileUploaded === false) {\n        http_response_code(500);\n        echo \"Probl√®me serveur\";\n    } \n    else {\n        http_response_code(201);\n        readfile('success.html');\n    }\n\n    // Redirection sur index.html apr√®s 2 secondes\n    header(\"Refresh:2; url=index.html\", true, 303);\n```\n\nLa partie serveur r√©cup√®re le fichier et de le d√©place dans le dossier storage. Une fois le traitement termin√© on affiche un message √† l'utilisateur puis on le redirige vers la page `index.html` apr√®s deux seconde. L'essentiel √©tant de retenir que le nom donn√© √† l'input √† son importance et sera utilis√© par le code PHP pour r√©cup√©rer le fichier.\n\n# APIs web\n\nNous allons avoir besoin de deux API web : [FormData](https://developer.mozilla.org/en-US/docs/Web/API/FormData/FormData) et [Fetch](https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch).\n\n## FormData\n\n![Form Data](https://thepracticaldev.s3.amazonaws.com/i/ck8wpzeskzq7ymvsqvq0.jpg)\n\nFormData dispose d'un tr√®s bon support de la part des navigateurs.\n\nCette API permet de repr√©senter un formulaire c√¥t√© Javascript. Ce formulaire aura un encodage de type **multipart/form-data**, donc il n'est pas n√©cessaire de le pr√©ciser dans le HTML. Ce type d'encodage est n√©cessaire d√®s lors que l'on souhaite uploader un fichier.\n\n## Fetch\n\n![Fetch](https://thepracticaldev.s3.amazonaws.com/i/guf8nore5xbot17hf0w4.jpg)\n\nAussi surprenant que cela puisse para√Ætre, c'est Internet Explorer qui nous casse les ligaments. Il existe deux solutions pour contourner le probl√®me de compatibilit√© :\n- Utiliser un [polyfill](https://github.com/github/fetch)\n- L'astuce que je pr√©sente plus bas\n\nL'API fetch est la fa√ßon moderne pour faire des requ√™tes HTTP. Elle repose sur les promesses ([Promise](https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Objets_globaux/Promise)). On peut utiliser les promesses avec plusieurs syntaxe, ici, on utilisera [async/await](https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Instructions/async_function).\n\n```js\n/* Le mot-cl√© async signifie que le mot cl√© await va √™tre \nutilis√© dans le corps de la fonction */\nasync function getLucky(){\n   /* Le mot cl√© await signifie que l'on attend le resultat d'une\n   fonction, ici somethingThatTakesTime. On ne sait pas combien\n   de temps mettra la fonction √† r√©pondre donc on attend le resultat\n   avant d'executer les instructions suivantes */\n   const luck = await somethingThatTakesTime()\n\n   return luck\n}\n```\n\nMon explication est tr√®s succinte, car je ne veux pas trop digresser. Cependant, je vous conseille [cette vid√©o](https://www.youtube.com/watch?v=uUZxHkcidps) de Grafikart pour en apprendre plus.\n\n# Version Javascript\n\n```html\n\u003c!DOCTYPE html\u003e\n\u003chtml\u003e\n  \u003chead\u003e\u003c!-- ... --\u003e\u003c/head\u003e\n  \u003cbody\u003e\n      \u003cform id=\"form\"\u003e\n          \u003cinput type=\"file\" name=\"background\" /\u003e\n          \u003cbutton type=\"submit\"\u003eEnvoyer\u003c/button\u003e\n      \u003c/form\u003e\n      \u003cp id=\"message\"\u003e\u003c/p\u003e\n      \u003cscript src=\"./app.js\"\u003e\u003c/script\u003e\n  \u003c/body\u003e\n\u003c/html\u003e\n```\n\nLa partie HTML reste sensiblement la m√™me. Les anciens attributs du `form` on laiss√© place √† un id. On ajoute un paragraphe pour afficher le message de succ√®s ou d'√©chec. Enfin, on charge notre script.\n\n```js\n/* On r√©cup√®re les √©l√©ments form et message */\nconst form = document.getElementById(\"form\");\nconst message = document.getElementById(\"message\");\n\n/* Lors de la soumission du formulaire on previent\nle comportement par d√©faut */\nform.addEventListener(\"submit\", async function(e) {\n  e.preventDefault();\n  \n  /* L'astuce pour IE, si vous n'utilisez pas de polyfill, consiste\n  √† inviter l'utilisateur √† utiliser un autre navigateur */\n  if (!window.fetch || !window.FormData) {\n    alert(\"Tu crois que c'est du respect mon gar√ßon ? Est ce que tu crois que c'est du respect d'utiliser un navigateur archa√Øque ?\"); \n    return;\n  }\n\n  /* Lorsque l'on instancie FormData on peut lui passer un √©l√©ment\n  form en param√®tre. De cette fa√ßon, FormData peut detecter chaque\n  input du formulaire et leur valeur. \n  Ici, this fait r√©f√©rence √† form */\n  const formData = new FormData(this);\n\n  try {\n    /* fetch() prend en 1er param√®tre l'url et en second param√®tre\n    les options. Ici, nous indiquons que notre requ√™te sera en POST\n    et que le corps de la requ√™te sera constitu√© de nos formData. */\n    await fetch(\"http://localhost:4000/upload.php\", {\n      method: \"POST\",\n      body: formData\n    });\n\n    // On affiche un message suivant le r√©sultat de la requ√™te\n    message.innerText = \"Fichier upload√© avec succ√®s \\\\o/\";\n  } catch (error) {\n    message.innerText =\n      \"C'est la cata, c'est la cata, c'est la catastrophe /o\\\\\";\n  }\n\n  // On r√©initialise le formulaire\n  this.reset()\n\n  // On efface le message apr√®s deux secondes\n  setTimeout(() =\u003e {\n    message.innerText = \"\";\n  }, 2000);\n});\n```\n\nC'est ainsi que l'on arrive √† ce r√©sultat.\n\n![upload-js](https://thepracticaldev.s3.amazonaws.com/i/hh1a5jinny4d83hw7rd8.gif)\n\nLa derni√®re √©tape est une optimisation du serveur. Les commentaires repr√©sentent les lignes devenue inutile et que nous pouvons donc supprimer.\n\n```php\n\u003c?php\n    header(\"Access-Control-Allow-Origin: *\");\n\n    $file = $_FILES[\"background\"];\n    $isFileUploaded = move_uploaded_file($file[\"tmp_name\"], __DIR__ . \"/../storage/\" . $file[\"name\"]);\n\n    if($isFileUploaded === false) {\n        http_response_code(500);\n        // echo \"Probl√®me serveur\";\n    } \n    else {\n        http_response_code(201);\n        // readfile('success.html');\n    }\n\n    // header(\"Refresh:2; url=index.html\", true, 303);\n```\n\n# Conclusion\n\nLa combinaison des APIs FormData et fetch, rend l'upload de fichier tr√®s simple. On √©vite le rechargement de page ce qui am√©liore l'exp√©rience utilisateur.\n\nPour effectuer des requ√™te HTTP, vous pouvez tr√®s bien utiliser Fetch, comme pr√©sent√© dans l'article mais vous devriez jeter un oeil √† :\n- [Axios](https://github.com/axios/axios), une librairie bas√©e sur XMLHttpRequest, l'anc√®tre de fetch. Elle est donc compatible avec IE.\n- [Ky](https://github.com/sindresorhus/ky), une librairie qui englobe fetch et propose de nouvelles fonctionnalit√©s. [Ky compar√© √† axios](https://twitter.com/sindresorhus/status/1037763588826398720) par le cr√©ateur de Ky.\n\nEnfin, il est tout √† fait possible d'utiliser ces principes avec des librairies comme React ou Vue.js. Il faudra simplement utiliser les r√©f√©rences sur vos formulaires.\n\nMerci de m'avoir lu.",
    "canonical_url": null,
    "show_comments": true,
    "main_image_background_hex_color": "#dddddd",
    "published_from_feed": false,
    "comments_count": 2,
    "video": null,
    "video_code": null,
    "video_source_url": null,
    "video_thumbnail_url": null,
    "video_closed_caption_track_url": null,
    "feed_source_url": null,
    "positive_reactions_count": 7,
    "edited_at": "2019-11-04T07:29:27.706Z",
    "crossposted_at": null,
    "language": "fr",
    "cached_tag_list": "javascript, upload, fetch",
    "path": "/jeansmaug/uploader-un-fichier-en-javascript-avec-fetch-cc5",
    "cached_user_name": "jean-smaug",
    "cached_user_username": "jeansmaug",
    "last_comment_at": "2019-11-04T13:06:52.608Z"
  },
  {
    "title": "File upload in Javascript using fetch",
    "slug": "file-upload-in-javascript-using-fetch-3akm-temp-slug-5603062",
    "created_at": "2019-11-03T03:34:48.282Z",
    "main_image": "https://thepracticaldev.s3.amazonaws.com/i/uingc1g058bkex15174s.jpg",
    "description": "Uploader simplement un fichier en utilisant Javascript et l'API fetch.",
    "published": false,
    "published_at": null,
    "processed_html": "\u003cp\u003eIn this article we'll see how to upload a file using the fetch API. We'll take a PHP example that we'll update in order to get the proper result.\u003c/p\u003e\n\n\u003cp\u003eThe code is available here\u003c/p\u003e\n\n\n\u003cdiv class=\"ltag-github-readme-tag\"\u003e\n  \u003cdiv class=\"readme-overview\"\u003e\n    \u003ch2\u003e\n      \u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--qF2jUiUG--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://practicaldev-herokuapp-com.freetls.fastly.net/assets/github-logo-6a5bca60a4ebf959a6df7f08217acd07ac2bc285164fae041eacb8a148b1bab9.svg\" alt=\"GitHub logo\" loading=\"lazy\"\u003e\n      \u003ca href=\"https://github.com/jean-smaug\"\u003e\n        jean-smaug\n      \u003c/a\u003e / \u003ca style=\"font-weight: 600;\" href=\"https://github.com/jean-smaug/demo-file-upload\"\u003e\n        demo-file-upload\n      \u003c/a\u003e\n    \u003c/h2\u003e\n    \u003ch3\u003e\n      \n    \u003c/h3\u003e\n  \u003c/div\u003e\n\u003c/div\u003e\n \n\u003ch1\u003e\n  \u003ca name=\"upload-in-php\" href=\"#upload-in-php\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Upload in PHP\n\u003c/h1\u003e\n\n\u003cp\u003eLet's take the following example :\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--YwxkmAoZ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/p8a2f0b5wkwcxobuxktz.gif\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--YwxkmAoZ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/p8a2f0b5wkwcxobuxktz.gif\" alt=\"upload-php\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eAfter the form submission, we see that the URL is changing to \u003ccode\u003eupload.php\u003c/code\u003e. This page store the uploaded file and display a success message. Finally the user is redirected to the first page. The example work but it require three pages load.\u003c/p\u003e\n\n\u003cp\u003eLet's see the code.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight html\"\u003e\u003ccode\u003e\u003cspan class=\"cp\"\u003e\u0026lt;!DOCTYPE html\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;html\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;head\u0026gt;\u003c/span\u003e\u003cspan class=\"c\"\u003e\u0026lt;!-- ... --\u0026gt;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026lt;/head\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;body\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;form\u003c/span\u003e \u003cspan class=\"na\"\u003eaction=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"upload.php\"\u003c/span\u003e \u003cspan class=\"na\"\u003emethod=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"post\"\u003c/span\u003e \u003cspan class=\"na\"\u003eenctype=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"multipart/form-data\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"nt\"\u003e\u0026lt;input\u003c/span\u003e \u003cspan class=\"na\"\u003etype=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"file\"\u003c/span\u003e \u003cspan class=\"na\"\u003ename=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"background\"\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"nt\"\u003e\u0026lt;button\u003c/span\u003e \u003cspan class=\"na\"\u003etype=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"submit\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003eEnvoyer\u003cspan class=\"nt\"\u003e\u0026lt;/button\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;/form\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;/body\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/html\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eThe HTML code is very common. We only have to pay attention to the \u003ca href=\"https://www.w3schools.com/tags/att_form_enctype.asp\"\u003e\u003cstrong\u003eenctype\u003c/strong\u003e\u003c/a\u003e attribute. His value must be \u003cstrong\u003emultipart/form-data\u003c/strong\u003e if we're doing a file upload.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight php\"\u003e\u003ccode\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?php\u003c/span\u003e\n    \u003cspan class=\"nb\"\u003eheader\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"Access-Control-Allow-Origin: *\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"cm\"\u003e/* The superglobal variable $_FILES gives us the ability to access\n    all files that were uploaded using an HTML form. The background key\n    makes reference to the value of the name attribute in \n    \u0026lt;input name=\"background\" /\u0026gt; */\u003c/span\u003e\n    \u003cspan class=\"nv\"\u003e$file\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_FILES\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"background\"\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"nv\"\u003e$isFileUploaded\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003emove_uploaded_file\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$file\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"tmp_name\"\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"nx\"\u003e__DIR__\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"/../storage/\"\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e \u003cspan class=\"nv\"\u003e$file\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"name\"\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$isFileUploaded\u003c/span\u003e \u003cspan class=\"o\"\u003e===\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nb\"\u003ehttp_response_code\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e500\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"Probl√®me serveur\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e \n    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nb\"\u003ehttp_response_code\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e201\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"nb\"\u003ereadfile\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'success.html'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// Redirection on index.html after 2 seconds\u003c/span\u003e\n    \u003cspan class=\"nb\"\u003eheader\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"Refresh:2; url=index.html\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e303\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eThe server side retrieve the file and move it into the storage folder. When processing is over, we display a success message and we redirect him to the \u003ccode\u003eindex.html\u003c/code\u003e page after two secondes. The main point is that the name given to the input element is important, because it's this name that the server is using to retrieve the file.\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"web-apis\" href=\"#web-apis\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Web APIs\n\u003c/h1\u003e\n\n\u003cp\u003eWe'll need two web API to perform the Upload in Javascript : \u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/API/FormData/FormData\"\u003eFormData\u003c/a\u003e and \u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch\"\u003eFetch\u003c/a\u003e.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"formdata\" href=\"#formdata\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  FormData\n\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--TLv0NXVu--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/ck8wpzeskzq7ymvsqvq0.jpg\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--TLv0NXVu--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/ck8wpzeskzq7ymvsqvq0.jpg\" alt=\"Form Data\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eFormData is well supported by browsers. \u003c/p\u003e\n\n\u003cp\u003eThis API gives us the ability to represent a form in Javscript. This form will have a \u003cstrong\u003emultipart/form-data\u003c/strong\u003e encoding, so it's not necessary to precise it in the HTML. This encoding is necessary since you're uploading a file.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"fetch\" href=\"#fetch\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Fetch\n\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--i8WhveDl--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/guf8nore5xbot17hf0w4.jpg\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--i8WhveDl--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/guf8nore5xbot17hf0w4.jpg\" alt=\"Fetch\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eSurprisingly, we have compatibilities problems with Internet Explorer.\u003cbr\u003e\nThere are two solution to avoid this :\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eUse a \u003ca href=\"https://github.com/github/fetch\"\u003epolyfill\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eThe trick I'm will use later in the article\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eThe fetch API is the modern way to perform HTTP requests. It's based on \u003ca href=\"https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Objets_globaux/Promise\"\u003epromise\u003c/a\u003e. There are various syntaxes for using promises, here we'll use the \u003cbr\u003e\nOn peut utiliser les promesses avec plusieurs syntaxe, ici on utilisera \u003ca href=\"https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Instructions/async_function\"\u003easync/await\u003c/a\u003e.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"cm\"\u003e/* The async keyword means that the await keyword\nwill be used inside the function. */\u003c/span\u003e\n\u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003egetLucky\u003c/span\u003e\u003cspan class=\"p\"\u003e(){\u003c/span\u003e\n   \u003cspan class=\"cm\"\u003e/* The await keyword means that we're wating the results of a\n   function, here somethingThatTakesTime. We don't know when the\n   function will return a value, so we're awaiting the end of the\n   process before executing next instructions. */\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eluck\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"nx\"\u003esomethingThatTakesTime\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\n   \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003eluck\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eI explained it in a short way, because it's not the main subjects. You'll be able able to easily find articles that are talking about promises and async/await.\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"in-javascript\" href=\"#in-javascript\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  In Javascript\n\u003c/h1\u003e\n\n\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight html\"\u003e\u003ccode\u003e\u003cspan class=\"cp\"\u003e\u0026lt;!DOCTYPE html\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;html\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;head\u0026gt;\u003c/span\u003e\u003cspan class=\"c\"\u003e\u0026lt;!-- ... --\u0026gt;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026lt;/head\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;body\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"nt\"\u003e\u0026lt;form\u003c/span\u003e \u003cspan class=\"na\"\u003eid=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"form\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n          \u003cspan class=\"nt\"\u003e\u0026lt;input\u003c/span\u003e \u003cspan class=\"na\"\u003etype=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"file\"\u003c/span\u003e \u003cspan class=\"na\"\u003ename=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"background\"\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n          \u003cspan class=\"nt\"\u003e\u0026lt;button\u003c/span\u003e \u003cspan class=\"na\"\u003etype=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"submit\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003eEnvoyer\u003cspan class=\"nt\"\u003e\u0026lt;/button\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"nt\"\u003e\u0026lt;/form\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"nt\"\u003e\u0026lt;p\u003c/span\u003e \u003cspan class=\"na\"\u003eid=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"message\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u0026lt;/p\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"nt\"\u003e\u0026lt;script \u003c/span\u003e\u003cspan class=\"na\"\u003esrc=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"./app.js\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u0026lt;/script\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;/body\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/html\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eThe HTML part is mainly the same. Previous form's attributes have been replaced by an id. And we're adding a paragraph where we'll display the success or failure message. And finally we load our script.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"cm\"\u003e/* We get form and message elements */\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eform\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetElementById\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eform\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003emessage\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetElementById\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003emessage\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"cm\"\u003e/* We're listing for the form submission and \nwe're preventing the default behaviour */\u003c/span\u003e\n\u003cspan class=\"nx\"\u003eform\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eaddEventListener\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003esubmit\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epreventDefault\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n  \u003cspan class=\"cm\"\u003e/* If your not using a polyfill for fetch, the trick for IE is to \n  suggest the user to use an other browser.\n  if (!window.fetch || !window.FormData) {\n    alert(\"R u fucking kidding me ??? Use another browser right now !\"); \n    return;\n  }\n\n  /* When we're instanciating FormData, we can pass it a form element.\n  FormData will be able to detect all inputs of the form and their \n  values. */\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eformData\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eFormData\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eform\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003etry\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"cm\"\u003e/* fetch() is taking two parameters, the first is URL and\n    the second are options. Here we're telling fetch that we'll\n    make a POST request and the body of the request, the data\n    we're sending will be our formData */\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"nx\"\u003efetch\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003ehttp://localhost:4000/upload.php\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"na\"\u003emethod\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003ePOST\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ebody\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eformData\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// We display a success or failure message.\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003einnerText\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eFichier upload√© avec succ√®s \u003c/span\u003e\u003cspan class=\"se\"\u003e\\\\\u003c/span\u003e\u003cspan class=\"s2\"\u003eo/\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003ecatch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003einnerText\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e\n      \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eC'est la cata, c'est la cata, c'est la catastrophe /o\u003c/span\u003e\u003cspan class=\"se\"\u003e\\\\\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"c1\"\u003e// We clean the form\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eform\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ereset\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\n  \u003cspan class=\"c1\"\u003e// We're removing the message after two seconds\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003esetTimeout\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003einnerText\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e},\u003c/span\u003e \u003cspan class=\"mi\"\u003e2000\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eWith this code, we get this result.\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--79uuPWtX--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/hh1a5jinny4d83hw7rd8.gif\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--79uuPWtX--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/hh1a5jinny4d83hw7rd8.gif\" alt=\"upload-js\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eThe last step is server optimization. Commentaries represents lines that became useless. So we can remove them.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight php\"\u003e\u003ccode\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?php\u003c/span\u003e\n    \u003cspan class=\"nb\"\u003eheader\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"Access-Control-Allow-Origin: *\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"nv\"\u003e$file\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_FILES\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"background\"\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"nv\"\u003e$isFileUploaded\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003emove_uploaded_file\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$file\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"tmp_name\"\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"nx\"\u003e__DIR__\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"/../storage/\"\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e \u003cspan class=\"nv\"\u003e$file\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"name\"\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$isFileUploaded\u003c/span\u003e \u003cspan class=\"o\"\u003e===\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nb\"\u003ehttp_response_code\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e500\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// echo \"Probl√®me serveur\";\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e \n    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nb\"\u003ehttp_response_code\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e201\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// readfile('success.html');\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// header(\"Refresh:2; url=index.html\", true, 303);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003ch1\u003e\n  \u003ca name=\"conclusion\" href=\"#conclusion\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Conclusion\n\u003c/h1\u003e\n\n\u003cp\u003eCombination of FormData and fetch APIs are making file upload really easy. We're avoiding pages reload in order to improve user experience.\u003c/p\u003e\n\n\u003cp\u003eTo perform HTTP requests, it's possible, like in this post, to use fetch. But you should consider :\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"https://github.com/axios/axios\"\u003eAxios\u003c/a\u003e, XMLHttpRequest based library. XMLHttpRequest is the old way to perform HTTP request, so it's compatible with IE.\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://github.com/sindresorhus/ky\"\u003eKy\u003c/a\u003e, a wrapper for fetch. It's adding some features. \nune librairie qui englobe fetch et propose de nouvelles fonctionnalit√©s. \u003ca href=\"https://twitter.com/sindresorhus/status/1037763588826398720\"\u003eKy compared to axios\u003c/a\u003e by Ky's creator.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eFinally, it's possible to use these principle with libraries such as React or Vue.js. You'll just have to use references in order to access form element.\u003c/p\u003e\n\n\u003cp\u003eThanks for reading.\u003c/p\u003e\n\n",
    "social_image": null,
    "body_markdown": "---\ntitle: File upload in Javascript using fetch\npublished: false\ndescription: Uploader simplement un fichier en utilisant Javascript et l'API fetch.\ncover_image: https://thepracticaldev.s3.amazonaws.com/i/uingc1g058bkex15174s.jpg\ntags: js, upload, fetch\n---\n\nIn this article we'll see how to upload a file using the fetch API. We'll take a PHP example that we'll update in order to get the proper result.\n\nThe code is available here\n\n{% github jean-smaug/demo-file-upload no-readme %} \n\n# Upload in PHP\n\nLet's take the following example :\n\n![upload-php](https://thepracticaldev.s3.amazonaws.com/i/p8a2f0b5wkwcxobuxktz.gif)\n\nAfter the form submission, we see that the URL is changing to `upload.php`. This page store the uploaded file and display a success message. Finally the user is redirected to the first page. The example work but it require three pages load.\n\nLet's see the code.\n\n```html\n\u003c!DOCTYPE html\u003e\n\u003chtml\u003e\n  \u003chead\u003e\u003c!-- ... --\u003e\u003c/head\u003e\n  \u003cbody\u003e\n    \u003cform action=\"upload.php\" method=\"post\" enctype=\"multipart/form-data\"\u003e\n      \u003cinput type=\"file\" name=\"background\" /\u003e\n      \u003cbutton type=\"submit\"\u003eEnvoyer\u003c/button\u003e\n    \u003c/form\u003e\n  \u003c/body\u003e\n\u003c/html\u003e\n```\n\nThe HTML code is very common. We only have to pay attention to the [**enctype**](https://www.w3schools.com/tags/att_form_enctype.asp) attribute. His value must be **multipart/form-data** if we're doing a file upload.\n\n```php\n\u003c?php\n    header(\"Access-Control-Allow-Origin: *\");\n    \n    /* The superglobal variable $_FILES gives us the ability to access\n    all files that were uploaded using an HTML form. The background key\n    makes reference to the value of the name attribute in \n    \u003cinput name=\"background\" /\u003e */\n    $file = $_FILES[\"background\"];\n    $isFileUploaded = move_uploaded_file($file[\"tmp_name\"], __DIR__ . \"/../storage/\" . $file[\"name\"]);\n\n    if($isFileUploaded === false) {\n        http_response_code(500);\n        echo \"Probl√®me serveur\";\n    } \n    else {\n        http_response_code(201);\n        readfile('success.html');\n    }\n\n    // Redirection on index.html after 2 seconds\n    header(\"Refresh:2; url=index.html\", true, 303);\n```\n\nThe server side retrieve the file and move it into the storage folder. When processing is over, we display a success message and we redirect him to the `index.html` page after two secondes. The main point is that the name given to the input element is important, because it's this name that the server is using to retrieve the file.\n\n# Web APIs\n\nWe'll need two web API to perform the Upload in Javascript : [FormData](https://developer.mozilla.org/en-US/docs/Web/API/FormData/FormData) and [Fetch](https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch).\n\n## FormData\n\n![Form Data](https://thepracticaldev.s3.amazonaws.com/i/ck8wpzeskzq7ymvsqvq0.jpg)\n\nFormData is well supported by browsers. \n\nThis API gives us the ability to represent a form in Javscript. This form will have a **multipart/form-data** encoding, so it's not necessary to precise it in the HTML. This encoding is necessary since you're uploading a file.\n\n## Fetch\n\n![Fetch](https://thepracticaldev.s3.amazonaws.com/i/guf8nore5xbot17hf0w4.jpg)\n\nSurprisingly, we have compatibilities problems with Internet Explorer.\nThere are two solution to avoid this :\n- Use a [polyfill](https://github.com/github/fetch)\n- The trick I'm will use later in the article\n\nThe fetch API is the modern way to perform HTTP requests. It's based on [promise](https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Objets_globaux/Promise). There are various syntaxes for using promises, here we'll use the \nOn peut utiliser les promesses avec plusieurs syntaxe, ici on utilisera [async/await](https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Instructions/async_function).\n\n```js\n/* The async keyword means that the await keyword\nwill be used inside the function. */\nasync function getLucky(){\n   /* The await keyword means that we're wating the results of a\n   function, here somethingThatTakesTime. We don't know when the\n   function will return a value, so we're awaiting the end of the\n   process before executing next instructions. */\n   const luck = await somethingThatTakesTime()\n\n   return luck\n}\n```\n\nI explained it in a short way, because it's not the main subjects. You'll be able able to easily find articles that are talking about promises and async/await.\n\n# In Javascript\n\n```html\n\u003c!DOCTYPE html\u003e\n\u003chtml\u003e\n  \u003chead\u003e\u003c!-- ... --\u003e\u003c/head\u003e\n  \u003cbody\u003e\n      \u003cform id=\"form\"\u003e\n          \u003cinput type=\"file\" name=\"background\" /\u003e\n          \u003cbutton type=\"submit\"\u003eEnvoyer\u003c/button\u003e\n      \u003c/form\u003e\n      \u003cp id=\"message\"\u003e\u003c/p\u003e\n      \u003cscript src=\"./app.js\"\u003e\u003c/script\u003e\n  \u003c/body\u003e\n\u003c/html\u003e\n```\n\nThe HTML part is mainly the same. Previous form's attributes have been replaced by an id. And we're adding a paragraph where we'll display the success or failure message. And finally we load our script.\n\n```js\n/* We get form and message elements */\nconst form = document.getElementById(\"form\");\nconst message = document.getElementById(\"message\");\n\n/* We're listing for the form submission and \nwe're preventing the default behaviour */\nform.addEventListener(\"submit\", async function(e) {\n  e.preventDefault();\n  \n  /* If your not using a polyfill for fetch, the trick for IE is to \n  suggest the user to use an other browser.\n  if (!window.fetch || !window.FormData) {\n    alert(\"R u fucking kidding me ??? Use another browser right now !\"); \n    return;\n  }\n\n  /* When we're instanciating FormData, we can pass it a form element.\n  FormData will be able to detect all inputs of the form and their \n  values. */\n  const formData = new FormData(form);\n\n  try {\n    /* fetch() is taking two parameters, the first is URL and\n    the second are options. Here we're telling fetch that we'll\n    make a POST request and the body of the request, the data\n    we're sending will be our formData */\n    await fetch(\"http://localhost:4000/upload.php\", {\n      method: \"POST\",\n      body: formData\n    });\n\n    // We display a success or failure message.\n    message.innerText = \"Fichier upload√© avec succ√®s \\\\o/\";\n  } catch (error) {\n    message.innerText =\n      \"C'est la cata, c'est la cata, c'est la catastrophe /o\\\\\";\n  }\n\n  // We clean the form\n  form.reset()\n\n  // We're removing the message after two seconds\n  setTimeout(() =\u003e {\n    message.innerText = \"\";\n  }, 2000);\n});\n```\n\nWith this code, we get this result.\n\n![upload-js](https://thepracticaldev.s3.amazonaws.com/i/hh1a5jinny4d83hw7rd8.gif)\n\nThe last step is server optimization. Commentaries represents lines that became useless. So we can remove them.\n\n```php\n\u003c?php\n    header(\"Access-Control-Allow-Origin: *\");\n\n    $file = $_FILES[\"background\"];\n    $isFileUploaded = move_uploaded_file($file[\"tmp_name\"], __DIR__ . \"/../storage/\" . $file[\"name\"]);\n\n    if($isFileUploaded === false) {\n        http_response_code(500);\n        // echo \"Probl√®me serveur\";\n    } \n    else {\n        http_response_code(201);\n        // readfile('success.html');\n    }\n\n    // header(\"Refresh:2; url=index.html\", true, 303);\n```\n\n# Conclusion\n\nCombination of FormData and fetch APIs are making file upload really easy. We're avoiding pages reload in order to improve user experience.\n\nTo perform HTTP requests, it's possible, like in this post, to use fetch. But you should consider :\n- [Axios](https://github.com/axios/axios), XMLHttpRequest based library. XMLHttpRequest is the old way to perform HTTP request, so it's compatible with IE.\n- [Ky](https://github.com/sindresorhus/ky), a wrapper for fetch. It's adding some features. \nune librairie qui englobe fetch et propose de nouvelles fonctionnalit√©s. [Ky compared to axios](https://twitter.com/sindresorhus/status/1037763588826398720) by Ky's creator.\n\nFinally, it's possible to use these principle with libraries such as React or Vue.js. You'll just have to use references in order to access form element.\n\nThanks for reading.",
    "canonical_url": null,
    "show_comments": true,
    "main_image_background_hex_color": "#dddddd",
    "published_from_feed": false,
    "comments_count": 0,
    "video": null,
    "video_code": null,
    "video_source_url": null,
    "video_thumbnail_url": null,
    "video_closed_caption_track_url": null,
    "feed_source_url": null,
    "positive_reactions_count": 0,
    "edited_at": null,
    "crossposted_at": null,
    "language": "en",
    "cached_tag_list": "javascript, upload, fetch",
    "path": "/jeansmaug/file-upload-in-javascript-using-fetch-3akm-temp-slug-5603062",
    "cached_user_name": "jean-smaug",
    "cached_user_username": "jeansmaug",
    "last_comment_at": "2017-01-01T05:00:00.000Z"
  },
  {
    "title": "Le spread en Javascript",
    "slug": "le-spread-en-javascript-4gm2-temp-slug-9535637",
    "created_at": "2019-11-12T16:31:20.711Z",
    "main_image": "https://thepracticaldev.s3.amazonaws.com/i/o4a2x7cylj76clq6v3o1.jpg",
    "description": "",
    "published": false,
    "published_at": null,
    "processed_html": "\u003cp\u003eVous avez peut-√™tre rencontr√© le spred en Javascript. Il est symbolis√© par \u003ccode\u003e...\u003c/code\u003e.\u003c/p\u003e\n\n",
    "social_image": null,
    "body_markdown": "---\ntitle: Le spread en Javascript\npublished: false\ndescription: \ncover_image: https://thepracticaldev.s3.amazonaws.com/i/o4a2x7cylj76clq6v3o1.jpg\ntags: \n---\n\nVous avez peut-√™tre rencontr√© le spred en Javascript. Il est symbolis√© par `...`.",
    "canonical_url": null,
    "show_comments": true,
    "main_image_background_hex_color": "#dddddd",
    "published_from_feed": false,
    "comments_count": 0,
    "video": null,
    "video_code": null,
    "video_source_url": null,
    "video_thumbnail_url": null,
    "video_closed_caption_track_url": null,
    "feed_source_url": null,
    "positive_reactions_count": 0,
    "edited_at": null,
    "crossposted_at": null,
    "language": "fr",
    "cached_tag_list": "",
    "path": "/jeansmaug/le-spread-en-javascript-4gm2-temp-slug-9535637",
    "cached_user_name": "jean-smaug",
    "cached_user_username": "jeansmaug",
    "last_comment_at": "2017-01-01T05:00:00.000Z"
  },
  {
    "title": "Vers le scroll infini, et au-del√†",
    "slug": "vers-le-scroll-infini-et-au-dela-4dhd",
    "created_at": "2019-11-18T12:43:52.810Z",
    "main_image": "https://thepracticaldev.s3.amazonaws.com/i/c4gc84f079kv5mdy1qni.jpg",
    "description": "Utiliser l'intersection observer pour impl√©menter un scroll infini performant.",
    "published": true,
    "published_at": "2019-11-18T12:46:00.968Z",
    "processed_html": "\u003cp\u003eDans ce post je vous propose d'impl√©menter un scroll infini en utilisant l'API \u003ca href=\"https://developer.mozilla.org/fr/docs/Web/API/Intersection_Observer_API\"\u003eIntersection Observer\u003c/a\u003e. \u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--hYct8xi1--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/232apbq1dyacb3j6mzyc.gif\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--hYct8xi1--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/232apbq1dyacb3j6mzyc.gif\" alt=\"demo\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eLe code complet est disponible ici :\u003c/p\u003e\n\n\n\u003cdiv class=\"ltag-github-readme-tag\"\u003e\n  \u003cdiv class=\"readme-overview\"\u003e\n    \u003ch2\u003e\n      \u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--qF2jUiUG--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://practicaldev-herokuapp-com.freetls.fastly.net/assets/github-logo-6a5bca60a4ebf959a6df7f08217acd07ac2bc285164fae041eacb8a148b1bab9.svg\" alt=\"GitHub logo\" loading=\"lazy\"\u003e\n      \u003ca href=\"https://github.com/jean-smaug\"\u003e\n        jean-smaug\n      \u003c/a\u003e / \u003ca style=\"font-weight: 600;\" href=\"https://github.com/jean-smaug/demo-infinite-scroll\"\u003e\n        demo-infinite-scroll\n      \u003c/a\u003e\n    \u003c/h2\u003e\n    \u003ch3\u003e\n      \n    \u003c/h3\u003e\n  \u003c/div\u003e\n\u003c/div\u003e\n\n\n\u003ch1\u003e\n  \u003ca name=\"pr%C3%A9sentation\" href=\"#pr%C3%A9sentation\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Pr√©sentation\n\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--wDbOv3nu--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/383eq0tk2iia8h45phrr.gif\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--wDbOv3nu--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/383eq0tk2iia8h45phrr.gif\" alt=\"collider\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eCette API permet de d√©tecter lorsqu'un √©l√©ment cible (target) devient visible pour un √©l√©ment racine (root).\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eoptions\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eroot\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003equerySelector\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003e#scrollArea\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n  \u003cspan class=\"na\"\u003erootMargin\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003e20px 5px\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ethreshold\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mf\"\u003e0.5\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mf\"\u003e1.0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003ecallback\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"cm\"\u003e/*...*/\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eobserver\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eIntersectionObserver\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ecallback\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eoptions\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eLe constructeur prend en param√®tre un callback qui sera appel√© lorsque la cible devient visible ou invisible pour l'√©l√©ment racine. \u003cbr\u003e\nIl est possible de changer la mani√®re dont le callback est appel√© en sp√©cifiant des options :\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003cstrong\u003eroot\u003c/strong\u003e : L'√©l√©ment qui d√©tecte la visibilit√© de la cible. Il doit √™tre un anc√™tre de la cible. Par d√©faut la zone d'affichage (le viewport) du navigateur est utilis√©e.\u003c/li\u003e\n\u003cli\u003e\n\u003cstrong\u003erootMargin\u003c/strong\u003e : La marge autour de la propri√©t√© \u003cstrong\u003eroot\u003c/strong\u003e. Elle prend des valeurs similaires √† la propri√©t√© CSS margin. Cela permet de detecter la cible plus t√¥t (marge positive) ou plus tard (marge n√©gative).\u003c/li\u003e\n\u003cli\u003e\n\u003cstrong\u003ethreshold\u003c/strong\u003e : Soit un nombre, soit un tableau de nombre qui indique √† quel pourcentage de la visibilit√© de la cible la fonction callback de la cible doit √™tre ex√©cut√©.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"support-navigateur\" href=\"#support-navigateur\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Support navigateur\n\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--SnsDGvzm--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/329qiwa96z4qf3j4vw76.jpg\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--SnsDGvzm--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/329qiwa96z4qf3j4vw76.jpg\" alt=\"can-i-use\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eEn terme de support, comme d'habitude IE pose des probl√®mes. √Ä cela, j'ai envie de dire deux choses :\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eIE, pour moi tu es d√©j√† mort\u003c/li\u003e\n\u003cli\u003eLes utilisateurs d'IE ne m√©ritent que notre m√©pris\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eIl n'est donc plus n√©cessaire de se pr√©occuper de ce genre de d√©tails. Si jamais vous √©prouvez des remords pour ces √™tres cruels, qui utilisent un outil ne respectant pas les conventions de Gen√®ve, alors vous pouvez toujours utiliser \u003ca href=\"https://github.com/w3c/IntersectionObserver/tree/master/polyfill\"\u003eun polyfill\u003c/a\u003e.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"exemple\" href=\"#exemple\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Exemple\n\u003c/h2\u003e\n\n\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight html\"\u003e\u003ccode\u003e\u003cspan class=\"cp\"\u003e\u0026lt;!DOCTYPE html\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;html\u003c/span\u003e \u003cspan class=\"na\"\u003elang=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"fr\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;head\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c\"\u003e\u0026lt;!-- ... --\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;link\u003c/span\u003e \u003cspan class=\"na\"\u003erel=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"stylesheet\"\u003c/span\u003e \u003cspan class=\"na\"\u003ehref=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"./spinner.css\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;/head\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;body\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c\"\u003e\u0026lt;!-- Le contenu d'une balise template n'est pas affich√©. \n    On s'en sert uniquement c√¥t√© JS --\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;template\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"nt\"\u003e\u0026lt;div\u003c/span\u003e \u003cspan class=\"na\"\u003eclass=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"picture\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c\"\u003e\u0026lt;!-- Le spinner vient de https://loading.io/css --\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\u0026lt;div\u003c/span\u003e \u003cspan class=\"na\"\u003eclass=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"lds-dual-ring\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u0026lt;/div\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c\"\u003e\u0026lt;!-- Pr√©ciser la taille de l'image permet au navigateur de \n        reserver l'espace n√©cessaire pour l'image --\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\u0026lt;img\u003c/span\u003e \u003cspan class=\"na\"\u003eheight=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"250\"\u003c/span\u003e \u003cspan class=\"na\"\u003ewidth=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"400\"\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"nt\"\u003e\u0026lt;/div\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;/template\u0026gt;\u003c/span\u003e\n\n    \u003cspan class=\"nt\"\u003e\u0026lt;main\u0026gt;\u0026lt;/main\u0026gt;\u003c/span\u003e\n\n    \u003cspan class=\"nt\"\u003e\u0026lt;script \u003c/span\u003e\u003cspan class=\"na\"\u003esrc=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"./app.js\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u0026lt;/script\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;/body\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/html\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003emain\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003equerySelector\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003emain\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003etemplate\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003equerySelector\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003etemplate\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003econtent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003equerySelector\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003ediv\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"cm\"\u003e/* Cette fonction utilise l'API https://picsum.photos pour retourner\nl'URL d'une image d'une taille donn√©e. Le param√®tre nocache est l√†\npour √©viter que le navigateur ne renvoi toujours la m√™me photo\n(le nom nocache a √©t√© choisi arbitrairement) */\u003c/span\u003e\n\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003egetImageUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e \u003cspan class=\"nx\"\u003ewidth\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eheight\u003c/span\u003e \u003cspan class=\"p\"\u003e})\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"s2\"\u003e`https://picsum.photos/\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003ewidth\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e/\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003eheight\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e?nocache=\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003eperformance\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003enow\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\u003cspan class=\"s2\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// Cette fonction retourne un clone du template d√©fini dans le HTML\u003c/span\u003e\n\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003erenderPicture\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003epicture\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003etemplate\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecloneNode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eimage\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003epicture\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003equerySelector\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eimg\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003espinner\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003epicture\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003equerySelector\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e.lds-dual-ring\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n  \u003cspan class=\"cm\"\u003e/* La largeur et la hauteur de l'image sont d√©termin√©es\n  par les attributs qui ont √©t√© d√©finis c√¥t√© HTML */\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eimage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esrc\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003egetImageUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ewidth\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eimage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ewidth\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eheight\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eimage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eheight\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n  \u003cspan class=\"c1\"\u003e// Lorsque l'image est charg√©e on supprime le loader\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eimage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eonload\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003epicture\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eremoveChild\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003espinner\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003epicture\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// Ajoute un √©l√©ment au DOM et observe cet √©l√©ment\u003c/span\u003e\n\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003eappendAndObserve\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eobserver\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eelement\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003emain\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eappendChild\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eelement\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eobserver\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eobserve\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eelement\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"cm\"\u003e/* La fonction de callback pass√©e au constructeur sera appel√©e\nlorsqu'un nouvel √©l√©ment est observ√© et √† chaque fois qu'un\n√©l√©ment devient visible. Il prend en param√®tre la liste des\n√©l√©ments observ√©s. */\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eintersectionObserver\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eIntersectionObserver\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eentries\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eentry\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eentries\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n  \u003cspan class=\"cm\"\u003e/* Lorsque l'√©l√©ment devient visible on arr√™te de l'observer et\n  on ajoute un nouvel √©l√©ment que l'on observe */\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eentry\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eisIntersecting\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eunobserve\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eentry\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etarget\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003epicture\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003erenderPicture\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eappendAndObserve\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003epicture\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// On ajoute l'image initiale au DOM et on l'observe \u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eintialPicture\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003erenderPicture\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"nx\"\u003eappendAndObserve\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eintersectionObserver\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eintialPicture\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eCette solution a l'avantage de s'adapter √† la taille de l'√©cran. Lorsque l'√©cran est capable d'afficher 3 images alors on a 4 images dans le DOM. Sur un √©cran plus petit, capable d'afficher 2 images alors 3 images seront dans le DOM.\u003cbr\u003e\nDe mani√®re g√©n√©rale on a toujours (N images visibles + 1) images charg√©es dans le DOM.\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--Mn8x6vVC--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/gknsy51kv3tslayvo83k.gif\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--Mn8x6vVC--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/gknsy51kv3tslayvo83k.gif\" alt=\"demo-viewport\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eCela est possible car l'attribut height a √©t√© pass√© a la balise img, ce qui permet a l'Intersection Observer de faire ses calculs avant que l'image ne soit charg√©e.\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"conclusion\" href=\"#conclusion\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Conclusion\n\u003c/h1\u003e\n\n\u003cp\u003eLe scroll infini est un cas d'utilisation tr√®s pratique pour d√©montrer la puissance de l'API Intersection Observer.\u003c/p\u003e\n\n\u003cp\u003eCombin√© aux frameworks comme React ou Vue.js, on pourrait d√©tecter quels sont les √©l√©ments qui doivent √™tre rendus et ainsi gagner en performances sur des composants comme les carousels ou toute autre liste d'√©l√©ments dont la taille d√©passe l'affichage actuel du navigateur.\u003c/p\u003e\n\n\u003cp\u003eMerci √† Julien Ducrot pour la relecture.\u003c/p\u003e\n\n\u003cp\u003eMerci de m'avoir lu.\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"liens\" href=\"#liens\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Liens\n\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://www.w3schools.com/html/html_images.asp\"\u003ehttps://www.w3schools.com/html/html_images.asp\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.w3schools.com/tags/tag_template.asp\"\u003ehttps://www.w3schools.com/tags/tag_template.asp\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://itnext.io/1v1-scroll-listener-vs-intersection-observers-469a26ab9eb6\"\u003ehttps://itnext.io/1v1-scroll-listener-vs-intersection-observers-469a26ab9eb6\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n",
    "social_image": null,
    "body_markdown": "---\ntitle: Vers le scroll infini, et au-del√†\npublished: true\ndescription: Utiliser l'intersection observer pour impl√©menter un scroll infini performant.\ncover_image: https://thepracticaldev.s3.amazonaws.com/i/c4gc84f079kv5mdy1qni.jpg\ntags: javascript, intersection-observer\n---\n\nDans ce post je vous propose d'impl√©menter un scroll infini en utilisant l'API [Intersection Observer](https://developer.mozilla.org/fr/docs/Web/API/Intersection_Observer_API). \n\n![demo](https://thepracticaldev.s3.amazonaws.com/i/232apbq1dyacb3j6mzyc.gif)\n\nLe code complet est disponible ici :\n\n{% github jean-smaug/demo-infinite-scroll no-readme %}\n\n# Pr√©sentation\n\n![collider](https://thepracticaldev.s3.amazonaws.com/i/383eq0tk2iia8h45phrr.gif)\n\nCette API permet de d√©tecter lorsqu'un √©l√©ment cible (target) devient visible pour un √©l√©ment racine (root).\n\n```js\nconst options = {\n  root: document.querySelector('#scrollArea'),\n  rootMargin: '20px 5px',\n  threshold: [0.5, 1.0]\n}\n\nfunction callback() {/*...*/}\n\nconst observer = new IntersectionObserver(callback, options);\n```\n\nLe constructeur prend en param√®tre un callback qui sera appel√© lorsque la cible devient visible ou invisible pour l'√©l√©ment racine. \nIl est possible de changer la mani√®re dont le callback est appel√© en sp√©cifiant des options :\n\n- **root** : L'√©l√©ment qui d√©tecte la visibilit√© de la cible. Il doit √™tre un anc√™tre de la cible. Par d√©faut la zone d'affichage (le viewport) du navigateur est utilis√©e.\n- **rootMargin** : La marge autour de la propri√©t√© **root**. Elle prend des valeurs similaires √† la propri√©t√© CSS margin. Cela permet de detecter la cible plus t√¥t (marge positive) ou plus tard (marge n√©gative).\n- **threshold** : Soit un nombre, soit un tableau de nombre qui indique √† quel pourcentage de la visibilit√© de la cible la fonction callback de la cible doit √™tre ex√©cut√©.\n\n# Support navigateur\n\n![can-i-use](https://thepracticaldev.s3.amazonaws.com/i/329qiwa96z4qf3j4vw76.jpg)\n\nEn terme de support, comme d'habitude IE pose des probl√®mes. √Ä cela, j'ai envie de dire deux choses :\n- IE, pour moi tu es d√©j√† mort\n- Les utilisateurs d'IE ne m√©ritent que notre m√©pris\n\nIl n'est donc plus n√©cessaire de se pr√©occuper de ce genre de d√©tails. Si jamais vous √©prouvez des remords pour ces √™tres cruels, qui utilisent un outil ne respectant pas les conventions de Gen√®ve, alors vous pouvez toujours utiliser [un polyfill](https://github.com/w3c/IntersectionObserver/tree/master/polyfill).\n\n## Exemple\n\n```html\n\u003c!DOCTYPE html\u003e\n\u003chtml lang=\"fr\"\u003e\n  \u003chead\u003e\n    \u003c!-- ... --\u003e\n    \u003clink rel=\"stylesheet\" href=\"./spinner.css\"\u003e\n  \u003c/head\u003e\n  \u003cbody\u003e\n    \u003c!-- Le contenu d'une balise template n'est pas affich√©. \n    On s'en sert uniquement c√¥t√© JS --\u003e\n    \u003ctemplate\u003e\n      \u003cdiv class=\"picture\"\u003e\n        \u003c!-- Le spinner vient de https://loading.io/css --\u003e\n        \u003cdiv class=\"lds-dual-ring\"\u003e\u003c/div\u003e\n        \u003c!-- Pr√©ciser la taille de l'image permet au navigateur de \n        reserver l'espace n√©cessaire pour l'image --\u003e\n        \u003cimg height=\"250\" width=\"400\" /\u003e\n      \u003c/div\u003e\n    \u003c/template\u003e\n\n    \u003cmain\u003e\u003c/main\u003e\n\n    \u003cscript src=\"./app.js\"\u003e\u003c/script\u003e\n  \u003c/body\u003e\n\u003c/html\u003e\n```\n\n```js\nconst main = document.querySelector(\"main\");\nconst template = document.querySelector(\"template\").content.querySelector(\"div\");\n\n/* Cette fonction utilise l'API https://picsum.photos pour retourner\nl'URL d'une image d'une taille donn√©e. Le param√®tre nocache est l√†\npour √©viter que le navigateur ne renvoi toujours la m√™me photo\n(le nom nocache a √©t√© choisi arbitrairement) */\nfunction getImageUrl({ width, height }) {\n  return `https://picsum.photos/${width}/${height}?nocache=${performance.now()}`;\n}\n\n// Cette fonction retourne un clone du template d√©fini dans le HTML\nfunction renderPicture() {\n  const picture = template.cloneNode(true);\n  const image = picture.querySelector(\"img\");\n  const spinner = picture.querySelector(\".lds-dual-ring\");\n\n  /* La largeur et la hauteur de l'image sont d√©termin√©es\n  par les attributs qui ont √©t√© d√©finis c√¥t√© HTML */\n  image.src = getImageUrl({\n    width: image.width,\n    height: image.height\n  });\n\n  // Lorsque l'image est charg√©e on supprime le loader\n  image.onload = function() {\n    picture.removeChild(spinner);\n  };\n\n  return picture;\n}\n\n// Ajoute un √©l√©ment au DOM et observe cet √©l√©ment\nfunction appendAndObserve(observer, element) {\n  main.appendChild(element);\n  observer.observe(element);\n}\n\n/* La fonction de callback pass√©e au constructeur sera appel√©e\nlorsqu'un nouvel √©l√©ment est observ√© et √† chaque fois qu'un\n√©l√©ment devient visible. Il prend en param√®tre la liste des\n√©l√©ments observ√©s. */\nconst intersectionObserver = new IntersectionObserver(function(entries) {\n  const entry = entries[0];\n\n  /* Lorsque l'√©l√©ment devient visible on arr√™te de l'observer et\n  on ajoute un nouvel √©l√©ment que l'on observe */\n  if (entry.isIntersecting) {\n    this.unobserve(entry.target);\n\n    const picture = renderPicture();\n    appendAndObserve(this, picture);\n  }\n});\n\n// On ajoute l'image initiale au DOM et on l'observe \nconst intialPicture = renderPicture();\nappendAndObserve(intersectionObserver, intialPicture);\n```\n\nCette solution a l'avantage de s'adapter √† la taille de l'√©cran. Lorsque l'√©cran est capable d'afficher 3 images alors on a 4 images dans le DOM. Sur un √©cran plus petit, capable d'afficher 2 images alors 3 images seront dans le DOM.\nDe mani√®re g√©n√©rale on a toujours (N images visibles + 1) images charg√©es dans le DOM.\n\n![demo-viewport](https://thepracticaldev.s3.amazonaws.com/i/gknsy51kv3tslayvo83k.gif)\n\nCela est possible car l'attribut height a √©t√© pass√© a la balise img, ce qui permet a l'Intersection Observer de faire ses calculs avant que l'image ne soit charg√©e.\n\n# Conclusion\n\nLe scroll infini est un cas d'utilisation tr√®s pratique pour d√©montrer la puissance de l'API Intersection Observer.\n\nCombin√© aux frameworks comme React ou Vue.js, on pourrait d√©tecter quels sont les √©l√©ments qui doivent √™tre rendus et ainsi gagner en performances sur des composants comme les carousels ou toute autre liste d'√©l√©ments dont la taille d√©passe l'affichage actuel du navigateur.\n\nMerci √† Julien Ducrot pour la relecture.\n\nMerci de m'avoir lu.\n\n# Liens\n\n- [https://www.w3schools.com/html/html_images.asp](https://www.w3schools.com/html/html_images.asp)\n- [https://www.w3schools.com/tags/tag_template.asp](https://www.w3schools.com/tags/tag_template.asp)\n- [https://itnext.io/1v1-scroll-listener-vs-intersection-observers-469a26ab9eb6](https://itnext.io/1v1-scroll-listener-vs-intersection-observers-469a26ab9eb6)",
    "canonical_url": null,
    "show_comments": true,
    "main_image_background_hex_color": "#dddddd",
    "published_from_feed": false,
    "comments_count": 0,
    "video": null,
    "video_code": null,
    "video_source_url": null,
    "video_thumbnail_url": null,
    "video_closed_caption_track_url": null,
    "feed_source_url": null,
    "positive_reactions_count": 8,
    "edited_at": "2020-01-14T11:54:31.800Z",
    "crossposted_at": null,
    "language": "fr",
    "cached_tag_list": "javascript, intersectionobserver",
    "path": "/jeansmaug/vers-le-scroll-infini-et-au-dela-4dhd",
    "cached_user_name": "jean-smaug",
    "cached_user_username": "jeansmaug",
    "last_comment_at": "2019-11-18T12:46:00.968Z"
  },
  {
    "title": "To infinity scroll, and Beyond",
    "slug": "to-infinity-scroll-and-beyond-3c0d-temp-slug-7484183",
    "created_at": "2019-11-25T12:19:24.603Z",
    "main_image": "https://thepracticaldev.s3.amazonaws.com/i/c4gc84f079kv5mdy1qni.jpg",
    "description": "Use intersection observer to develop a performant infinity scroll.",
    "published": false,
    "published_at": null,
    "processed_html": "\u003cp\u003eIn this post we'll implement an infinity scroll usgin the \u003ca href=\"https://developer.mozilla.org/fr/docs/Web/API/Intersection_Observer_API\"\u003eIntersection Observer\u003c/a\u003e API.\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--hYct8xi1--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/232apbq1dyacb3j6mzyc.gif\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--hYct8xi1--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/232apbq1dyacb3j6mzyc.gif\" alt=\"demo\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eFull code is available here :\u003c/p\u003e\n\n\n\u003cdiv class=\"ltag-github-readme-tag\"\u003e\n  \u003cdiv class=\"readme-overview\"\u003e\n    \u003ch2\u003e\n      \u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--qF2jUiUG--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://practicaldev-herokuapp-com.freetls.fastly.net/assets/github-logo-6a5bca60a4ebf959a6df7f08217acd07ac2bc285164fae041eacb8a148b1bab9.svg\" alt=\"GitHub logo\" loading=\"lazy\"\u003e\n      \u003ca href=\"https://github.com/jean-smaug\"\u003e\n        jean-smaug\n      \u003c/a\u003e / \u003ca style=\"font-weight: 600;\" href=\"https://github.com/jean-smaug/demo-infinite-scroll\"\u003e\n        demo-infinite-scroll\n      \u003c/a\u003e\n    \u003c/h2\u003e\n    \u003ch3\u003e\n      \n    \u003c/h3\u003e\n  \u003c/div\u003e\n\u003c/div\u003e\n\n\n\u003ch1\u003e\n  \u003ca name=\"presentation\" href=\"#presentation\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Presentation\n\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--wDbOv3nu--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/383eq0tk2iia8h45phrr.gif\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--wDbOv3nu--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/383eq0tk2iia8h45phrr.gif\" alt=\"collider\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eThis API gives use the ability to detect when the \u003cstrong\u003etarget\u003c/strong\u003e element become visible for a \u003cstrong\u003eroot\u003c/strong\u003e element\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eoptions\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eroot\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003equerySelector\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003e#scrollArea\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n  \u003cspan class=\"na\"\u003erootMargin\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003e20px 5px\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ethreshold\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mf\"\u003e0.5\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mf\"\u003e1.0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003ecallback\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"cm\"\u003e/*...*/\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eobserver\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eIntersectionObserver\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ecallback\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eoptions\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eThe constructor is taking a callback as the first parameter which cill be called each time an observed element become visible or invisible for the root element.\u003cbr\u003e\nIl est possible de changer la mani√®re dont le callback est appel√© en sp√©cifiant des options :\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003cstrong\u003eroot\u003c/strong\u003e : L'√©l√©ment qui d√©tecte la visibilit√© de la cible. Il doit √™tre un anc√™tre de la cible. Par d√©faut la zone d'affichage (le viewport) du navigateur est utilis√©e.\u003c/li\u003e\n\u003cli\u003e\n\u003cstrong\u003erootMargin\u003c/strong\u003e : La marge autour de la propri√©t√© \u003cstrong\u003eroot\u003c/strong\u003e. Elle prend des valeurs similaires √† la propri√©t√© CSS margin. Cela permet de detecter la cible plus t√¥t (marge positive) ou plus tard (marge n√©gative).\u003c/li\u003e\n\u003cli\u003e\n\u003cstrong\u003ethreshold\u003c/strong\u003e : Soit un nombre, soit un tableau de nombre qui indique √† quel pourcentage de la visibilit√© de la cible la fonction callback de la cible doit √™tre ex√©cut√©.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"support-navigateur\" href=\"#support-navigateur\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Support navigateur\n\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--SnsDGvzm--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/329qiwa96z4qf3j4vw76.jpg\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--SnsDGvzm--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/329qiwa96z4qf3j4vw76.jpg\" alt=\"can-i-use\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eEn terme de support, comme d'habitude IE pose des probl√®mes. √Ä cela, j'ai envie de dire deux choses :\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eIE va mourir le 31 janvier 2020\u003c/li\u003e\n\u003cli\u003eLes utilisateurs d'IE ne m√©ritent que notre m√©pris\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eIl n'est donc plus n√©cessaire de se pr√©occuper de ce genre de d√©tails. Si jamais vous √©prouvez des remords pour ces √™tres cruels, qui utilisent un outil ne respectant pas les conventions de Gen√®ve, alors vous pouvez toujours utiliser \u003ca href=\"https://github.com/w3c/IntersectionObserver/tree/master/polyfill\"\u003eun polyfill\u003c/a\u003e.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"exemple\" href=\"#exemple\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Exemple\n\u003c/h2\u003e\n\n\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight html\"\u003e\u003ccode\u003e\u003cspan class=\"cp\"\u003e\u0026lt;!DOCTYPE html\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;html\u003c/span\u003e \u003cspan class=\"na\"\u003elang=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"fr\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;head\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c\"\u003e\u0026lt;!-- ... --\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;link\u003c/span\u003e \u003cspan class=\"na\"\u003erel=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"stylesheet\"\u003c/span\u003e \u003cspan class=\"na\"\u003ehref=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"./spinner.css\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;/head\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;body\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c\"\u003e\u0026lt;!-- Le contenu d'une balise template n'est pas affich√©. \n    On s'en sert uniquement c√¥t√© JS --\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;template\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"nt\"\u003e\u0026lt;div\u003c/span\u003e \u003cspan class=\"na\"\u003eclass=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"picture\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c\"\u003e\u0026lt;!-- Le spinner vient de https://loading.io/css --\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\u0026lt;div\u003c/span\u003e \u003cspan class=\"na\"\u003eclass=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"lds-dual-ring\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u0026lt;/div\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c\"\u003e\u0026lt;!-- Pr√©ciser la taille de l'image permet au navigateur de \n        reserver l'espace n√©cessaire pour l'image --\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\u0026lt;img\u003c/span\u003e \u003cspan class=\"na\"\u003eheight=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"250\"\u003c/span\u003e \u003cspan class=\"na\"\u003ewidth=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"400\"\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"nt\"\u003e\u0026lt;/div\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;/template\u0026gt;\u003c/span\u003e\n\n    \u003cspan class=\"nt\"\u003e\u0026lt;main\u0026gt;\u0026lt;/main\u0026gt;\u003c/span\u003e\n\n    \u003cspan class=\"nt\"\u003e\u0026lt;script \u003c/span\u003e\u003cspan class=\"na\"\u003esrc=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"./app.js\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u0026lt;/script\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;/body\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/html\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003emain\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003equerySelector\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003emain\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003etemplate\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003equerySelector\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003etemplate\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003econtent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003equerySelector\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003ediv\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"cm\"\u003e/* Cette fonction utilise l'API https://picsum.photos pour retourner\nl'URL d'une image d'une taille donn√©e. Le param√®tre nocache est l√†\npour √©viter que le navigateur ne renvoi toujours la m√™me photo\n(le nom nocache a √©t√© choisi arbitrairement) */\u003c/span\u003e\n\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003egetImageUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e \u003cspan class=\"nx\"\u003ewidth\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eheight\u003c/span\u003e \u003cspan class=\"p\"\u003e})\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"s2\"\u003e`https://picsum.photos/\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003ewidth\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e/\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003eheight\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e?nocache=\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003eperformance\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003enow\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\u003cspan class=\"s2\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// Cette fonction retourne un clone du template d√©fini dans le HTML\u003c/span\u003e\n\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003erenderPicture\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003epicture\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003etemplate\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecloneNode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eimage\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003epicture\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003equerySelector\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eimg\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003espinner\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003epicture\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003equerySelector\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e.lds-dual-ring\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n  \u003cspan class=\"cm\"\u003e/* La largeur et la hauteur de l'image sont d√©termin√©es\n  par les attributs qui ont √©t√© d√©finis c√¥t√© HTML */\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eimage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esrc\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003egetImageUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ewidth\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eimage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ewidth\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eheight\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eimage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eheight\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n  \u003cspan class=\"c1\"\u003e// Lorsque l'image est charg√©e on supprime le loader\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eimage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eonload\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003epicture\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eremoveChild\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003espinner\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003epicture\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// Ajoute un √©l√©ment au DOM et observe cet √©l√©ment\u003c/span\u003e\n\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003eappendAndObserve\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eobserver\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eelement\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003emain\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eappendChild\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eelement\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eobserver\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eobserve\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eelement\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"cm\"\u003e/* La fonction de callback pass√©e au constructeur sera appel√©e\nlorsqu'un nouvel √©l√©ment est observ√© et √† chaque fois qu'un\n√©l√©ment devient visible. Il prend en param√®tre la liste des\n√©l√©ments observ√©s. */\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eintersectionObserver\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eIntersectionObserver\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eentries\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eentry\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eentries\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n  \u003cspan class=\"cm\"\u003e/* Lorsque l'√©l√©ment devient visible on arr√™te de l'observer et\n  on ajoute un nouvel √©l√©ment que l'on observe */\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eentry\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eisIntersecting\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eunobserve\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eentry\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etarget\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003epicture\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003erenderPicture\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eappendAndObserve\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003epicture\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// On ajoute l'image initiale au DOM et on l'observe \u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eintialPicture\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003erenderPicture\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"nx\"\u003eappendAndObserve\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eintersectionObserver\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eintialPicture\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eCette solution a l'avantage de s'adapter √† la taille de l'√©cran. Lorsque l'√©cran est capable d'afficher 3 images alors on a 4 images dans le DOM. Sur un √©cran plus petit, capable d'afficher 2 images alors 3 images seront dans le DOM.\u003cbr\u003e\nDe mani√®re g√©n√©rale on a toujours (N images visibles + 1) images charg√©es dans le DOM.\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--Mn8x6vVC--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/gknsy51kv3tslayvo83k.gif\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--Mn8x6vVC--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/gknsy51kv3tslayvo83k.gif\" alt=\"demo-viewport\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eCela est possible car l'attribut height a √©t√© pass√© a la balise img, ce qui permet a l'Intersection Observer de faire ses calculs avant que l'image ne soit charg√©e.\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"conclusion\" href=\"#conclusion\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Conclusion\n\u003c/h1\u003e\n\n\u003cp\u003eLe scroll infini est un cas d'utilisation tr√®s pratique pour d√©montrer la puissance de l'API Intersection Observer.\u003c/p\u003e\n\n\u003cp\u003eCombin√© aux frameworks comme React ou Vue.js, on pourrait d√©tecter quels sont les √©l√©ments qui doivent √™tre rendus et ainsi gagner en performances sur des composants comme les carousels ou toute autre liste d'√©l√©ments dont la taille d√©passe l'affichage actuel du navigateur.\u003c/p\u003e\n\n\u003cp\u003eMerci √† Julien Ducrot pour la relecture.\u003c/p\u003e\n\n\u003cp\u003eMerci de m'avoir lu.\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"liens\" href=\"#liens\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Liens\n\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://www.w3schools.com/html/html_images.asp\"\u003ehttps://www.w3schools.com/html/html_images.asp\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.w3schools.com/tags/tag_template.asp\"\u003ehttps://www.w3schools.com/tags/tag_template.asp\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://itnext.io/1v1-scroll-listener-vs-intersection-observers-469a26ab9eb6\"\u003ehttps://itnext.io/1v1-scroll-listener-vs-intersection-observers-469a26ab9eb6\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n",
    "social_image": null,
    "body_markdown": "---\ntitle: To infinity scroll, and Beyond\npublished: false\ndescription: Use intersection observer to develop a performant infinity scroll.\ncover_image: https://thepracticaldev.s3.amazonaws.com/i/c4gc84f079kv5mdy1qni.jpg\ntags: javascript, intersection-observer\n---\n\nIn this post we'll implement an infinity scroll usgin the [Intersection Observer](https://developer.mozilla.org/fr/docs/Web/API/Intersection_Observer_API) API.\n\n![demo](https://thepracticaldev.s3.amazonaws.com/i/232apbq1dyacb3j6mzyc.gif)\n\nFull code is available here :\n\n{% github jean-smaug/demo-infinite-scroll no-readme %}\n\n# Presentation\n\n![collider](https://thepracticaldev.s3.amazonaws.com/i/383eq0tk2iia8h45phrr.gif)\n\nThis API gives use the ability to detect when the **target** element become visible for a **root** element\n\n```js\nconst options = {\n  root: document.querySelector('#scrollArea'),\n  rootMargin: '20px 5px',\n  threshold: [0.5, 1.0]\n}\n\nfunction callback() {/*...*/}\n\nconst observer = new IntersectionObserver(callback, options);\n```\n\nThe constructor is taking a callback as the first parameter which cill be called each time an observed element become visible or invisible for the root element.\nIl est possible de changer la mani√®re dont le callback est appel√© en sp√©cifiant des options :\n\n- **root** : L'√©l√©ment qui d√©tecte la visibilit√© de la cible. Il doit √™tre un anc√™tre de la cible. Par d√©faut la zone d'affichage (le viewport) du navigateur est utilis√©e.\n- **rootMargin** : La marge autour de la propri√©t√© **root**. Elle prend des valeurs similaires √† la propri√©t√© CSS margin. Cela permet de detecter la cible plus t√¥t (marge positive) ou plus tard (marge n√©gative).\n- **threshold** : Soit un nombre, soit un tableau de nombre qui indique √† quel pourcentage de la visibilit√© de la cible la fonction callback de la cible doit √™tre ex√©cut√©.\n\n# Support navigateur\n\n![can-i-use](https://thepracticaldev.s3.amazonaws.com/i/329qiwa96z4qf3j4vw76.jpg)\n\nEn terme de support, comme d'habitude IE pose des probl√®mes. √Ä cela, j'ai envie de dire deux choses :\n- IE va mourir le 31 janvier 2020\n- Les utilisateurs d'IE ne m√©ritent que notre m√©pris\n\nIl n'est donc plus n√©cessaire de se pr√©occuper de ce genre de d√©tails. Si jamais vous √©prouvez des remords pour ces √™tres cruels, qui utilisent un outil ne respectant pas les conventions de Gen√®ve, alors vous pouvez toujours utiliser [un polyfill](https://github.com/w3c/IntersectionObserver/tree/master/polyfill).\n\n## Exemple\n\n```html\n\u003c!DOCTYPE html\u003e\n\u003chtml lang=\"fr\"\u003e\n  \u003chead\u003e\n    \u003c!-- ... --\u003e\n    \u003clink rel=\"stylesheet\" href=\"./spinner.css\"\u003e\n  \u003c/head\u003e\n  \u003cbody\u003e\n    \u003c!-- Le contenu d'une balise template n'est pas affich√©. \n    On s'en sert uniquement c√¥t√© JS --\u003e\n    \u003ctemplate\u003e\n      \u003cdiv class=\"picture\"\u003e\n        \u003c!-- Le spinner vient de https://loading.io/css --\u003e\n        \u003cdiv class=\"lds-dual-ring\"\u003e\u003c/div\u003e\n        \u003c!-- Pr√©ciser la taille de l'image permet au navigateur de \n        reserver l'espace n√©cessaire pour l'image --\u003e\n        \u003cimg height=\"250\" width=\"400\" /\u003e\n      \u003c/div\u003e\n    \u003c/template\u003e\n\n    \u003cmain\u003e\u003c/main\u003e\n\n    \u003cscript src=\"./app.js\"\u003e\u003c/script\u003e\n  \u003c/body\u003e\n\u003c/html\u003e\n```\n\n```js\nconst main = document.querySelector(\"main\");\nconst template = document.querySelector(\"template\").content.querySelector(\"div\");\n\n/* Cette fonction utilise l'API https://picsum.photos pour retourner\nl'URL d'une image d'une taille donn√©e. Le param√®tre nocache est l√†\npour √©viter que le navigateur ne renvoi toujours la m√™me photo\n(le nom nocache a √©t√© choisi arbitrairement) */\nfunction getImageUrl({ width, height }) {\n  return `https://picsum.photos/${width}/${height}?nocache=${performance.now()}`;\n}\n\n// Cette fonction retourne un clone du template d√©fini dans le HTML\nfunction renderPicture() {\n  const picture = template.cloneNode(true);\n  const image = picture.querySelector(\"img\");\n  const spinner = picture.querySelector(\".lds-dual-ring\");\n\n  /* La largeur et la hauteur de l'image sont d√©termin√©es\n  par les attributs qui ont √©t√© d√©finis c√¥t√© HTML */\n  image.src = getImageUrl({\n    width: image.width,\n    height: image.height\n  });\n\n  // Lorsque l'image est charg√©e on supprime le loader\n  image.onload = function() {\n    picture.removeChild(spinner);\n  };\n\n  return picture;\n}\n\n// Ajoute un √©l√©ment au DOM et observe cet √©l√©ment\nfunction appendAndObserve(observer, element) {\n  main.appendChild(element);\n  observer.observe(element);\n}\n\n/* La fonction de callback pass√©e au constructeur sera appel√©e\nlorsqu'un nouvel √©l√©ment est observ√© et √† chaque fois qu'un\n√©l√©ment devient visible. Il prend en param√®tre la liste des\n√©l√©ments observ√©s. */\nconst intersectionObserver = new IntersectionObserver(function(entries) {\n  const entry = entries[0];\n\n  /* Lorsque l'√©l√©ment devient visible on arr√™te de l'observer et\n  on ajoute un nouvel √©l√©ment que l'on observe */\n  if (entry.isIntersecting) {\n    this.unobserve(entry.target);\n\n    const picture = renderPicture();\n    appendAndObserve(this, picture);\n  }\n});\n\n// On ajoute l'image initiale au DOM et on l'observe \nconst intialPicture = renderPicture();\nappendAndObserve(intersectionObserver, intialPicture);\n```\n\nCette solution a l'avantage de s'adapter √† la taille de l'√©cran. Lorsque l'√©cran est capable d'afficher 3 images alors on a 4 images dans le DOM. Sur un √©cran plus petit, capable d'afficher 2 images alors 3 images seront dans le DOM.\nDe mani√®re g√©n√©rale on a toujours (N images visibles + 1) images charg√©es dans le DOM.\n\n![demo-viewport](https://thepracticaldev.s3.amazonaws.com/i/gknsy51kv3tslayvo83k.gif)\n\nCela est possible car l'attribut height a √©t√© pass√© a la balise img, ce qui permet a l'Intersection Observer de faire ses calculs avant que l'image ne soit charg√©e.\n\n# Conclusion\n\nLe scroll infini est un cas d'utilisation tr√®s pratique pour d√©montrer la puissance de l'API Intersection Observer.\n\nCombin√© aux frameworks comme React ou Vue.js, on pourrait d√©tecter quels sont les √©l√©ments qui doivent √™tre rendus et ainsi gagner en performances sur des composants comme les carousels ou toute autre liste d'√©l√©ments dont la taille d√©passe l'affichage actuel du navigateur.\n\nMerci √† Julien Ducrot pour la relecture.\n\nMerci de m'avoir lu.\n\n# Liens\n\n- [https://www.w3schools.com/html/html_images.asp](https://www.w3schools.com/html/html_images.asp)\n- [https://www.w3schools.com/tags/tag_template.asp](https://www.w3schools.com/tags/tag_template.asp)\n- [https://itnext.io/1v1-scroll-listener-vs-intersection-observers-469a26ab9eb6](https://itnext.io/1v1-scroll-listener-vs-intersection-observers-469a26ab9eb6)",
    "canonical_url": null,
    "show_comments": true,
    "main_image_background_hex_color": "#dddddd",
    "published_from_feed": false,
    "comments_count": 0,
    "video": null,
    "video_code": null,
    "video_source_url": null,
    "video_thumbnail_url": null,
    "video_closed_caption_track_url": null,
    "feed_source_url": null,
    "positive_reactions_count": 0,
    "edited_at": null,
    "crossposted_at": null,
    "language": "en",
    "cached_tag_list": "javascript, intersectionobserver",
    "path": "/jeansmaug/to-infinity-scroll-and-beyond-3c0d-temp-slug-7484183",
    "cached_user_name": "jean-smaug",
    "cached_user_username": "jeansmaug",
    "last_comment_at": "2017-01-01T05:00:00.000Z"
  },
  {
    "title": "Un graphique mis √† jour avec les Server-sent events",
    "slug": "un-graphique-mis-a-jour-avec-les-server-sent-events-470b",
    "created_at": "2020-01-23T10:53:43.086Z",
    "main_image": "https://thepracticaldev.s3.amazonaws.com/i/rgvgxbys3uz5wdk5k5ud.jpg",
    "description": "Les Server-sent events, ou comment le serveur peut envoyer un message sans websocket.",
    "published": true,
    "published_at": "2020-01-23T10:55:09.394Z",
    "processed_html": "\u003cp\u003eAujourd'hui, on va parler des \u003ca href=\"https://developer.mozilla.org/fr/docs/Web/API/Server-sent_events/Using_server-sent_events\"\u003eServer-sent events\u003c/a\u003e, une technologie permettant de recevoir des messages de la part du serveur.\u003c/p\u003e\n\n\u003cp\u003eLe code utilis√© est disponible ici :\u003c/p\u003e\n\n\n\u003cdiv class=\"ltag-github-readme-tag\"\u003e\n  \u003cdiv class=\"readme-overview\"\u003e\n    \u003ch2\u003e\n      \u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--qF2jUiUG--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://practicaldev-herokuapp-com.freetls.fastly.net/assets/github-logo-6a5bca60a4ebf959a6df7f08217acd07ac2bc285164fae041eacb8a148b1bab9.svg\" alt=\"GitHub logo\" loading=\"lazy\"\u003e\n      \u003ca href=\"https://github.com/generous-folks\"\u003e\n        generous-folks\n      \u003c/a\u003e / \u003ca style=\"font-weight: 600;\" href=\"https://github.com/generous-folks/demo-dashboard-server-sent-events\"\u003e\n        demo-dashboard-server-sent-events\n      \u003c/a\u003e\n    \u003c/h2\u003e\n    \u003ch3\u003e\n      \n    \u003c/h3\u003e\n  \u003c/div\u003e\n\u003c/div\u003e\n\n\n\u003cp\u003eNous allons d√©couvrir ce que sont les SSE en construisant un graphique mis √† jour toutes les secondes.\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--i04SXETk--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/zju5qv99mnzh12raytgm.gif\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--i04SXETk--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/zju5qv99mnzh12raytgm.gif\" alt=\"demo-gif\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"fonctionnement\" href=\"#fonctionnement\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Fonctionnement\n\u003c/h1\u003e\n\n\u003cp\u003eLes SSE fonctionnent de la mani√®re suivante :\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eLe client demande au serveur d'√©couter une route\u003c/li\u003e\n\u003cli\u003eLe serveur r√©pond qu'il est d'accord pour que le client √©coute\u003c/li\u003e\n\u003cli\u003eLorsque le serveur le souhaite il envoie des informations au client. Ce dernier re√ßoit un message qu'il peut traiter comme il le souhaite.\u003c/li\u003e\n\u003cli\u003eLorsque l'on ne veut plus recevoir de donn√©es le client ou le serveur peuvent interrompre la connexion\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--dES0S0n_--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/0zsmw96enrzzuroimv2f.png\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--dES0S0n_--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/0zsmw96enrzzuroimv2f.png\" alt=\"schema\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"support-navigateur\" href=\"#support-navigateur\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Support navigateur\n\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--7plDTxNI--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/m72f7w8j0x0bhrtm733d.jpg\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--7plDTxNI--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/m72f7w8j0x0bhrtm733d.jpg\" alt=\"browser-support\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eEst-il vraiment n√©cessaire que je parle du navigateur dont on ne doit pas prononcer le nom ?\u003c/p\u003e\n\n\u003cp\u003eQuoi qu'il en soit, on peut utiliser \u003ca href=\"https://www.npmjs.com/package/event-source-polyfill\"\u003eun polyfill\u003c/a\u003e en cas de besoin.\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"code\" href=\"#code\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Code\n\u003c/h1\u003e\n\n\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// server.js\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ehttp\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003erequire\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003ehttp\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ePORT\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e5000\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003ehttp\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecreateServer\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"nx\"\u003ereq\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"cm\"\u003e/* Il est n√©cessaire d'indiquer au navigateur qu'il va\n    recevoir des donn√©es de type \"text/event-stream\" */\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ewriteHead\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e200\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eContent-Type\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003etext/event-stream\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eAccess-Control-Allow-Origin\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e*\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n    \u003cspan class=\"nx\"\u003esetInterval\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003edata\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"na\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eMath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eround\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003eMath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003erandom\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n      \u003cspan class=\"cm\"\u003e/* Les donn√©es envoy√©es doivent suivre un format pr√©cis.\n      Une chaine de caract√®res √©tant \"data: mydata\", suivi d'un \"\\n\\n\".\n      Si vous voulez transmettre du JSON il faudra le transformer en\n      chaine de caract√®re comme ci-dessous. */\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ewrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e`data: \u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003eJSON\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003estringify\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e)}\u003c/span\u003e\u003cspan class=\"s2\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ewrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\\n\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e},\u003c/span\u003e \u003cspan class=\"mi\"\u003e1000\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elisten\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ePORT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e`http://localhost:\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003ePORT\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// client.js\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"nx\"\u003ec3\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003ec3\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"cm\"\u003e/* L'objet EventSource nous permet d'√©couter les √©v√©nements\nenvoy√©s depuis le serveur. On l'instancie en lui passant l'URL\nd'o√π proviendront les √©v√©nements */\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eevtSource\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eEventSource\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003ehttp://localhost:5000\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// Initialisation du graphique\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003edata\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e30\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e20\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e40\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e15\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e25\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003echart\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ec3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egenerate\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ebindto\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e#chart\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"na\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003earea\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ecolumns\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[[\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eRandom\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e...\u003c/span\u003e\u003cspan class=\"nx\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e]]\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ebar\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{},\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eaxis\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"na\"\u003emax\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e200\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"na\"\u003emin\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n\u003cspan class=\"cm\"\u003e/* On effectue un traitement uniquementlorsque\nle serveur d√©cide d'envoyer un message */\u003c/span\u003e\n\u003cspan class=\"nx\"\u003eevtSource\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eonmessage\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"cm\"\u003e/* Le code ci-dessous est li√© √† C3.js, mais concr√®tement,\n  on souhaite afficher maximum 10 valeurs sur ce graphique */\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elength\u003c/span\u003e \u003cspan class=\"o\"\u003e===\u003c/span\u003e \u003cspan class=\"mi\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"nx\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eshift\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n  \u003cspan class=\"nx\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epush\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eJSON\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eparse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n  \u003cspan class=\"nx\"\u003echart\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eload\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ecolumns\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[[\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eRandom\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e...\u003c/span\u003e\u003cspan class=\"nx\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e]]\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n\u003cspan class=\"cm\"\u003e/* En plus des messages, il est possible d'√©couter lorsque\nla communication commence et lorsqu'il y a une erreur */\u003c/span\u003e\n\u003cspan class=\"nx\"\u003eevtSource\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eonopen\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eAh bogaaaas\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eevtSource\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eonerror\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e// Je suis certain que vous aussi vous d√©bugguez comme √ßa\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eEt merde !\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003ch1\u003e\n  \u003ca name=\"websocket-en-moins-bien-\" href=\"#websocket-en-moins-bien-\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Websocket en moins bien ?\n\u003c/h1\u003e\n\n\u003cp\u003eC'est pas moins bien, c'est diff√©rent !\u003c/p\u003e\n\n\u003cp\u003eAvantage des SSE sur les Websockets:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eTransport via HTTP plut√¥t que part un protocole sp√©cifique\u003c/li\u003e\n\u003cli\u003eCompatibilit√© avec les vieux navigateurs gr√¢ce aux polyfill\u003c/li\u003e\n\u003cli\u003eReprise de connexion native\u003c/li\u003e\n\u003cli\u003ePas de probl√®mes avec les pare-feux d'entreprises\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eAvantages des Websockets sur les SSE:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eCommunication bi-directionnelle\u003c/li\u003e\n\u003cli\u003eSupporte le transfert de donn√©es binaires\u003c/li\u003e\n\u003cli\u003e\"Pas de limites\" de connexions\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eSur ce dernier point, il faut savoir que l'on peut avoir maximum 6 connexions ouvertes \u003cstrong\u003epar navigateur\u003c/strong\u003e concernant les SSE.\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"conclusion\" href=\"#conclusion\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Conclusion\n\u003c/h1\u003e\n\n\u003cp\u003eLes SSE font parti de ces technologies dont on entend peu parler. Pourtant, ils sont peu co√ªteux √† mettre en place, 1 header, 1 format de donn√©es et le tour est jou√©.\u003c/p\u003e\n\n\u003cp\u003eEn terme de cas d'utilisation, les notifications, un flux d'information ou encore la gestion de stock sont parfaitement envisageables.\u003c/p\u003e\n\n\u003cp\u003eLes usages possibles sont multiples, mais il faut garder √† l'esprit les limitations d'une telle technologie. 6 connexions par navigateur et pas de transfert de donn√©es binaires.\u003c/p\u003e\n\n\u003cp\u003eWebsocket ou SSE, maintenant vous avez le choix pour votre communication serveur ‚Üí client\u003c/p\u003e\n\n\u003cp\u003eMerci de m'avoir lu. \u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"liens\" href=\"#liens\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Liens\n\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://www.pubnub.com/learn/glossary/what-are-server-sent-events/\"\u003ehttps://www.pubnub.com/learn/glossary/what-are-server-sent-events/\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://stackoverflow.com/questions/5195452/websockets-vs-server-sent-events-eventsource\"\u003ehttps://stackoverflow.com/questions/5195452/websockets-vs-server-sent-events-eventsource\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.scaledrone.com/blog/websockets-vs-server-sent-events-sses/\"\u003ehttps://www.scaledrone.com/blog/websockets-vs-server-sent-events-sses/\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n",
    "social_image": null,
    "body_markdown": "---\ntitle: Un graphique mis √† jour avec les Server-sent events\npublished: true\ndescription: Les Server-sent events, ou comment le serveur peut envoyer un message sans websocket.\ncover_image: https://thepracticaldev.s3.amazonaws.com/i/rgvgxbys3uz5wdk5k5ud.jpg\ntags: node, webdev, sse\n---\n\nAujourd'hui, on va parler des [Server-sent events](https://developer.mozilla.org/fr/docs/Web/API/Server-sent_events/Using_server-sent_events), une technologie permettant de recevoir des messages de la part du serveur.\n\nLe code utilis√© est disponible ici :\n\n{% github generous-folks/demo-dashboard-server-sent-events no-readme %}\n\nNous allons d√©couvrir ce que sont les SSE en construisant un graphique mis √† jour toutes les secondes.\n\n![demo-gif](https://thepracticaldev.s3.amazonaws.com/i/zju5qv99mnzh12raytgm.gif)\n\n# Fonctionnement\n\nLes SSE fonctionnent de la mani√®re suivante :\n\n1. Le client demande au serveur d'√©couter une route\n2. Le serveur r√©pond qu'il est d'accord pour que le client √©coute\n3. Lorsque le serveur le souhaite il envoie des informations au client. Ce dernier re√ßoit un message qu'il peut traiter comme il le souhaite.\n4. Lorsque l'on ne veut plus recevoir de donn√©es le client ou le serveur peuvent interrompre la connexion\n\n![schema](https://thepracticaldev.s3.amazonaws.com/i/0zsmw96enrzzuroimv2f.png)\n\n# Support navigateur\n\n![browser-support](https://thepracticaldev.s3.amazonaws.com/i/m72f7w8j0x0bhrtm733d.jpg)\n\nEst-il vraiment n√©cessaire que je parle du navigateur dont on ne doit pas prononcer le nom ?\n\nQuoi qu'il en soit, on peut utiliser [un polyfill](https://www.npmjs.com/package/event-source-polyfill) en cas de besoin.\n\n# Code\n\n```js\n// server.js\n\nconst http = require(\"http\")\nconst PORT = 5000\n\nhttp\n  .createServer((req, res) =\u003e {\n    /* Il est n√©cessaire d'indiquer au navigateur qu'il va\n    recevoir des donn√©es de type \"text/event-stream\" */\n    res.writeHead(200, {\n      \"Content-Type\": \"text/event-stream\",\n      \"Access-Control-Allow-Origin\": \"*\"\n    });\n\n    setInterval(() =\u003e {\n      const data = {\n        value: Math.round(Math.random() * 100)\n      };\n\n      /* Les donn√©es envoy√©es doivent suivre un format pr√©cis.\n      Une chaine de caract√®res √©tant \"data: mydata\", suivi d'un \"\\n\\n\".\n      Si vous voulez transmettre du JSON il faudra le transformer en\n      chaine de caract√®re comme ci-dessous. */\n      res.write(`data: ${JSON.stringify(data)}`);\n      res.write(\"\\n\\n\");\n    }, 1000);\n  })\n  .listen(PORT, () =\u003e console.log(`http://localhost:${PORT}`));\n```\n\n```js\n// client.js\n\nimport c3 from \"c3\";\n\n/* L'objet EventSource nous permet d'√©couter les √©v√©nements\nenvoy√©s depuis le serveur. On l'instancie en lui passant l'URL\nd'o√π proviendront les √©v√©nements */\nconst evtSource = new EventSource(\"http://localhost:5000\");\n\n// Initialisation du graphique\nconst data = [30, 20, 10, 40, 15, 25];\nconst chart = c3.generate({\n  bindto: \"#chart\",\n  data: {\n    type: \"area\",\n    columns: [[\"Random\", ...data]]\n  },\n  bar: {},\n  axis: {\n    y: {\n      max: 200,\n      min: 0\n    }\n  }\n});\n\n/* On effectue un traitement uniquementlorsque\nle serveur d√©cide d'envoyer un message */\nevtSource.onmessage = function(e) {\n  /* Le code ci-dessous est li√© √† C3.js, mais concr√®tement,\n  on souhaite afficher maximum 10 valeurs sur ce graphique */\n  if (data.length === 10) data.shift();\n\n  data.push(JSON.parse(e.data).value);\n\n  chart.load({\n    columns: [[\"Random\", ...data]]\n  });\n};\n\n/* En plus des messages, il est possible d'√©couter lorsque\nla communication commence et lorsqu'il y a une erreur */\nevtSource.onopen = function() {\n  console.log(\"Ah bogaaaas\");\n};\n\nevtSource.onerror = function() {\n  // Je suis certain que vous aussi vous d√©bugguez comme √ßa\n  console.error(\"Et merde !\");\n};\n```\n\n# Websocket en moins bien ?\n\nC'est pas moins bien, c'est diff√©rent !\n\nAvantage des SSE sur les Websockets:\n\n- Transport via HTTP plut√¥t que part un protocole sp√©cifique\n- Compatibilit√© avec les vieux navigateurs gr√¢ce aux polyfill\n- Reprise de connexion native\n- Pas de probl√®mes avec les pare-feux d'entreprises\n\nAvantages des Websockets sur les SSE:\n\n- Communication bi-directionnelle\n- Supporte le transfert de donn√©es binaires\n- \"Pas de limites\" de connexions\n\nSur ce dernier point, il faut savoir que l'on peut avoir maximum 6 connexions ouvertes **par navigateur** concernant les SSE.\n\n# Conclusion\n\nLes SSE font parti de ces technologies dont on entend peu parler. Pourtant, ils sont peu co√ªteux √† mettre en place, 1 header, 1 format de donn√©es et le tour est jou√©.\n\nEn terme de cas d'utilisation, les notifications, un flux d'information ou encore la gestion de stock sont parfaitement envisageables.\n\nLes usages possibles sont multiples, mais il faut garder √† l'esprit les limitations d'une telle technologie. 6 connexions par navigateur et pas de transfert de donn√©es binaires.\n\nWebsocket ou SSE, maintenant vous avez le choix pour votre communication serveur \u0026rarr; client\n\nMerci de m'avoir lu. \n\n# Liens\n\n- [https://www.pubnub.com/learn/glossary/what-are-server-sent-events/]\n(https://www.pubnub.com/learn/glossary/what-are-server-sent-events/)\n- [https://stackoverflow.com/questions/5195452/websockets-vs-server-sent-events-eventsource](https://stackoverflow.com/questions/5195452/websockets-vs-server-sent-events-eventsource)\n- [https://www.scaledrone.com/blog/websockets-vs-server-sent-events-sses/](https://www.scaledrone.com/blog/websockets-vs-server-sent-events-sses/)",
    "canonical_url": null,
    "show_comments": true,
    "main_image_background_hex_color": "#dddddd",
    "published_from_feed": false,
    "comments_count": 3,
    "video": null,
    "video_code": null,
    "video_source_url": null,
    "video_thumbnail_url": null,
    "video_closed_caption_track_url": null,
    "feed_source_url": null,
    "positive_reactions_count": 8,
    "edited_at": null,
    "crossposted_at": null,
    "language": "fr",
    "cached_tag_list": "node, webdev, sse",
    "path": "/jeansmaug/un-graphique-mis-a-jour-avec-les-server-sent-events-470b",
    "cached_user_name": "jean-smaug",
    "cached_user_username": "jeansmaug",
    "last_comment_at": "2020-01-23T12:59:45.791Z"
  },
  {
    "title": "Jestip, clear mocks automatically",
    "slug": "jestip-clear-mocks-automatically-4f8c",
    "created_at": "2020-01-24T08:49:52.151Z",
    "main_image": "https://thepracticaldev.s3.amazonaws.com/i/91mq6tpua5op66kj38l8.jpg",
    "description": "How to clear mocks without the clearAllMocks function",
    "published": true,
    "published_at": "2020-01-24T08:59:51.856Z",
    "processed_html": "\u003cp\u003eLet's take the following code as example.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003efunctionYouNeedToMock\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"nx\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003ebeforeEach\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003ejest\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eclearAllMocks\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003efunctionYouNeedToMock\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ejest\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003efn\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eshould call function\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003efunctionYouNeedToMock\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eexpect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003efunctionYouNeedToMock\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003etoBeCalledTimes\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eshould call function\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003efunctionYouNeedToMock\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eexpect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003efunctionYouNeedToMock\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003etoBeCalledTimes\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eIt considers that you mocked a function and you want your tests to be independent. So you're using the \u003ccode\u003ejest.clearAllMocks()\u003c/code\u003e function to avoid undesired behaviours.\u003c/p\u003e\n\n\u003cp\u003eDid you know that you can activate the \u003ccode\u003eclearMocks\u003c/code\u003e option in the config in order to avoid calling \u003ccode\u003ejest.clearAllMocks()\u003c/code\u003e in each test suite ?\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// jest.config.js\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eexports\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eclearMocks\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eNow you can write\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003efunctionYouNeedToMock\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"nx\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003efunctionYouNeedToMock\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ejest\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003efn\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eshould call function\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003efunctionYouNeedToMock\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eexpect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003efunctionYouNeedToMock\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003etoBeCalledTimes\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eshould call function\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003efunctionYouNeedToMock\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eexpect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003efunctionYouNeedToMock\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003etoBeCalledTimes\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eThanks for reading\u003c/p\u003e\n\n",
    "social_image": null,
    "body_markdown": "---\ntitle: Jestip, clear mocks automatically\npublished: true\ndescription: How to clear mocks without the clearAllMocks function\ncover_image: https://thepracticaldev.s3.amazonaws.com/i/91mq6tpua5op66kj38l8.jpg\ntags: jest\n---\n\nLet's take the following code as example.\n\n```js\nfunction functionYouNeedToMock(a, b) {\n  return a + b;\n}\n\nbeforeEach(() =\u003e {\n  jest.clearAllMocks();\n});\n\nfunctionYouNeedToMock = jest.fn();\n\nit(\"should call function\", () =\u003e {\n  functionYouNeedToMock();\n  expect(functionYouNeedToMock).toBeCalledTimes(1);\n});\n\nit(\"should call function\", () =\u003e {\n  functionYouNeedToMock();\n  expect(functionYouNeedToMock).toBeCalledTimes(1);\n});\n```\n\nIt considers that you mocked a function and you want your tests to be independent. So you're using the `jest.clearAllMocks()` function to avoid undesired behaviours.\n\nDid you know that you can activate the `clearMocks` option in the config in order to avoid calling `jest.clearAllMocks()` in each test suite ?\n\n```js\n// jest.config.js\n\nmodule.exports = {\n  clearMocks: true\n};\n```\n\nNow you can write\n\n```js\nfunction functionYouNeedToMock(a, b) {\n  return a + b;\n}\n\nfunctionYouNeedToMock = jest.fn();\n\nit(\"should call function\", () =\u003e {\n  functionYouNeedToMock();\n  expect(functionYouNeedToMock).toBeCalledTimes(1);\n});\n\nit(\"should call function\", () =\u003e {\n  functionYouNeedToMock();\n  expect(functionYouNeedToMock).toBeCalledTimes(1);\n});\n```\n\nThanks for reading",
    "canonical_url": null,
    "show_comments": true,
    "main_image_background_hex_color": "#dddddd",
    "published_from_feed": false,
    "comments_count": 0,
    "video": null,
    "video_code": null,
    "video_source_url": null,
    "video_thumbnail_url": null,
    "video_closed_caption_track_url": null,
    "feed_source_url": null,
    "positive_reactions_count": 4,
    "edited_at": "2020-01-24T09:05:20.906Z",
    "crossposted_at": null,
    "language": "en",
    "cached_tag_list": "jest",
    "path": "/jeansmaug/jestip-clear-mocks-automatically-4f8c",
    "cached_user_name": "jean-smaug",
    "cached_user_username": "jeansmaug",
    "last_comment_at": "2020-01-24T08:59:51.856Z"
  },
  {
    "title": "Utiliser Tailwind avec Parcel",
    "slug": "utiliser-tailwind-avec-parcel-4c5p",
    "created_at": "2020-02-03T09:28:58.327Z",
    "main_image": "https://dev-to-uploads.s3.amazonaws.com/i/eix3u4pe0tyl3xtfgzp5.jpg",
    "description": "Comment installer Tailwind avec Parcel",
    "published": true,
    "published_at": "2020-02-03T14:14:55.792Z",
    "processed_html": "\u003cp\u003eNous allons voir comment int√©grer le framework CSS \u003ca href=\"https://tailwindcss.com/\"\u003eTailwind\u003c/a\u003e au sein d'un projet utilisant \u003ca href=\"https://parceljs.org/getting_started.html\"\u003eParcel\u003c/a\u003e pour bundler ses sources.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight shell\"\u003e\u003ccode\u003eyarn add \u003cspan class=\"nt\"\u003e--exact\u003c/span\u003e tailwindcss\nyarn add \u003cspan class=\"nt\"\u003e--dev\u003c/span\u003e \u003cspan class=\"nt\"\u003e--exact\u003c/span\u003e parcel-bundler autoprefixer postcss\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eUne fois les d√©pendances install√©es, nous allons devoir configurer Postcss afin de pouvoir utiliser toutes les fonctionnalit√©s de Tailwind.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// postcss.config.js\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eexports\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eplugins\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003erequire\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003etailwindcss\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003erequire\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eautoprefixer\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eIl faut maintenant cr√©er un fichier de style et utiliser les directives \u003ccode\u003e@tailwind\u003c/code\u003e afin d'importer les diff√©rentes briques du framework.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight css\"\u003e\u003ccode\u003e\u003cspan class=\"c\"\u003e/* style.css */\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003e@tailwind\u003c/span\u003e \u003cspan class=\"n\"\u003ebase\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003e@tailwind\u003c/span\u003e \u003cspan class=\"n\"\u003ecomponents\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003e@tailwind\u003c/span\u003e \u003cspan class=\"n\"\u003eutilities\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eDans le fichier index.html, il faut r√©f√©rencer le fichier \u003ccode\u003estyle.css\u003c/code\u003e.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight html\"\u003e\u003ccode\u003e\u003cspan class=\"c\"\u003e\u0026lt;!-- index.html --\u0026gt;\u003c/span\u003e\n\n\u003cspan class=\"cp\"\u003e\u0026lt;!DOCTYPE html\u0026gt;\u003c/span\u003e\n\n\u003cspan class=\"nt\"\u003e\u0026lt;html\u003c/span\u003e \u003cspan class=\"na\"\u003elang=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"fr\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;head\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c\"\u003e\u0026lt;!-- ... --\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;link\u003c/span\u003e \u003cspan class=\"na\"\u003erel=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"stylesheet\"\u003c/span\u003e \u003cspan class=\"na\"\u003ehref=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"./style.css\"\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;/head\u0026gt;\u003c/span\u003e\n\n  \u003cspan class=\"nt\"\u003e\u0026lt;body\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;h1\u003c/span\u003e \u003cspan class=\"na\"\u003eclass=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"text-3xl\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003eJean Smaug\u003cspan class=\"nt\"\u003e\u0026lt;/h1\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;/body\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/html\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eIl ne nous reste plus qu'a cr√©er les scripts.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight json\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"err\"\u003e...\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"scripts\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"dev\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"parcel index.html\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"build\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"parcel build index.html\"\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"err\"\u003e...\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eOn peut d√©sormais g√©n√©rer une version de production de notre application avec un \u003ccode\u003eyarn build\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--YDZZPyT0--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/8zb5kw4qdlrmy2f79c1i.jpg\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--YDZZPyT0--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/8zb5kw4qdlrmy2f79c1i.jpg\" alt=\"build-without-purge\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"am%C3%A9lioration\" href=\"#am%C3%A9lioration\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Am√©lioration\n\u003c/h1\u003e\n\n\u003cp\u003eNotre configuration fonctionne mais il y a un b√©mol. Notre application importe l'int√©gralit√© du CSS de Tailwind m√™me si nous n'utilisons que quelques classes.\u003c/p\u003e\n\n\u003cp\u003eLe plugin \u003ca href=\"https://www.npmjs.com/package/parcel-plugin-purgecss\"\u003eparcel-plugin-purgecss\u003c/a\u003e permet de nettoyer notre code.\u003cbr\u003e\nIl repose sur PurgeCSS, un outil capable de supprimer du fichier CSS les classes inutilis√©es dans le HTML.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight shell\"\u003e\u003ccode\u003eyarn add \u003cspan class=\"nt\"\u003e--dev\u003c/span\u003e \u003cspan class=\"nt\"\u003e--exact\u003c/span\u003e parcel-plugin-purgecss\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eApr√®s l'installation on cr√©√© un fichier de configuration pour PurgeCSS\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// purgecss.config.js\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eexports\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"na\"\u003econtent\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e**/*.html\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eSi on build de nouveau notre application, le fichier \u003ccode\u003estyle.css\u003c/code\u003e ne fait d√©sormais plus que ~2kb contre ~666kb pr√©c√©demment.  \u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--uAB1uQzL--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/2nbmr58qp64gbxk1czh7.jpg\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--uAB1uQzL--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/2nbmr58qp64gbxk1czh7.jpg\" alt=\"build-with-purge\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"conclusion\" href=\"#conclusion\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Conclusion\n\u003c/h1\u003e\n\n\u003cp\u003eParcel, c'est g√©nial. Tailwind, c'est √©norme. Alors immaginez les deux ensembles !\u003cbr\u003e\nSi en plus de cela, nos fichiers CSS peuvent subir une cure amincissante digne de r√©gime Dukan, alors on est au top. \u003c/p\u003e\n\n\u003cp\u003eMerci de m'avoir lu.\u003c/p\u003e\n\n",
    "social_image": null,
    "body_markdown": "---\ntitle: Utiliser Tailwind avec Parcel\npublished: true\ndescription: Comment installer Tailwind avec Parcel\ncover_image: https://dev-to-uploads.s3.amazonaws.com/i/eix3u4pe0tyl3xtfgzp5.jpg\ntags: tailwind, parcel\n---\n\nNous allons voir comment int√©grer le framework CSS [Tailwind](https://tailwindcss.com/) au sein d'un projet utilisant [Parcel](https://parceljs.org/getting_started.html) pour bundler ses sources.\n\n```bash\nyarn add --exact tailwindcss\nyarn add --dev --exact parcel-bundler autoprefixer postcss\n```\n\nUne fois les d√©pendances install√©es, nous allons devoir configurer Postcss afin de pouvoir utiliser toutes les fonctionnalit√©s de Tailwind.\n\n```js\n// postcss.config.js\n\nmodule.exports = {\n  plugins: [\n    require(\"tailwindcss\"),\n    require(\"autoprefixer\")\n  ]\n};\n```\n\nIl faut maintenant cr√©er un fichier de style et utiliser les directives `@tailwind` afin d'importer les diff√©rentes briques du framework.\n\n```css\n/* style.css */\n\n@tailwind base;\n\n@tailwind components;\n\n@tailwind utilities;\n```\n\nDans le fichier index.html, il faut r√©f√©rencer le fichier `style.css`.\n\n```html\n\u003c!-- index.html --\u003e\n\n\u003c!DOCTYPE html\u003e\n\n\u003chtml lang=\"fr\"\u003e\n  \u003chead\u003e\n    \u003c!-- ... --\u003e\n    \u003clink rel=\"stylesheet\" href=\"./style.css\" /\u003e\n  \u003c/head\u003e\n\n  \u003cbody\u003e\n    \u003ch1 class=\"text-3xl\"\u003eJean Smaug\u003c/h1\u003e\n  \u003c/body\u003e\n\u003c/html\u003e\n```\n\nIl ne nous reste plus qu'a cr√©er les scripts.\n\n```json\n{\n  ...\n  \"scripts\": {\n    \"dev\": \"parcel index.html\",\n    \"build\": \"parcel build index.html\"\n  }\n  ...\n}\n```\n\nOn peut d√©sormais g√©n√©rer une version de production de notre application avec un `yarn build`.\n\n![build-without-purge](https://dev-to-uploads.s3.amazonaws.com/i/8zb5kw4qdlrmy2f79c1i.jpg)\n\n# Am√©lioration\n\nNotre configuration fonctionne mais il y a un b√©mol. Notre application importe l'int√©gralit√© du CSS de Tailwind m√™me si nous n'utilisons que quelques classes.\n\nLe plugin [parcel-plugin-purgecss](https://www.npmjs.com/package/parcel-plugin-purgecss) permet de nettoyer notre code.\nIl repose sur PurgeCSS, un outil capable de supprimer du fichier CSS les classes inutilis√©es dans le HTML.\n\n```bash\nyarn add --dev --exact parcel-plugin-purgecss\n```\n\nApr√®s l'installation on cr√©√© un fichier de configuration pour PurgeCSS\n\n```js\n// purgecss.config.js\n\nmodule.exports = {\n  content: [\"**/*.html\"]\n};\n```\n\nSi on build de nouveau notre application, le fichier `style.css` ne fait d√©sormais plus que ~2kb contre ~666kb pr√©c√©demment.  \n\n![build-with-purge](https://dev-to-uploads.s3.amazonaws.com/i/2nbmr58qp64gbxk1czh7.jpg)\n\n# Conclusion\n\nParcel, c'est g√©nial. Tailwind, c'est √©norme. Alors immaginez les deux ensembles !\nSi en plus de cela, nos fichiers CSS peuvent subir une cure amincissante digne de r√©gime Dukan, alors on est au top. \n\nMerci de m'avoir lu.",
    "canonical_url": null,
    "show_comments": true,
    "main_image_background_hex_color": "#dddddd",
    "published_from_feed": false,
    "comments_count": 0,
    "video": null,
    "video_code": null,
    "video_source_url": null,
    "video_thumbnail_url": null,
    "video_closed_caption_track_url": null,
    "feed_source_url": null,
    "positive_reactions_count": 4,
    "edited_at": "2020-02-03T14:16:24.812Z",
    "crossposted_at": null,
    "language": "fr",
    "cached_tag_list": "tailwind, parcel",
    "path": "/jeansmaug/utiliser-tailwind-avec-parcel-4c5p",
    "cached_user_name": "jean-smaug",
    "cached_user_username": "jeansmaug",
    "last_comment_at": "2020-02-03T14:14:55.792Z"
  }
]
